webpackJsonp([3,1],[function(e,t,i){(function(e,t){var n=i(1),s=n,o=i(38).GalaxyApp,a=i(36),r=i(10),l=i(72),d=i(71),c=i(41),h=i(12),u=i(30);window.app=function(i,n){window.Galaxy=new o(i,n),Galaxy.debug("analysis app");var p=i.config,f=new l({el:"#left",userIsAnonymous:Galaxy.user.isAnonymous(),search_url:p.search_url,toolbox:p.toolbox,toolbox_in_panel:p.toolbox_in_panel,stored_workflow_menu_entries:p.stored_workflow_menu_entries,nginx_upload_path:p.nginx_upload_path,ftp_upload_site:p.ftp_upload_site,default_genome:p.default_genome,default_extension:p.default_extension}),m=new r.CenterPanel({el:"#center"}),g=new d({el:"#right",galaxyRoot:Galaxy.root,userIsAnonymous:Galaxy.user.isAnonymous(),allow_user_dataset_purge:p.allow_user_dataset_purge}),v=new c.PageLayoutView(e.extend(i,{el:"body",left:f,center:m,right:g}));Galaxy.page=v,Galaxy.params=Galaxy.config.params,Galaxy.toolPanel=f.tool_panel,Galaxy.upload=f.uploadButton,Galaxy.currHistoryPanel=g.historyView,Galaxy.currHistoryPanel.listenToGalaxy(Galaxy),Galaxy.app={display:function(e,t){s(".select2-hidden-accessible").remove(),m.display(e)}};new(t.Router.extend({initialize:function(e){this.options=e},execute:function(e,t,i){Galaxy.debug("router execute:",e,t,i);var n=a.parse(t.pop());t.push(n),e&&e.apply(this,t)},routes:{"(/)":"home","(/)root*":"home","(/)tours(/)(:tour_id)":"show_tours"},show_tours:function(e){e?u.giveTour(e):m.display(new u.ToursView)},home:function(e){e.tool_id||e.job_id?"upload1"===e.tool_id?(Galaxy.upload.show(),this._loadCenterIframe("welcome")):this._loadToolForm(e):e.workflow_id?this._loadCenterIframe("workflow/run?id="+e.workflow_id):e.m_c?this._loadCenterIframe(e.m_c+"/"+e.m_a):this._loadCenterIframe("welcome")},_loadToolForm:function(e){e.id=e.tool_id,m.display(new h.View(e))},_loadCenterIframe:function(e,t){t=t||Galaxy.root,e=t+e,m.$("#galaxy_main").prop("src",e)}}))(i);s(function(){v.render().right.historyView.loadCurrentHistory(),Galaxy.listenTo(v.right.historyView,"history-size-change",function(){Galaxy.user.fetch({url:Galaxy.user.urlRoot()+"/"+(Galaxy.user.id||"current")})}),v.right.historyView.connectToQuotaMeter(v.masthead.quotaMeter),t.history.start({root:Galaxy.root,pushState:!0})})}}).call(t,i(2),i(3))},,,,,,,,function(e,t,i){var n,s;n=[],s=function(){"use strict";var e={UPLOAD:"upload",QUEUED:"queued",RUNNING:"running",SETTING_METADATA:"setting_metadata",NEW:"new",EMPTY:"empty",OK:"ok",PAUSED:"paused",FAILED_METADATA:"failed_metadata",NOT_VIEWABLE:"noPermission",DISCARDED:"discarded",ERROR:"error"};return e.READY_STATES=[e.OK,e.EMPTY,e.PAUSED,e.FAILED_METADATA,e.NOT_VIEWABLE,e.DISCARDED,e.ERROR],e.NOT_READY_STATES=[e.UPLOAD,e.QUEUED,e.RUNNING,e.SETTING_METADATA,e.NEW],e}.apply(t,n),!(void 0!==s&&(e.exports=s))},,,function(e,t,i){var n,s;(function(o,a,r){n=[i(9),i(17),i(13)],s=function(e,t,i){var n=o.Model.extend({}),s=o.Model.extend({defaults:{id:"",type:"",name:"",hda_ldda:"hda",metadata:null},initialize:function(){this.get("metadata")||this._set_metadata(),this.on("change",this._set_metadata,this)},_set_metadata:function(){var e=new n;a.each(a.keys(this.attributes),function(t){if(0===t.indexOf("metadata_")){var i=t.split("metadata_")[1];e.set(i,this.attributes[t]),delete this.attributes[t]}},this),this.set("metadata",e,{silent:!0})},get_metadata:function(e){return this.attributes.metadata.get(e)},urlRoot:Galaxy.root+"api/datasets"}),l=s.extend({defaults:a.extend({},s.prototype.defaults,{chunk_url:null,first_data_chunk:null,chunk_index:-1,at_eof:!1}),initialize:function(e){s.prototype.initialize.call(this),this.attributes.chunk_index=this.attributes.first_data_chunk?1:0,this.attributes.chunk_url=Galaxy.root+"dataset/display?dataset_id="+this.id,this.attributes.url_viz=Galaxy.root+"visualization"},get_next_chunk:function(){if(this.attributes.at_eof)return null;var e=this,t=r.Deferred();return r.getJSON(this.attributes.chunk_url,{chunk:e.attributes.chunk_index++}).success(function(i){var n;""!==i.ck_data?n=i:(e.attributes.at_eof=!0,n=null),t.resolve(n)}),t}}),d=o.Collection.extend({model:s}),c=o.View.extend({initialize:function(e){this.row_count=0,this.loading_chunk=!1,new p({model:e.model,$el:this.$el})},expand_to_container:function(){this.$el.height()<this.scroll_elt.height()&&this.attempt_to_fetch()},attempt_to_fetch:function(e){var t=this;!this.loading_chunk&&this.scrolled_to_bottom()&&(this.loading_chunk=!0,this.loading_indicator.show(),r.when(t.model.get_next_chunk()).then(function(e){e&&(t._renderChunk(e),t.loading_chunk=!1),t.loading_indicator.hide(),t.expand_to_container()}))},render:function(){this.loading_indicator=r("<div/>").attr("id","loading_indicator"),this.$el.append(this.loading_indicator);var e=r("<table/>").attr({id:"content_table",cellpadding:0});this.$el.append(e);var t=this.model.get_metadata("column_names"),i=r("<thead/>").appendTo(e),n=r("<tr/>").appendTo(i);if(t)n.append("<th>"+t.join("</th><th>")+"</th>");else for(var s=1;s<=this.model.get_metadata("columns");s++)n.append("<th>"+s+"</th>");var o=this,a=this.model.get("first_data_chunk");a?this._renderChunk(a):r.when(o.model.get_next_chunk()).then(function(e){o._renderChunk(e)}),this.scroll_elt.scroll(function(){o.attempt_to_fetch()})},scrolled_to_bottom:function(){return!1},_renderCell:function(e,t,i){var n=r("<td>").text(e),s=this.model.get_metadata("column_types");return void 0!==i?n.attr("colspan",i).addClass("stringalign"):s&&t<s.length&&("str"!==s[t]&&"list"!==s[t]||n.addClass("stringalign")),n},_renderRow:function(e){var t=e.split("\t"),i=r("<tr>"),n=this.model.get_metadata("columns");return this.row_count%2!==0&&i.addClass("dark_row"),t.length===n?a.each(t,function(e,t){i.append(this._renderCell(e,t))},this):t.length>n?(a.each(t.slice(0,n-1),function(e,t){i.append(this._renderCell(e,t))},this),i.append(this._renderCell(t.slice(n-1).join("\t"),n-1))):n>5&&t.length===n-1?(a.each(t,function(e,t){i.append(this._renderCell(e,t))},this),i.append(r("<td>"))):i.append(this._renderCell(e,0,n)),this.row_count++,i},_renderChunk:function(e){var t=this.$el.find("table");a.each(e.ck_data.split("\n"),function(e,i){""!==e&&t.append(this._renderRow(e))},this)}}),h=c.extend({initialize:function(e){c.prototype.initialize.call(this,e),scroll_elt=a.find(this.$el.parents(),function(e){return"auto"===r(e).css("overflow")}),scroll_elt||(scroll_elt=window),this.scroll_elt=r(scroll_elt)},scrolled_to_bottom:function(){return this.$el.height()-this.scroll_elt.scrollTop()-this.scroll_elt.height()<=0}}),u=c.extend({initialize:function(e){c.prototype.initialize.call(this,e),this.scroll_elt=this.$el.css({position:"relative",overflow:"scroll",height:e.height||"500px"})},scrolled_to_bottom:function(){return this.$el.scrollTop()+this.$el.innerHeight()>=this.el.scrollHeight}}),p=o.View.extend({col:{chrom:null,start:null,end:null},url_viz:null,dataset_id:null,genome_build:null,file_ext:null,initialize:function(e){function t(e,t){for(var i=0;i<t.length;i++)if(t[i].match(e))return i;return-1}var n=parent.Galaxy;if(n&&n.modal&&(this.modal=n.modal),n&&n.frame&&(this.frame=n.frame),this.modal&&this.frame){var s=e.model,o=s.get("metadata");if(s.get("file_ext")){if(this.file_ext=s.get("file_ext"),"bed"==this.file_ext){if(!(o.get("chromCol")&&o.get("startCol")&&o.get("endCol")))return void console.log("TabularButtonTrackster : Bed-file metadata incomplete.");this.col.chrom=o.get("chromCol")-1,this.col.start=o.get("startCol")-1,this.col.end=o.get("endCol")-1}if("vcf"==this.file_ext&&(this.col.chrom=t("Chrom",o.get("column_names")),this.col.start=t("Pos",o.get("column_names")),this.col.end=null,this.col.chrom==-1||this.col.start==-1))return void console.log("TabularButtonTrackster : VCF-file metadata incomplete.");if(void 0!==this.col.chrom){if(!s.id)return void console.log("TabularButtonTrackster : Dataset identification is missing.");if(this.dataset_id=s.id,!s.get("url_viz"))return void console.log("TabularButtonTrackster : Url for visualization controller is missing.");this.url_viz=s.get("url_viz"),s.get("genome_build")&&(this.genome_build=s.get("genome_build"));var a=new i.IconButtonView({model:new i.IconButton({title:"Visualize",icon_class:"chart_curve",id:"btn_viz"})});this.setElement(e.$el),this.$el.append(a.render().$el),this.hide()}}}},events:{"mouseover tr":"show",mouseleave:"hide"},show:function(e){function t(e){return!isNaN(parseFloat(e))&&isFinite(e)}if(null!==this.col.chrom){var i=r(e.target).parent(),n=i.children().eq(this.col.chrom).html(),s=i.children().eq(this.col.start).html(),o=this.col.end?i.children().eq(this.col.end).html():s;if(!n.match("^#")&&""!==n&&t(s)){var a={dataset_id:this.dataset_id,gene_region:n+":"+s+"-"+o},l=i.offset(),d=l.left-10,c=l.top-r(window).scrollTop()+3;r("#btn_viz").css({position:"fixed",top:c+"px",left:d+"px"}),r("#btn_viz").off("click"),r("#btn_viz").click(this.create_trackster_action(this.url_viz,a,this.genome_build)),r("#btn_viz").show()}else r("#btn_viz").hide()}},hide:function(){this.$el.find("#btn_viz").hide()},create_trackster_action:function(e,t,i){var n=this;return function(){var s={};return i&&(s["f-dbkey"]=i),r.ajax({url:e+"/list_tracks?"+r.param(s),dataType:"html",error:function(){n.modal.show({title:"Something went wrong!",body:"Unfortunately we could not add this dataset to the track browser. Please try again or contact us.",buttons:{Cancel:function(){n.modal.hide()}}})},success:function(i){n.modal.show({title:"View Data in a New or Saved Visualization",buttons:{Cancel:function(){n.modal.hide()},"View in saved visualization":function(){n.modal.show({title:"Add Data to Saved Visualization",body:i,buttons:{Cancel:function(){n.modal.hide()},"Add to visualization":function(){n.modal.hide(),n.modal.$el.find("input[name=id]:checked").each(function(){var i=r(this).val();t.id=i,n.frame.add({title:"Trackster",type:"url",content:e+"/trackster?"+r.param(t)})})}}})},"View in new visualization":function(){n.modal.hide(),n.frame.add({title:"Trackster",type:"url",content:e+"/trackster?"+r.param(t)})}}})}}),!1}}}),f=function(e){e.model||(e.model=new l(e.dataset_config));var t=e.parent_elt,i=e.embedded;delete e.embedded,delete e.parent_elt,delete e.dataset_config;var n=i?new u(e):new h(e);return n.render(),t&&(t.append(n.$el),n.expand_to_container()),n};return{Dataset:s,TabularDataset:l,DatasetCollection:d,TabularDatasetChunkedView:c,createTabularDatasetChunkedView:f}}.apply(t,n),!(void 0!==s&&(e.exports=s))}).call(t,i(3),i(2),i(1))},,function(e,t,i){var n,s;(function(i,o,a){n=[],s=function(){var e=i.Model.extend({defaults:{title:"",icon_class:"",on_click:null,menu_options:null,is_menu_button:!0,id:null,href:null,target:null,enabled:!0,visible:!0,tooltip_config:{}}}),t=i.View.extend({initialize:function(){this.model.attributes.tooltip_config={placement:"bottom"},this.model.bind("change",this.render,this)},render:function(){this.$el.tooltip("hide");var e=this.template(this.model.toJSON());return e.tooltip(this.model.get("tooltip_config")),this.$el.replaceWith(e),this.setElement(e),this},events:{click:"click"},click:function(e){return!o.isFunction(this.model.get("on_click"))||(this.model.get("on_click")(e),!1)},template:function(e){var t='title="'+e.title+'" class="icon-button';return e.is_menu_button&&(t+=" menu-button"),t+=" "+e.icon_class,e.enabled||(t+="_disabled"),t+='"',e.id&&(t+=' id="'+e.id+'"'),t+=' href="'+e.href+'"',e.target&&(t+=' target="'+e.target+'"'),e.visible||(t+=' style="display: none;"'),t=e.enabled?"<a "+t+"/>":"<span "+t+"/>",a(t)}}),n=i.Collection.extend({model:e}),s=i.View.extend({tagName:"div",initialize:function(){this.render()},render:function(){var e=this;return this.collection.each(function(t){var i=a("<a/>").attr("href","javascript:void(0)").attr("title",t.attributes.title).addClass("icon-button menu-button").addClass(t.attributes.icon_class).appendTo(e.$el).click(t.attributes.on_click);t.attributes.tooltip_config&&i.tooltip(t.attributes.tooltip_config);var n=t.get("options");n&&make_popupmenu(i,n)}),this}}),r=function(t,i){i||(i={});var a=new n(o.map(t,function(t){return new e(o.extend(t,i))}));return new s({collection:a})};return{IconButton:e,IconButtonView:t,IconButtonCollection:n,IconButtonMenuView:s,create_icon_buttons_menu:r}}.apply(t,n),!(void 0!==s&&(e.exports=s))}).call(t,i(3),i(2),i(1))},function(e,t,i){var n,s,o;!function(a){s=[i(1)],n=a,o="function"==typeof n?n.apply(t,s):n,!(void 0!==o&&(e.exports=o))}(function(e){"use_strict";var t=e;t.fn.make_text_editable=function(e){var i="num_cols"in e?e.num_cols:30,n="num_rows"in e?e.num_rows:4,s="use_textarea"in e&&e.use_textarea,o="on_finish"in e?e.on_finish:null,a="help_text"in e?e.help_text:null,r=t(this);return r.addClass("editable-text").click(function(a){if(!(t(this).children(":input").length>0)){r.removeClass("editable-text");var l,d,c=function(e){r.find(":input").remove(),""!==e?r.text(e):r.html("<br>"),r.addClass("editable-text"),o&&o(e)},h="cur_text"in e?e.cur_text:r.text();s?(l=t("<textarea/>").attr({rows:n,cols:i}).text(t.trim(h)).keyup(function(e){27===e.keyCode&&c(h)}),d=t("<button/>").text("Done").click(function(){return c(l.val()),!1})):l=t("<input type='text'/>").attr({value:t.trim(h),size:i}).blur(function(){c(h)}).keyup(function(e){27===e.keyCode?t(this).trigger("blur"):13===e.keyCode&&c(t(this).val()),e.stopPropagation()}),r.text(""),r.append(l),d&&r.append(d),l.focus(),l.select(),a.stopPropagation()}}),a&&r.attr("title",a).tooltip(),r}})},function(e,t,i){var n;(function(s,o){n=function(){function e(e){e+="";for(var t=/(\d+)(\d{3})/;t.test(e);)e=e.replace(t,"$1,$2");return e}var t=function(e){return"promise"in e},i=s.Model.extend({defaults:{ajax_settings:{},interval:1e3,success_fn:function(e){return!0}},go:function(){var e=o.Deferred(),t=this,i=t.get("ajax_settings"),n=t.get("success_fn"),s=t.get("interval"),a=function(){o.ajax(i).success(function(t){n(t)?e.resolve(t):setTimeout(a,s)})};return a(),e}}),n=function(e){e||(e="#ffffff"),"string"==typeof e&&(e=[e]);for(var t=0;t<e.length;t++)e[t]=parseInt(e[t].slice(1),16);var i,n,s,o,a,r,l,d,c,h,u,p=function(e,t,i){return(299*e+587*t+114*i)/1e3},f=function(e,t,i,n,s,o){return Math.max(e,n)-Math.min(e,n)+(Math.max(t,s)-Math.min(t,s))+(Math.max(i,o)-Math.min(i,o))},m=!1,g=0;do{for(i=Math.round(16777215*Math.random()),n=(16711680&i)>>16,s=(65280&i)>>8,o=255&i,c=p(n,s,o),m=!0,t=0;t<e.length;t++)if(a=e[t],r=(16711680&a)>>16,l=(65280&a)>>8,d=255&a,h=p(r,l,d),u=f(n,s,o,r,l,d),Math.abs(c-h)<40||u<200){m=!1;break}g++}while(!m&&g<=10);return"#"+(16777216+i).toString(16).substr(1,6)};return{commatize:e,is_deferred:t,ServerStateDeferred:i,get_random_color:n}}.call(t,i,t,e),!(void 0!==n&&(e.exports=n))}).call(t,i(3),i(1))},function(e,t,i){var n,s,o;(function(i,a){!function(i,a){s=[],n=a,o="function"==typeof n?n.apply(t,s):n,!(void 0!==o&&(e.exports=o))}(this,function(){var e=function(e){e=e||{},e.tooltipConfig=e.tooltipConfig||{placement:"bottom"},e.classes=["icon-btn"].concat(e.classes||[]),e.disabled&&e.classes.push("disabled");var t=['<a class="',e.classes.join(" "),'"',e.title?' title="'+e.title+'"':"",!e.disabled&&e.target?' target="'+e.target+'"':"",' href="',!e.disabled&&e.href?e.href:"javascript:void(0);",'">','<span class="fa ',e.faIcon,'"></span>',"</a>"].join(""),n=i(t).tooltip(e.tooltipConfig);return a.isFunction(e.onclick)&&n.click(e.onclick),n};return e})}).call(t,i(1),i(2))},,function(e,t,i){var n,s;(function(o,a,r){n=[i(5)],s=function(e){var t=o.View.extend({optionsDefault:{with_close:!0,title:null,placement:"top",container:"body",body:null},initialize:function(t){this.setElement(this._template()),this.uid=e.uid(),this.options=a.defaults(t||{},this.optionsDefault),this.options.container.parent().append(this.el),this.$title=this.$(".popover-title-label"),this.$close=this.$(".popover-close"),this.$body=this.$(".popover-content"),this.options.body&&this.append(this.options.body);var i=this;r("body").on("mousedown."+this.uid,function(e){i.visible&&!r(i.options.container).is(e.target)&&!r(i.el).is(e.target)&&0===r(i.el).has(e.target).length&&i.hide()})},render:function(){this.$title.html(this.options.title),this.$el.removeClass().addClass("ui-popover popover fade in").addClass(this.options.placement),this.$el.css(this._get_placement(this.options.placement));var e=this;this.options.with_close?this.$close.on("click",function(){e.hide()}).show():this.$close.off().hide()},title:function(e){void 0!==e&&(this.options.title=e,this.$title.html(e))},show:function(){this.render(),this.$el.show(),this.visible=!0},hide:function(){this.$el.hide(),this.visible=!1},append:function(e){this.$body.append(e)},empty:function(){this.$body.empty()},remove:function(){r("body").off("mousedown."+this.uid),this.$el.remove()},_get_placement:function(e){var t=this._get_width(this.$el),i=this.$el.height(),n=this.options.container,s=this._get_width(n),o=this._get_height(n),a=n.position(),r=left=0;if(["top","bottom"].indexOf(e)!=-1)switch(left=a.left-t+(s+t)/2,e){case"top":r=a.top-i-5;break;case"bottom":r=a.top+o+5}else switch(r=a.top-i+(o+i)/2,e){case"right":left=a.left+s}return{top:r,left:left}},_get_width:function(e){return e.width()+parseInt(e.css("padding-left"))+parseInt(e.css("margin-left"))+parseInt(e.css("padding-right"))+parseInt(e.css("margin-right"))},_get_height:function(e){return e.height()+parseInt(e.css("padding-top"))+parseInt(e.css("padding-bottom"))},_template:function(e){return'<div class="ui-popover popover fade in"><div class="arrow"/><div class="popover-title"><div class="popover-title-label"/><div class="popover-close fa fa-times-circle"/></div><div class="popover-content"/></div>'}});return{View:t}}.apply(t,n),!(void 0!==s&&(e.exports=s))}).call(t,i(3),i(2),i(1))},,function(e,t,i){var n,s;(function(o,a){n=[i(5)],s=function(e){var t=o.View.extend({optionsDefault:{css:"",placeholder:"No data available",data:[],value:null,multiple:!1,minimumInputLength:0,initialData:""},initialize:function(t){if(this.options=e.merge(t,this.optionsDefault),this.setElement(this._template(this.options)),!this.options.container)return void console.log("ui-select::initialize() : container not specified.");if(this.options.container.append(this.$el),this.select_data=this.options.data,this._refresh(),!this.options.multiple){this.options.value&&this._setValue(this.options.value);var i=this;this.options.onchange&&this.$el.on("change",function(){i.options.onchange(i.value())})}},value:function(e){var t=this._getValue();void 0!==e&&this._setValue(e);var i=this._getValue();return i!=t&&this.options.onchange&&this.options.onchange(i),i},text:function(){return this.$el.select2("data").text},disabled:function(){return!this.$el.select2("enable")},enable:function(){this.$el.select2("enable",!0)},disable:function(){this.$el.select2("enable",!1)},add:function(e){this.select_data.push({id:e.id,text:e.text}),this._refresh()},del:function(e){var t=this._getIndex(e);t!=-1&&(this.select_data.splice(t,1),this._refresh())},remove:function(){this.$el.select2("destroy")},update:function(e){this.select_data=[];for(var t in e.data)this.select_data.push(e.data[t]);this._refresh()},_refresh:function(){if(this.options.multiple){var e={multiple:this.options.multiple,containerCssClass:this.options.css,placeholder:this.options.placeholder,minimumInputLength:this.options.minimumInputLength,ajax:this.options.ajax,dropdownCssClass:this.options.dropdownCssClass,escapeMarkup:this.options.escapeMarkup,formatResult:this.options.formatResult,formatSelection:this.options.formatSelection,initSelection:this.options.initSelection,initialData:this.options.initialData};this.$el.select2(e)}else{var t=this._getValue(),e={data:this.select_data,containerCssClass:this.options.css,placeholder:this.options.placeholder,dropdownAutoWidth:!0};this.$el.select2(e),this._setValue(t)}},_getIndex:function(e){a.findIndex(this.select_data,{id:e})},_getValue:function(){return this.$el.select2("val")},_setValue:function(e){var t=this._getIndex(e);t==-1&&this.select_data.length>0&&(e=this.select_data[0].id),this.$el.select2("val",e)},_template:function(e){return'<input type="hidden" value="'+this.options.initialData+'"/>'}});return{View:t}}.apply(t,n),!(void 0!==s&&(e.exports=s))}).call(t,i(3),i(2))},function(e,t,i){var n,s;(function(o,a,r){n=[i(28),i(24),i(6),i(4)],s=function(e,t,i,n){"use strict";var s=e.FoldoutListItemView,l=e.ListItemView,d=s.extend({className:s.prototype.className+" dataset-collection",id:function(){return["dataset_collection",this.model.get("id")].join("-")},initialize:function(e){this.linkTarget=e.linkTarget||"_blank",this.hasUser=e.hasUser,s.prototype.initialize.call(this,e)},_setUpListeners:function(){s.prototype._setUpListeners.call(this),this.listenTo(this.model,"change",function(e,t){o.has(e.changed,"deleted")?this.render():o.has(e.changed,"element_count")&&this.$("> .title-bar .subtitle").replaceWith(this._renderSubtitle())})},_renderSubtitle:function(){return a(this.templates.subtitle(this.model.toJSON(),this))},_getFoldoutPanelOptions:function(){var e=s.prototype._getFoldoutPanelOptions.call(this);return o.extend(e,{linkTarget:this.linkTarget,hasUser:this.hasUser})},$selector:function(){return this.$("> .selector")},toString:function(){var e=this.model?this.model+"":"(no model)";return"DCListItemView("+e+")"}});d.prototype.templates=function(){var e=o.extend({},s.prototype.templates.warnings,{error:i.wrapTemplate(["<% if( model.error ){ %>",'<div class="errormessagesmall">',n("There was an error getting the data for this collection"),": <%- model.error %>","</div>","<% } %>"]),purged:i.wrapTemplate(["<% if( model.purged ){ %>",'<div class="purged-msg warningmessagesmall">',n("This collection has been deleted and removed from disk"),"</div>","<% } %>"]),deleted:i.wrapTemplate(["<% if( model.deleted && !model.purged ){ %>",'<div class="deleted-msg warningmessagesmall">',n("This collection has been deleted"),"</div>","<% } %>"])}),t=i.wrapTemplate(['<div class="title-bar clear" tabindex="0">','<div class="title">','<span class="name"><%- collection.element_identifier || collection.name %></span>',"</div>",'<div class="subtitle"></div>',"</div>"],"collection"),a=i.wrapTemplate(['<div class="subtitle">','<% var countText = collection.element_count? ( collection.element_count + " " ) : ""; %>','<%        if( collection.collection_type === "list" ){ %>',n("a list of <%- countText %>datasets"),'<% } else if( collection.collection_type === "paired" ){ %>',n("a pair of datasets"),'<% } else if( collection.collection_type === "list:paired" ){ %>',n("a list of <%- countText %>dataset pairs"),"<% } %>","</div>"],"collection");return o.extend({},s.prototype.templates,{warnings:e,titleBar:t,subtitle:a})}();var c=l.extend({className:l.prototype.className+" dataset-collection-element",initialize:function(e){e.logger&&(this.logger=this.model.logger=e.logger),this.log("DCEListItemView.initialize:",e),l.prototype.initialize.call(this,e)},toString:function(){var e=this.model?this.model+"":"(no model)";return"DCEListItemView("+e+")"}});c.prototype.templates=function(){var e=i.wrapTemplate(['<div class="title-bar clear" tabindex="0">','<div class="title">','<span class="name"><%- element.element_identifier %></span>',"</div>",'<div class="subtitle"></div>',"</div>"],"element");return o.extend({},l.prototype.templates,{titleBar:e})}();var h=t.DatasetListItemView.extend({className:t.DatasetListItemView.prototype.className+" dataset-collection-element",initialize:function(e){e.logger&&(this.logger=this.model.logger=e.logger),this.log("DatasetDCEListItemView.initialize:",e),t.DatasetListItemView.prototype.initialize.call(this,e)},_fetchModelDetails:function(){var e=this;return e.model.inReadyState()&&!e.model.hasDetails()?e.model.fetch({silent:!0}):r.when()},toString:function(){var e=this.model?this.model+"":"(no model)";return"DatasetDCEListItemView("+e+")"}});h.prototype.templates=function(){var e=i.wrapTemplate(['<div class="title-bar clear" tabindex="0">','<span class="state-icon"></span>','<div class="title">','<span class="name"><%- element.element_identifier %></span>',"</div>","</div>"],"element");return o.extend({},t.DatasetListItemView.prototype.templates,{titleBar:e})}();var u=d.extend({className:d.prototype.className+" dataset-collection-element",_swapNewRender:function(e){d.prototype._swapNewRender.call(this,e);var t=this.model.get("state")||"ok";return this.$el.addClass("state-"+t),this.$el},toString:function(){var e=this.model?this.model+"":"(no model)";return"NestedDCDCEListItemView("+e+")"}});return{DCListItemView:d,DCEListItemView:c,DatasetDCEListItemView:h,NestedDCDCEListItemView:u}}.apply(t,n),!(void 0!==s&&(e.exports=s))}).call(t,i(2),i(1),i(1))},function(e,t,i){var n,s;(function(o,a,r){n=[i(52),i(6),i(4)],s=function(e,t,i){"use strict";var n="collections",s={defaults:{model_class:"DatasetCollectionElement",element_identifier:null,element_index:null,element_type:null},_mergeObject:function(e){return o.extend(e,e.object,{element_id:e.id}),delete e.object,e},constructor:function(e,t){e=this._mergeObject(e),this.idAttribute="element_id",a.Model.apply(this,arguments)},parse:function(e,t){var i=e;return i=this._mergeObject(i)}},l=a.Model.extend(t.LoggableMixin).extend(s).extend({_logNamespace:n}),d=a.Collection.extend(t.LoggableMixin).extend({_logNamespace:n,model:l,initialize:function(e,t){this.debug(this+"(DCECollection).initialize:",e,t),t=t||{}},toString:function(){return["DatasetCollectionElementCollection(",this.length,")"].join("")}}),c=e.DatasetAssociation.extend(t.mixin(s,{url:function(){return this.has("history_id")?Galaxy.root+"api/histories/"+this.get("history_id")+"/contents/"+this.get("id"):(console.warn("no endpoint for non-hdas within a collection yet"),Galaxy.root+"api/datasets")},defaults:o.extend({},e.DatasetAssociation.prototype.defaults,s.defaults),constructor:function(e,t){this.debug("\t DatasetDCE.constructor:",e,t),s.constructor.call(this,e,t)},initialize:function(t,i){this.debug(this+"(DatasetDCE).initialize:",t,i),e.DatasetAssociation.prototype.initialize.call(this,t,i)},hasDetails:function(){return o.has(this.attributes,"annotation")},toString:function(){var e=this.get("element_identifier");return["DatasetDCE(",e,")"].join("")}})),h=d.extend({model:c,initialize:function(e,t){this.debug(this+"(DatasetDCECollection).initialize:",e,t),d.prototype.initialize.call(this,e,t)},toString:function(){return["DatasetDCECollection(",this.length,")"].join("")}}),u=a.Model.extend(t.LoggableMixin).extend(t.SearchableModelMixin).extend({_logNamespace:n,defaults:{collection_type:null,deleted:!1},collectionClass:d,initialize:function(e,t){this.debug(this+"(DatasetCollection).initialize:",e,t,this),this.elements=this._createElementsModel(),this.on("change:elements",function(){this.log("change:elements"),this.elements=this._createElementsModel()})},_createElementsModel:function(){this.debug(this+"._createElementsModel",this.collectionClass,this.get("elements"),this.elements);var e=this.get("elements")||[];return this.unset("elements",{silent:!0}),this.elements=new this.collectionClass(e),this.elements},toJSON:function(){var e=a.Model.prototype.toJSON.call(this);return this.elements&&(e.elements=this.elements.toJSON()),e},inReadyState:function(){var e=this.get("populated");return this.isDeletedOrPurged()||e},hasDetails:function(){return this.debug("hasDetails:",this.elements.length),0!==this.elements.length},getVisibleContents:function(e){return this.elements},"delete":function(e){return this.get("deleted")?r.when():this.save({deleted:!0},e)},undelete:function(e){return!this.get("deleted")||this.get("purged")?r.when():this.save({deleted:!1},e)},isDeletedOrPurged:function(){return this.get("deleted")||this.get("purged")},searchAttributes:["name"],toString:function(){var e=[this.get("id"),this.get("name")||this.get("element_identifier")];return"DatasetCollection("+e.join(",")+")"}}),p=u.extend({collectionClass:h,initialize:function(e,t){this.debug(this+"(ListDatasetCollection).initialize:",e,t),u.prototype.initialize.call(this,e,t)},toString:function(){return["ListDatasetCollection(",this.get("name"),")"].join("")}}),f=p.extend({initialize:function(e,t){this.debug(this+"(PairDatasetCollection).initialize:",e,t),p.prototype.initialize.call(this,e,t)},toString:function(){return["PairDatasetCollection(",this.get("name"),")"].join("")}}),m=u.extend(t.mixin(s,{constructor:function(e,t){this.debug("\t NestedDCDCE.constructor:",e,t),s.constructor.call(this,e,t)},toString:function(){var e=this.object?""+this.object:this.get("element_identifier");return["NestedDCDCE(",e,")"].join("")}})),g=d.extend({model:m,initialize:function(e,t){this.debug(this+"(NestedDCDCECollection).initialize:",e,t),d.prototype.initialize.call(this,e,t)},toString:function(){return["NestedDCDCECollection(",this.length,")"].join("")}}),v=f.extend(t.mixin(s,{constructor:function(e,t){this.debug("\t NestedPairDCDCE.constructor:",e,t),s.constructor.call(this,e,t)},toString:function(){var e=this.object?""+this.object:this.get("element_identifier");return["NestedPairDCDCE(",e,")"].join("")}})),_=g.extend({model:v,initialize:function(e,t){this.debug(this+"(NestedPairDCDCECollection).initialize:",e,t),g.prototype.initialize.call(this,e,t)},toString:function(){return["NestedPairDCDCECollection(",this.length,")"].join("")}}),w=u.extend({collectionClass:_,initialize:function(e,t){this.debug(this+"(ListPairedDatasetCollection).initialize:",e,t),u.prototype.initialize.call(this,e,t)},toString:function(){return["ListPairedDatasetCollection(",this.get("name"),")"].join("")}});return{ListDatasetCollection:p,PairDatasetCollection:f,ListPairedDatasetCollection:w}}.apply(t,n),!(void 0!==s&&(e.exports=s))}).call(t,i(2),i(3),i(1))},function(e,t,i){var n,s;(function(o,a,r,l){n=[i(25),i(8),i(6),i(9),i(69),i(4),i(66)],s=function(e,t,i,n,s,d){"use strict";function c(e){var t=e.toJSON(),i=m(t,{creationFn:function(t,i){return t=t.map(function(e){return{id:e.id,name:e.name,src:"dataset"===e.history_content_type?"hda":"hdca"}}),e.createHDCA(t,"list",i)}});return i}var h="collections",u=o.View.extend(i.LoggableMixin).extend({_logNamespace:h,tagName:"li",className:"collection-element",initialize:function(e){this.element=e.element||{},this.selected=e.selected||!1},render:function(){return this.$el.attr("data-element-id",this.element.id).attr("draggable",!0).html(this.template({element:this.element})),this.selected&&this.$el.addClass("selected"),this},template:a.template(['<a class="name" title="',d("Click to rename"),'" href="javascript:void(0)">',"<%- element.name %>","</a>",'<button class="discard btn btn-sm" title="',d("Remove this dataset from the list"),'">',d("Discard"),"</button>"].join("")),select:function(e){this.$el.toggleClass("selected",e),this.trigger("select",{source:this,selected:this.$el.hasClass("selected")})},discard:function(){var e=this,t=this.$el.parent().width();this.$el.animate({"margin-right":t},"fast",function(){e.trigger("discard",{source:e}),e.destroy()})},destroy:function(){this.off(),this.$el.remove()},events:{click:"_click","click .name":"_clickName","click .discard":"_clickDiscard",dragstart:"_dragstart",dragend:"_dragend",dragover:"_sendToParent",drop:"_sendToParent"},_click:function(e){e.stopPropagation(),this.select(e)},_clickName:function(e){e.stopPropagation(),e.preventDefault();var t=([d("Enter a new name for the element"),":\n(",d("Note that changing the name here will not rename the dataset"),")"].join(""),prompt(d("Enter a new name for the element")+":",this.element.name));t&&(this.element.name=t,this.render())},_clickDiscard:function(e){e.stopPropagation(),this.discard()},_dragstart:function(e){e.originalEvent&&(e=e.originalEvent),e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/plain",JSON.stringify(this.element)),this.$el.addClass("dragging"),this.$el.parent().trigger("collection-element.dragstart",[this])},_dragend:function(e){this.$el.removeClass("dragging"),this.$el.parent().trigger("collection-element.dragend",[this])},_sendToParent:function(e){this.$el.parent().trigger(e)},toString:function(){return"DatasetCollectionElementView()"}}),p=o.View.extend(i.LoggableMixin).extend({
_logNamespace:h,elementViewClass:u,collectionClass:e.HistoryListDatasetCollection,className:"list-collection-creator collection-creator flex-row-container",minElements:1,defaultAttributes:{creationFn:function(){throw new TypeError("no creation fn for creator")},oncreate:function(){},oncancel:function(){},autoscrollDist:24,highlightClr:"rgba( 64, 255, 255, 1.0 )"},initialize:function(e){this.metric("ListCollectionCreator.initialize",e);var t=this;a.each(this.defaultAttributes,function(i,n){i=e[n]||i,t[n]=i}),t.initialElements=e.elements||[],this._instanceSetUp(),this._elementsSetUp(),this._setUpBehaviors()},_instanceSetUp:function(){this.selectedIds={},this.$dragging=null,this.blocking=!1},_elementsSetUp:function(){this.invalidElements=[],this.workingElements=[],this.elementViews=[],this.workingElements=this.initialElements.slice(0),this._ensureElementIds(),this._validateElements(),this._mangleDuplicateNames(),this._sortElements()},_ensureElementIds:function(){return this.workingElements.forEach(function(e){e.hasOwnProperty("id")||(e.id=a.uniqueId())}),this.workingElements},_validateElements:function(){var e=this;return e.invalidElements=[],this.workingElements=this.workingElements.filter(function(t){var i=e._isElementInvalid(t);return i&&e.invalidElements.push({element:t,text:i}),!i}),this.workingElements},_isElementInvalid:function(e){return"dataset"!==e.history_content_type?d("is not a dataset"):e.state!==t.OK?d(a.contains(t.NOT_READY_STATES,e.state)?"hasn't finished running yet":"has errored, is paused, or is not accessible"):e.deleted||e.purged?d("has been deleted or purged"):null},_mangleDuplicateNames:function(){var e=900,t=1,i={};this.workingElements.forEach(function(n){for(var s=n.name;i.hasOwnProperty(s);)if(s=n.name+" ("+t+")",t+=1,t>=e)throw new Error("Safety hit in while loop - thats impressive");n.name=s,i[n.name]=!0})},_sortElements:function(e){},render:function(e,t){return this.workingElements.length<this.minElements?this._renderInvalid(e,t):(this.$el.empty().html(this.templates.main()),this._renderHeader(e),this._renderMiddle(e),this._renderFooter(e),this._addPluginComponents(),this.$(".collection-name").focus(),this.trigger("rendered",this),this)},_renderInvalid:function(e,t){return this.$el.empty().html(this.templates.invalidInitial({problems:this.invalidElements,elements:this.workingElements})),"function"==typeof this.oncancel&&this.$(".cancel-create.btn").show(),this.trigger("rendered",this),this},_renderHeader:function(e,t){var i=this.$(".header").empty().html(this.templates.header()).find(".help-content").prepend(r(this.templates.helpContent()));return this.invalidElements.length&&this._invalidElementsAlert(),i},_renderMiddle:function(e,t){var i=this.$(".middle").empty().html(this.templates.middle());return this._renderList(e),i},_renderFooter:function(e,t){var i=this.$(".footer").empty().html(this.templates.footer());return"function"==typeof this.oncancel&&this.$(".cancel-create.btn").show(),i},_addPluginComponents:function(){this.$(".help-content i").hoverhighlight(".collection-creator",this.highlightClr)},_invalidElementsAlert:function(){this._showAlert(this.templates.invalidElements({problems:this.invalidElements}),"alert-warning")},_validationWarning:function(e,t){var i="validation-warning";"name"===e&&(e=this.$(".collection-name").add(this.$(".collection-name-prompt")),this.$(".collection-name").focus().select()),t?(e=e||this.$("."+i),e.removeClass(i)):e.addClass(i)},_disableNameAndCreate:function(e){e=!!a.isUndefined(e)||e,e&&(this.$(".collection-name").prop("disabled",!0),this.$(".create-collection").toggleClass("disabled",!0))},$list:function(){return this.$(".collection-elements")},_renderClearSelected:function(){a.size(this.selectedIds)?this.$(".collection-elements-controls > .clear-selected").show():this.$(".collection-elements-controls > .clear-selected").hide()},_renderList:function(e,t){var i=this,n=l("<div/>"),s=i.$list();a.each(this.elementViews,function(e){e.destroy(),i.removeElementView(e)}),i.workingElements.forEach(function(e){var t=i._createElementView(e);n.append(t.$el)}),i._renderClearSelected(),s.empty().append(n.children()),a.invoke(i.elementViews,"render"),s.height()>s.css("max-height")?s.css("border-width","1px 0px 1px 0px"):s.css("border-width","0px")},_createElementView:function(e){var t=new this.elementViewClass({element:e,selected:a.has(this.selectedIds,e.id)});return this.elementViews.push(t),this._listenToElementView(t),t},_listenToElementView:function(e){var t=this;t.listenTo(e,{select:function(e){var i=e.source.element;e.selected?t.selectedIds[i.id]=!0:delete t.selectedIds[i.id],t.trigger("elements:select",e)},discard:function(e){t.trigger("elements:discard",e)}})},addElementView:function(e){},removeElementView:function(e){delete this.selectedIds[e.element.id],this._renderClearSelected(),this.elementViews=a.without(this.elementViews,e),this.stopListening(e)},_renderNoElementsLeft:function(){this._disableNameAndCreate(!0),this.$(".collection-elements").append(this.templates.noElementsLeft())},_elementToJSON:function(e){return e},createList:function(e){if(!this.workingElements.length){var t=d("No valid elements for final list")+". ";return t+='<a class="cancel-create" href="javascript:void(0);">'+d("Cancel")+"</a> ",t+=d("or"),t+=' <a class="reset" href="javascript:void(0);">'+d("start over")+"</a>.",void this._showAlert(t)}var i=this,n=this.workingElements.map(function(e){return i._elementToJSON(e)});return i.blocking=!0,i.creationFn(n,e).always(function(){i.blocking=!1}).fail(function(e,t,n){i.trigger("error",{xhr:e,status:t,message:d("An error occurred while creating this collection")})}).done(function(e,t,n){i.trigger("collection:created",e,t,n),i.metric("collection:created",e),"function"==typeof i.oncreate&&i.oncreate.call(this,e,t,n)})},_setUpBehaviors:function(){return this.on("error",this._errorHandler),this.once("rendered",function(){this.trigger("rendered:initial",this)}),this.on("elements:select",function(e){this._renderClearSelected()}),this.on("elements:discard",function(e){var t=e.source.element;this.removeElementView(e.source),this.workingElements=a.without(this.workingElements,t),this.workingElements.length||this._renderNoElementsLeft()}),this},_errorHandler:function(e){this.error(e);var t=this;if(content=e.message||d("An error occurred"),e.xhr){var i=e.xhr,n=e.message;0===i.readyState&&0===i.status?content+=": "+d("Galaxy could not be reached and may be updating.")+d(" Try again in a few minutes."):i.responseJSON?content+=":<br /><pre>"+JSON.stringify(i.responseJSON)+"</pre>":content+=": "+n}t._showAlert(content,"alert-danger")},events:{"click .more-help":"_clickMoreHelp","click .less-help":"_clickLessHelp","click .main-help":"_toggleHelp","click .header .alert button":"_hideAlert","click .reset":"reset","click .clear-selected":"clearSelectedElements","click .collection-elements":"clearSelectedElements","dragover .collection-elements":"_dragoverElements","drop .collection-elements":"_dropElements","collection-element.dragstart .collection-elements":"_elementDragstart","collection-element.dragend   .collection-elements":"_elementDragend","change .collection-name":"_changeName","keydown .collection-name":"_nameCheckForEnter","click .cancel-create":function(e){"function"==typeof this.oncancel&&this.oncancel.call(this)},"click .create-collection":"_clickCreate"},_clickMoreHelp:function(e){e.stopPropagation(),this.$(".main-help").addClass("expanded"),this.$(".more-help").hide()},_clickLessHelp:function(e){e.stopPropagation(),this.$(".main-help").removeClass("expanded"),this.$(".more-help").show()},_toggleHelp:function(e){e.stopPropagation(),this.$(".main-help").toggleClass("expanded"),this.$(".more-help").toggle()},_showAlert:function(e,t){t=t||"alert-danger",this.$(".main-help").hide(),this.$(".header .alert").attr("class","alert alert-dismissable").addClass(t).show().find(".alert-message").html(e)},_hideAlert:function(e){this.$(".main-help").show(),this.$(".header .alert").hide()},reset:function(){this._instanceSetUp(),this._elementsSetUp(),this.render()},clearSelectedElements:function(e){this.$(".collection-elements .collection-element").removeClass("selected"),this.$(".collection-elements-controls > .clear-selected").hide()},_dragoverElements:function(e){e.preventDefault();var t=this.$list();this._checkForAutoscroll(t,e.originalEvent.clientY);var i=this._getNearestElement(e.originalEvent.clientY);this.$(".element-drop-placeholder").remove();var n=r('<div class="element-drop-placeholder"></div>');i.length?i.before(n):t.append(n)},_checkForAutoscroll:function(e,t){var i=2,n=e.offset(),s=e.scrollTop(),o=t-n.top,a=n.top+e.outerHeight()-t;o>=0&&o<this.autoscrollDist?e.scrollTop(s-i):a>=0&&a<this.autoscrollDist&&e.scrollTop(s+i)},_getNearestElement:function(e){for(var t=4,i=this.$(".collection-elements li.collection-element").toArray(),n=0;n<i.length;n++){var s=r(i[n]),o=s.offset().top,a=Math.floor(s.outerHeight()/2)+t;if(o+a>e&&o-a<e)return s}return r()},_dropElements:function(e){e.originalEvent&&(e=e.originalEvent),e.preventDefault(),e.dataTransfer.dropEffect="move";var t=this._getNearestElement(e.clientY);return t.length?this.$dragging.insertBefore(t):this.$dragging.insertAfter(this.$(".collection-elements .collection-element").last()),this._syncOrderToDom(),!1},_syncOrderToDom:function(){var e=this,t=[];this.$(".collection-elements .collection-element").each(function(){var i=r(this).attr("data-element-id"),n=a.findWhere(e.workingElements,{id:i});n?t.push(n):console.error("missing element: ",i)}),this.workingElements=t,this._renderList()},_elementDragstart:function(e,t){t.select(!0),this.$dragging=this.$(".collection-elements .collection-element.selected")},_elementDragend:function(e,t){r(".element-drop-placeholder").remove(),this.$dragging=null},_changeName:function(e){this._validationWarning("name",!!this._getName())},_nameCheckForEnter:function(e){13!==e.keyCode||this.blocking||this._clickCreate()},_getName:function(){return a.escape(this.$(".collection-name").val())},_clickCreate:function(e){var t=this._getName();t?this.blocking||this.createList(t):this._validationWarning("name")},templates:{main:a.template(['<div class="header flex-row no-flex"></div>','<div class="middle flex-row flex-row-container"></div>','<div class="footer flex-row no-flex"></div>'].join("")),header:a.template(['<div class="main-help well clear">','<a class="more-help" href="javascript:void(0);">',d("More help"),"</a>",'<div class="help-content">','<a class="less-help" href="javascript:void(0);">',d("Less"),"</a>","</div>","</div>",'<div class="alert alert-dismissable">','<button type="button" class="close" data-dismiss="alert" ','title="',d("Close and show more help"),'" aria-hidden="true">&times;</button>','<span class="alert-message"></span>',"</div>"].join("")),middle:a.template(['<div class="collection-elements-controls">','<a class="reset" href="javascript:void(0);" ','title="',d("Undo all reordering and discards"),'">',d("Start over"),"</a>",'<a class="clear-selected" href="javascript:void(0);" ','title="',d("De-select all selected datasets"),'">',d("Clear selected"),"</a>","</div>",'<div class="collection-elements scroll-container flex-row">',"</div>"].join("")),footer:a.template(['<div class="attributes clear">','<div class="clear">','<input class="collection-name form-control pull-right" ','placeholder="',d("Enter a name for your new collection"),'" />','<div class="collection-name-prompt pull-right">',d("Name"),":</div>","</div>","</div>",'<div class="actions clear vertically-spaced">','<div class="other-options pull-left">','<button class="cancel-create btn" tabindex="-1">',d("Cancel"),"</button>",'<div class="create-other btn-group dropup">','<button class="btn btn-default dropdown-toggle" data-toggle="dropdown">',d("Create a different kind of collection"),' <span class="caret"></span>',"</button>",'<ul class="dropdown-menu" role="menu">','<li><a href="#">',d("Create a <i>single</i> pair"),"</a></li>",'<li><a href="#">',d("Create a list of <i>unpaired</i> datasets"),"</a></li>","</ul>","</div>","</div>",'<div class="main-options pull-right">','<button class="create-collection btn btn-primary">',d("Create list"),"</button>","</div>","</div>"].join("")),helpContent:a.template(["<p>",d(["Collections of datasets are permanent, ordered lists of datasets that can be passed to tools and ","workflows in order to have analyses done on each member of the entire group. This interface allows ","you to create a collection and re-order the final collection."].join("")),"</p>","<ul>","<li>",d(["Rename elements in the list by clicking on ",'<i data-target=".collection-element .name">the existing name</i>.'].join("")),"</li>","<li>",d(["Discard elements from the final created list by clicking on the ",'<i data-target=".collection-element .discard">"Discard"</i> button.'].join("")),"</li>","<li>",d(["Reorder the list by clicking and dragging elements. Select multiple elements by clicking on ",'<i data-target=".collection-element">them</i> and you can then move those selected by dragging the ',"entire group. Deselect them by clicking them again or by clicking the ",'the <i data-target=".clear-selected">"Clear selected"</i> link.'].join("")),"</li>","<li>",d(['Click the <i data-target=".reset">"Start over"</i> link to begin again as if you had just opened ',"the interface."].join("")),"</li>","<li>",d(['Click the <i data-target=".cancel-create">"Cancel"</i> button to exit the interface.'].join("")),"</li>","</ul><br />","<p>",d(['Once your collection is complete, enter a <i data-target=".collection-name">name</i> and ','click <i data-target=".create-collection">"Create list"</i>.'].join("")),"</p>"].join("")),invalidElements:a.template([d("The following selections could not be included due to problems:"),"<ul><% _.each( problems, function( problem ){ %>","<li><b><%- problem.element.name %></b>: <%- problem.text %></li>","<% }); %></ul>"].join("")),noElementsLeft:a.template(['<li class="no-elements-left-message">',d("No elements left! "),d("Would you like to "),'<a class="reset" href="javascript:void(0)">',d("start over"),"</a>?","</li>"].join("")),invalidInitial:a.template(['<div class="header flex-row no-flex">','<div class="alert alert-warning" style="display: block">','<span class="alert-message">',"<% if( _.size( problems ) ){ %>",d("The following selections could not be included due to problems"),":","<ul><% _.each( problems, function( problem ){ %>","<li><b><%- problem.element.name %></b>: <%- problem.text %></li>","<% }); %></ul>","<% } else if( _.size( elements ) < 1 ){ %>",d("No datasets were selected"),".","<% } %>","<br />",d("At least one element is needed for the collection"),". ",d("You may need to "),'<a class="cancel-create" href="javascript:void(0)">',d("cancel"),"</a> ",d("and reselect new elements"),".","</span>","</div>","</div>",'<div class="footer flex-row no-flex">','<div class="actions clear vertically-spaced">','<div class="other-options pull-left">','<button class="cancel-create btn" tabindex="-1">',d("Cancel"),"</button>","</div>","</div>","</div>"].join(""))},toString:function(){return"ListCollectionCreator"}}),f=function(e,t,i){var s,o=l.Deferred(),r=Galaxy.modal||new n.View;return t=a.defaults(t||{},{elements:e,oncancel:function(){r.hide(),o.reject("cancelled")},oncreate:function(e,t){r.hide(),o.resolve(t)}}),s=new i(t),r.show({title:t.title||d("Create a collection"),body:s.$el,width:"80%",height:"100%",closing_events:!0}),s.render(),window._collectionCreator=s,o},m=function(e,t){return t=t||{},t.title=d("Create a collection from a list of datasets"),f(e,t,p)};return{DatasetCollectionElementView:u,ListCollectionCreator:p,collectionCreatorModal:f,listCollectionCreatorModal:m,createListCollection:c}}.apply(t,n),!(void 0!==s&&(e.exports=s))}).call(t,i(3),i(2),i(1),i(1))},function(e,t,i){var n,s;(function(o,a,r,l){n=[i(28),i(8),i(16),i(6),i(4)],s=function(e,t,i,n,s){"use strict";var d="dataset",c=e.ListItemView,h=c.extend({_logNamespace:d,className:c.prototype.className+" dataset",id:function(){return["dataset",this.model.get("id")].join("-")},initialize:function(e){e.logger&&(this.logger=this.model.logger=e.logger),this.log(this+".initialize:",e),c.prototype.initialize.call(this,e),this.linkTarget=e.linkTarget||"_blank"},_setUpListeners:function(){c.prototype._setUpListeners.call(this),this.listenTo(this.model,"change",function(e,t){this.model.changedAttributes().state&&this.model.inReadyState()&&this.expanded&&!this.model.hasDetails()?this.model.fetch():this.render()})},_fetchModelDetails:function(){var e=this;return e.model.inReadyState()&&!e.model.hasDetails()?e.model.fetch({silent:!0}):o.when()},remove:function(e,t){var i=this;e=e||this.fxSpeed,this.$el.fadeOut(e,function(){a.View.prototype.remove.call(i),t&&t.call(i)})},render:function(e){return c.prototype.render.call(this,e)},_swapNewRender:function(e){return c.prototype._swapNewRender.call(this,e),this.model.has("state")&&this.$el.addClass("state-"+this.model.get("state")),this.$el},_renderPrimaryActions:function(){return[this._renderDisplayButton()]},_renderDisplayButton:function(){var e=this.model.get("state");if(e===t.NOT_VIEWABLE||e===t.DISCARDED||!this.model.get("accessible"))return null;var n={target:this.linkTarget,classes:"display-btn"};if(this.model.get("purged"))n.disabled=!0,n.title=s("Cannot display datasets removed from disk");else if(e===t.UPLOAD)n.disabled=!0,n.title=s("This dataset must finish uploading before it can be viewed");else if(e===t.NEW)n.disabled=!0,n.title=s("This dataset is not yet viewable");else{n.title=s("View data"),n.href=this.model.urls.display;var o=this;n.onclick=function(e){Galaxy.frame&&Galaxy.frame.active&&(Galaxy.frame.addDataset(o.model.get("id")),e.preventDefault())}}return n.faIcon="fa-eye",i(n)},_renderDetails:function(){if(this.model.get("state")===t.NOT_VIEWABLE)return r(this.templates.noAccess(this.model.toJSON(),this));var e=c.prototype._renderDetails.call(this);return e.find(".actions .left").empty().append(this._renderSecondaryActions()),e.find(".summary").html(this._renderSummary()).prepend(this._renderDetailMessages()),e.find(".display-applications").html(this._renderDisplayApplications()),this._setUpBehaviors(e),e},_renderSummary:function(){var e=this.model.toJSON(),t=this.templates.summaries[e.state];return(t=t||this.templates.summaries.unknown)(e,this)},_renderDetailMessages:function(){var e=this,t=r('<div class="detail-messages"></div>'),i=e.model.toJSON();return l.each(e.templates.detailMessages,function(n){t.append(r(n(i,e)))}),t},_renderDisplayApplications:function(){return this.model.isDeletedOrPurged()?"":[this.templates.displayApplications(this.model.get("display_apps"),this),this.templates.displayApplications(this.model.get("display_types"),this)].join("")},_renderSecondaryActions:function(){switch(this.debug("_renderSecondaryActions"),this.model.get("state")){case t.NOT_VIEWABLE:return[];case t.OK:case t.FAILED_METADATA:case t.ERROR:return[this._renderDownloadButton(),this._renderShowParamsButton()]}return[this._renderShowParamsButton()]},_renderShowParamsButton:function(){return i({title:s("View details"),classes:"params-btn",href:this.model.urls.show_params,target:this.linkTarget,faIcon:"fa-info-circle"})},_renderDownloadButton:function(){return this.model.get("purged")||!this.model.hasData()?null:l.isEmpty(this.model.get("meta_files"))?r(['<a class="download-btn icon-btn" href="',this.model.urls.download,'" title="'+s("Download")+'" download>','<span class="fa fa-floppy-o"></span>',"</a>"].join("")):this._renderMetaFileDownloadButton()},_renderMetaFileDownloadButton:function(){var e=this.model.urls;return r(['<div class="metafile-dropdown dropdown">','<a class="download-btn icon-btn" href="javascript:void(0)" data-toggle="dropdown"',' title="'+s("Download")+'">','<span class="fa fa-floppy-o"></span>',"</a>",'<ul class="dropdown-menu" role="menu" aria-labelledby="dLabel">','<li><a href="'+e.download+'" download>',s("Download dataset"),"</a></li>",l.map(this.model.get("meta_files"),function(t){return['<li><a href="',e.meta_download+t.file_type,'">',s("Download")," ",t.file_type,"</a></li>"].join("")}).join("\n"),"</ul>","</div>"].join("\n"))},events:l.extend(l.clone(c.prototype.events),{"click .display-btn":function(e){this.trigger("display",this,e)},"click .params-btn":function(e){this.trigger("params",this,e)},"click .download-btn":function(e){this.trigger("download",this,e)}}),toString:function(){var e=this.model?this.model+"":"(no model)";return"DatasetListItemView("+e+")"}});return h.prototype.templates=function(){var e=l.extend({},c.prototype.templates.warnings,{failed_metadata:n.wrapTemplate(['<% if( model.state === "failed_metadata" ){ %>','<div class="warningmessagesmall">',s("An error occurred setting the metadata for this dataset"),"</div>","<% } %>"]),error:n.wrapTemplate(["<% if( model.error ){ %>",'<div class="errormessagesmall">',s("There was an error getting the data for this dataset"),": <%- model.error %>","</div>","<% } %>"]),purged:n.wrapTemplate(["<% if( model.purged ){ %>",'<div class="purged-msg warningmessagesmall">',s("This dataset has been deleted and removed from disk"),"</div>","<% } %>"]),deleted:n.wrapTemplate(["<% if( model.deleted && !model.purged ){ %>",'<div class="deleted-msg warningmessagesmall">',s("This dataset has been deleted"),"</div>","<% } %>"])}),i=n.wrapTemplate(['<div class="details">','<div class="summary"></div>','<div class="actions clear">','<div class="left"></div>','<div class="right"></div>',"</div>","<% if( !dataset.deleted && !dataset.purged ){ %>",'<div class="tags-display"></div>','<div class="annotation-display"></div>','<div class="display-applications"></div>',"<% if( dataset.peek ){ %>",'<pre class="dataset-peek"><%= dataset.peek %></pre>',"<% } %>","<% } %>","</div>"],"dataset"),o=n.wrapTemplate(['<div class="details">','<div class="summary">',s("You do not have permission to view this dataset"),"</div>","</div>"],"dataset"),a={};a[t.OK]=a[t.FAILED_METADATA]=n.wrapTemplate(["<% if( dataset.misc_blurb ){ %>",'<div class="blurb">','<span class="value"><%- dataset.misc_blurb %></span>',"</div>","<% } %>","<% if( dataset.file_ext ){ %>",'<div class="datatype">','<label class="prompt">',s("format"),"</label>",'<span class="value"><%- dataset.file_ext %></span>',"</div>","<% } %>","<% if( dataset.metadata_dbkey ){ %>",'<div class="dbkey">','<label class="prompt">',s("database"),"</label>",'<span class="value">',"<%- dataset.metadata_dbkey %>","</span>","</div>","<% } %>","<% if( dataset.misc_info ){ %>",'<div class="info">','<span class="value"><%- dataset.misc_info %></span>',"</div>","<% } %>"],"dataset"),a[t.NEW]=n.wrapTemplate(["<div>",s("This is a new dataset and not all of its data are available yet"),"</div>"],"dataset"),a[t.NOT_VIEWABLE]=n.wrapTemplate(["<div>",s("You do not have permission to view this dataset"),"</div>"],"dataset"),a[t.DISCARDED]=n.wrapTemplate(["<div>",s("The job creating this dataset was cancelled before completion"),"</div>"],"dataset"),a[t.QUEUED]=n.wrapTemplate(["<div>",s("This job is waiting to run"),"</div>"],"dataset"),a[t.RUNNING]=n.wrapTemplate(["<div>",s("This job is currently running"),"</div>"],"dataset"),a[t.UPLOAD]=n.wrapTemplate(["<div>",s("This dataset is currently uploading"),"</div>"],"dataset"),a[t.SETTING_METADATA]=n.wrapTemplate(["<div>",s("Metadata is being auto-detected"),"</div>"],"dataset"),a[t.PAUSED]=n.wrapTemplate(["<div>",s('This job is paused. Use the "Resume Paused Jobs" in the history menu to resume'),"</div>"],"dataset"),a[t.ERROR]=n.wrapTemplate(["<% if( !dataset.purged ){ %>","<div><%- dataset.misc_blurb %></div>","<% } %>",'<span class="help-text">',s("An error occurred with this dataset"),":</span>",'<div class="job-error-text"><%- dataset.misc_info %></div>'],"dataset"),a[t.EMPTY]=n.wrapTemplate(["<div>",s("No data"),": <i><%- dataset.misc_blurb %></i></div>"],"dataset"),a.unknown=n.wrapTemplate(['<div>Error: unknown dataset state: "<%- dataset.state %>"</div>'],"dataset");var r={resubmitted:n.wrapTemplate(["<% if( model.resubmitted ){ %>",'<div class="resubmitted-msg infomessagesmall">',s("The job creating this dataset has been resubmitted"),"</div>","<% } %>"])},d=n.wrapTemplate(["<% _.each( apps, function( app ){ %>",'<div class="display-application">','<span class="display-application-location"><%- app.label %></span> ','<span class="display-application-links">',"<% _.each( app.links, function( link ){ %>",'<a target="<%- link.target %>" href="<%- link.href %>">',"<% print( _l( link.text ) ); %>","</a> ","<% }); %>","</span>","</div>","<% }); %>"],"apps");return l.extend({},c.prototype.templates,{warnings:e,details:i,noAccess:o,summaries:a,detailMessages:r,displayApplications:d})}(),{DatasetListItemView:h}}.apply(t,n),!(void 0!==s&&(e.exports=s))}).call(t,i(1),i(3),i(1),i(2))},function(e,t,i){var n,s;(function(o){n=[i(22),i(26),i(4)],s=function(e,t,i){"use strict";function n(e){return function(t,i){return this.isNew()&&(i=i||{},i.url=this.urlRoot+this.get("history_id")+"/contents",t=t||{},t.type="dataset_collection"),e.call(this,t,i)}}var s=t.HistoryContentMixin,a=e.ListDatasetCollection,r=e.PairDatasetCollection,l=e.ListPairedDatasetCollection,d=a.extend(s).extend({defaults:o.extend(o.clone(a.prototype.defaults),{history_content_type:"dataset_collection",collection_type:"list",model_class:"HistoryDatasetCollectionAssociation"}),initialize:function(e,t){a.prototype.initialize.call(this,e,t),s.initialize.call(this,e,t)},save:n(a.prototype.save),toString:function(){return["HistoryListDatasetCollection(",this.get("name"),")"].join("")}}),c=r.extend(s).extend({defaults:o.extend(o.clone(r.prototype.defaults),{history_content_type:"dataset_collection",collection_type:"paired",model_class:"HistoryDatasetCollectionAssociation"}),initialize:function(e,t){r.prototype.initialize.call(this,e,t),s.initialize.call(this,e,t)},save:n(r.prototype.save),toString:function(){return["HistoryPairDatasetCollection(",this.get("name"),")"].join("")}}),h=l.extend(s).extend({defaults:o.extend(o.clone(l.prototype.defaults),{history_content_type:"dataset_collection",collection_type:"list:paired",model_class:"HistoryDatasetCollectionAssociation"}),initialize:function(e,t){l.prototype.initialize.call(this,e,t),s.initialize.call(this,e,t)},save:n(l.prototype.save),toString:function(){return["HistoryListPairedDatasetCollection(",this.get("name"),")"].join("")}});return{HistoryListDatasetCollection:d,HistoryPairDatasetCollection:c,HistoryListPairedDatasetCollection:h}}.apply(t,n),!(void 0!==s&&(e.exports=s))}).call(t,i(2))},function(e,t,i){var n,s;(function(o,a){n=[i(8),i(6),i(4)],s=function(e,t,i){"use strict";var n="history",s=function(e,t){return[e,t].join("-")},r={defaults:{history_id:null,history_content_type:null,hid:null,visible:!0},idAttribute:"type_id",constructor:function(e,t){e.type_id=s(e.history_content_type,e.id),this.debug("HistoryContentMixin.constructor:",e.type_id),o.Model.apply(this,arguments)},_typeIdStr:function(){return s(this.get("history_content_type"),this.get("id"))},initialize:function(e,t){this.on("change:id",this._createTypeId)},_createTypeId:function(){this.set("type_id",this._typeIdStr())},isNew:function(){return!this.get("id")},hidden:function(){return!this.get("visible")},isVisible:function(e,t){var i=!0;return e||!this.get("deleted")&&!this.get("purged")||(i=!1),t||this.get("visible")||(i=!1),i},urlRoot:Galaxy.root+"api/histories/",url:function(){var e=this.urlRoot+this.get("history_id")+"/contents/"+this.get("history_content_type")+"s/"+this.get("id");return e},hide:function(e){return this.get("visible")?this.save({visible:!1},e):a.when()},unhide:function(e){return this.get("visible")?a.when():this.save({visible:!0},e)},toString:function(){var e=this.get("id")||"";return this.get("name")&&(e=this.get("hid")+' :"'+this.get("name")+'",'+e),"HistoryContent("+e+")"}},l=o.Model.extend(t.LoggableMixin).extend(r).extend({_logNamespace:n});return{typeIdStr:s,HistoryContentMixin:r,HistoryContent:l}}.apply(t,n),!(void 0!==s&&(e.exports=s))}).call(t,i(3),i(1))},function(e,t,i){var n,s;(function(o,a,r){n=[i(26),i(54),i(25),i(8),i(6),i(4)],s=function(e,t,i,n,s,l){"use strict";var d="history",c=o.Collection.extend(s.LoggableMixin).extend({_logNamespace:d,model:function(e,n){if("dataset"===e.history_content_type)return new t.HistoryDatasetAssociation(e,n);if("dataset_collection"===e.history_content_type){switch(e.collection_type){case"list":return new i.HistoryListDatasetCollection(e,n);case"paired":return new i.HistoryPairDatasetCollection(e,n);case"list:paired":return new i.HistoryListPairedDatasetCollection(e,n)}return{validationError:"Unknown collection_type: "+e.history_content_type}}return{validationError:"Unknown history_content_type: "+e.history_content_type}},initialize:function(e,t){t=t||{},this.historyId=t.historyId,this.model.prototype.idAttribute="type_id",this.on("all",function(){this.debug(this+".event:",arguments)})},urlRoot:Galaxy.root+"api/histories",url:function(){return this.urlRoot+"/"+this.historyId+"/contents"},ids:function(){return this.map(function(e){return e.get("id")})},notReady:function(){return this.filter(function(e){return!e.inReadyState()})},running:function(){function e(e){return!e.inReadyState()}return new c(this.filter(e))},getByHid:function(e){return a.first(this.filter(function(t){return t.get("hid")===e}))},getVisible:function(e,t,i){i=i||[],this.debug("checking isVisible");var n=new c(this.filter(function(i){return i.isVisible(e,t)}));return a.each(i,function(e){a.isFunction(e)&&(n=new c(n.filter(e)))}),n},hidden:function(){function e(e){return e.hidden()}return new c(this.filter(e))},deleted:function(){function e(e){return e.get("deleted")}return new c(this.filter(e))},visibleAndUndeleted:function(){function e(e){return e.get("visible")&&!e.get("deleted")}return new c(this.filter(e))},haveDetails:function(){return this.all(function(e){return e.hasDetails()})},fetch:function(e){return e=e||{},e.data=a.defaults(e.data||{},{v:"dev"}),o.Collection.prototype.fetch.call(this,e)},fetchUpdated:function(e,t){return t=t||{},t.traditional=!0,t.data=[{name:"v",value:"dev"}],e&&(t.data=t.data.concat(this._filtersFromMap({"update_time-ge":e.toISOString()}))),t.merge=!0,t.remove=!1,this.fetch(t)},_filtersFromMap:function(e){var t=[];return a.each(e,function(e,i){t.push({name:"q",value:i}),t.push({name:"qv",value:e})}),t},fetchAllDetails:function(e){e=e||{};var t={details:"all"};return e.data=e.data?a.extend(e.data,t):t,this.fetch(e)},fetchCollectionCounts:function(e){return e=e||{},e.data=a.defaults({keys:["type_id","element_count"].join(","),q:"history_content_type",qv:"dataset_collection"},e.data||{}),e.merge=!0,e.remove=!1,this.fetch(e)},ajaxQueue:function(e,t){var i=r.Deferred(),n=this.length,s=[];if(!n)return i.resolve([]),i;var o=this.chain().reverse().map(function(a,r){return function(){var l=e.call(a,t);l.done(function(e){i.notify({curr:r,total:n,response:e,model:a})}),l.always(function(e){s.push(e),o.length?o.shift()():i.resolve(s)})}}).value();return o.shift()(),i},isCopyable:function(e){var t=["HistoryDatasetAssociation","HistoryDatasetCollectionAssociation"];return a.isObject(e)&&e.id&&a.contains(t,e.model_class)},copy:function(e){var t,i,n;a.isString(e)?(t=e,n="hda",i="dataset"):(t=e.id,n={HistoryDatasetAssociation:"hda",LibraryDatasetDatasetAssociation:"ldda",HistoryDatasetCollectionAssociation:"hdca"}[e.model_class]||"hda",i="hdca"===n?"dataset_collection":"dataset");var s=this,o=r.post(this.url(),{content:t,source:n,type:i}).done(function(e){s.add([e])}).fail(function(e,a,r){s.trigger("error",s,o,{},"Error copying contents",{type:i,id:t,source:n})});return o},matches:function(e){return this.filter(function(t){return t.matches(e)})},createHDCA:function(e,t,n,s){var o=this,a={list:i.HistoryListDatasetCollection,paired:i.HistoryPairDatasetCollection},r=new a[t]({history_id:this.historyId,name:n,element_identifiers:e});return r.save().done(function(e){
o.add(r)}).fail(function(e,t,i){o.trigger("error",e,t,i)})},clone:function(){var e=o.Collection.prototype.clone.call(this);return e.historyId=this.historyId,e},print:function(){var e=this;e.each(function(t){e.debug(t),t.elements&&e.debug("\t elements:",t.elements)})},toString:function(){return["HistoryContents(",[this.historyId,this.length].join(),")"].join("")}});return{HistoryContents:c}}.apply(t,n),!(void 0!==s&&(e.exports=s))}).call(t,i(3),i(2),i(1))},function(e,t,i){var n,s;(function(o,a,r,l){n=[i(6),i(4)],s=function(e,t){"use strict";var i="list",n=o.View.extend(e.LoggableMixin).extend({_logNamespace:i,initialize:function(e){this.expanded=e.expanded||!1,this.log("\t expanded:",this.expanded),this.fxSpeed=void 0!==e.fxSpeed?e.fxSpeed:this.fxSpeed},fxSpeed:"fast",render:function(e){var t=this._buildNewRender();return this._setUpBehaviors(t),this._queueNewRender(t,e),this},_buildNewRender:function(){var e=a(this.templates.el(this.model.toJSON(),this));return this.expanded&&this.$details(e).replaceWith(this._renderDetails().show()),e},_queueNewRender:function(e,t){t=void 0===t?this.fxSpeed:t;var i=this;a(i).queue("fx",[function(e){this.$el.fadeOut(t,e)},function(t){i._swapNewRender(e),t()},function(e){this.$el.fadeIn(t,e)},function(e){this.trigger("rendered",i),e()}])},_swapNewRender:function(e){return this.$el.empty().attr("class",r.isFunction(this.className)?this.className():this.className).append(e.children())},_setUpBehaviors:function(e){e=e||this.$el,e.find("[title]").tooltip({placement:"bottom"})},$details:function(e){return e=e||this.$el,e.find("> .details")},_renderDetails:function(){var e=a(this.templates.details(this.model.toJSON(),this));return this._setUpBehaviors(e),e},toggleExpanded:function(e){return e=void 0===e?!this.expanded:e,e?this.expand():this.collapse(),this},expand:function(){var e=this;return e._fetchModelDetails().always(function(){e._expand()})},_fetchModelDetails:function(){return this.model.hasDetails()?l.when():this.model.fetch()},_expand:function(){var e=this,t=e._renderDetails();e.$details().replaceWith(t),e.expanded=!0,e.$details().slideDown({duration:e.fxSpeed,step:function(){e.trigger("expanding",e)},complete:function(){e.trigger("expanded",e)}})},collapse:function(){this.debug(this+"(ExpandableView).collapse");var e=this;e.expanded=!1,this.$details().slideUp({duration:e.fxSpeed,step:function(){e.trigger("collapsing",e)},complete:function(){e.trigger("collapsed",e)}})}}),s=n.extend(e.mixin(e.SelectableViewMixin,e.DraggableViewMixin,{tagName:"div",className:"list-item",initialize:function(t){n.prototype.initialize.call(this,t),e.SelectableViewMixin.initialize.call(this,t),e.DraggableViewMixin.initialize.call(this,t),this._setUpListeners()},_setUpListeners:function(){return this.on("selectable",function(e){e?this.$(".primary-actions").hide():this.$(".primary-actions").show()},this),this},_buildNewRender:function(){var e=n.prototype._buildNewRender.call(this);return e.children(".warnings").replaceWith(this._renderWarnings()),e.children(".title-bar").replaceWith(this._renderTitleBar()),e.children(".primary-actions").append(this._renderPrimaryActions()),e.find("> .title-bar .subtitle").replaceWith(this._renderSubtitle()),e},_swapNewRender:function(e){return n.prototype._swapNewRender.call(this,e),this.selectable&&this.showSelector(0),this.draggable&&this.draggableOn(),this.$el},_renderWarnings:function(){var e=this,t=a('<div class="warnings"></div>'),i=e.model.toJSON();return r.each(e.templates.warnings,function(n){t.append(a(n(i,e)))}),t},_renderTitleBar:function(){return a(this.templates.titleBar(this.model.toJSON(),this))},_renderPrimaryActions:function(){return[]},_renderSubtitle:function(){return a(this.templates.subtitle(this.model.toJSON(),this))},events:{"click .title-bar":"_clickTitleBar","keydown .title-bar":"_keyDownTitleBar","click .selector":"toggleSelect"},_clickTitleBar:function(e){e.stopPropagation(),e.altKey?(this.toggleSelect(e),this.selectable||this.showSelector()):this.toggleExpanded()},_keyDownTitleBar:function(e){var t=32,i=13;return!e||"keydown"!==e.type||e.keyCode!==t&&e.keyCode!==i||(this.toggleExpanded(),e.stopPropagation(),!1)},toString:function(){var e=this.model?this.model+"":"(no model)";return"ListItemView("+e+")"}}));s.prototype.templates=function(){var t=e.wrapTemplate(['<div class="list-element">','<div class="warnings"></div>','<div class="selector">','<span class="fa fa-2x fa-square-o"></span>',"</div>",'<div class="primary-actions"></div>','<div class="title-bar"></div>','<div class="details"></div>',"</div>"]),i={},n=e.wrapTemplate(['<div class="title-bar clear" tabindex="0">','<span class="state-icon"></span>','<div class="title">','<span class="name"><%- element.name %></span>',"</div>",'<div class="subtitle"></div>',"</div>"],"element"),s=e.wrapTemplate(['<div class="subtitle"></div>']),o=e.wrapTemplate(['<div class="details"></div>']);return{el:t,warnings:i,titleBar:n,subtitle:s,details:o}}();var d=s.extend({foldoutStyle:"foldout",foldoutPanelClass:null,initialize:function(e){"drilldown"===this.foldoutStyle&&(this.expanded=!1),this.foldoutStyle=e.foldoutStyle||this.foldoutStyle,this.foldoutPanelClass=e.foldoutPanelClass||this.foldoutPanelClass,s.prototype.initialize.call(this,e),this.foldout=this._createFoldoutPanel()},_renderDetails:function(){if("drilldown"===this.foldoutStyle)return a();var e=s.prototype._renderDetails.call(this);return this._attachFoldout(this.foldout,e)},_createFoldoutPanel:function(){var e=this.model,t=this._getFoldoutPanelClass(e),i=this._getFoldoutPanelOptions(e),n=new t(r.extend(i,{model:e}));return n},_getFoldoutPanelClass:function(){return this.foldoutPanelClass},_getFoldoutPanelOptions:function(){return{foldoutStyle:this.foldoutStyle,fxSpeed:this.fxSpeed}},_attachFoldout:function(e,t){return t=t||this.$("> .details"),this.foldout=e.render(0),e.$("> .controls").hide(),t.append(e.$el)},expand:function(){var e=this;return e._fetchModelDetails().always(function(){"foldout"===e.foldoutStyle?e._expand():"drilldown"===e.foldoutStyle&&e._expandByDrilldown()})},_expandByDrilldown:function(){var e=this;e.listenTo(e.foldout,"close",function(){e.trigger("collapsed:drilldown",e,e.foldout)}),e.trigger("expanded:drilldown",e,e.foldout)}});return d.prototype.templates=function(){var t=e.wrapTemplate(['<div class="details">',"</div>"],"collection");return r.extend({},s.prototype.templates,{details:t})}(),{ExpandableView:n,ListItemView:s,FoldoutListItemView:d}}.apply(t,n),!(void 0!==s&&(e.exports=s))}).call(t,i(3),i(1),i(2),i(1))},function(e,t,i){var n,s;(function(o,a){n=[i(2),i(15),i(11),i(12)],s=function(e,t,i,n){"use strict";var s={hidden:!1,show:function(){this.set("hidden",!1)},hide:function(){this.set("hidden",!0)},toggle:function(){this.set("hidden",!this.get("hidden"))},is_visible:function(){return!this.attributes.hidden}},r=o.Model.extend({defaults:{name:null,label:null,type:null,value:null,html:null,num_samples:5},initialize:function(e){this.attributes.html=unescape(this.attributes.html)},copy:function(){return new r(this.toJSON())},set_value:function(e){this.set("value",e||"")}}),l=o.Collection.extend({model:r}),d=r.extend({}),c=r.extend({set_value:function(e){this.set("value",parseInt(e,10))},get_samples:function(){return d3.scale.linear().domain([this.get("min"),this.get("max")]).ticks(this.get("num_samples"))}}),h=c.extend({set_value:function(e){this.set("value",parseFloat(e))}}),u=r.extend({get_samples:function(){return e.map(this.get("options"),function(e){return e[0]})}});r.subModelTypes={integer:c,"float":h,data:d,select:u};var p=o.Model.extend({defaults:{id:null,name:null,description:null,target:null,inputs:[],outputs:[]},urlRoot:Galaxy.root+"api/tools",initialize:function(t){this.set("inputs",new l(e.map(t.inputs,function(e){var t=r.subModelTypes[e.type]||r;return new t(e)})))},toJSON:function(){var e=o.Model.prototype.toJSON.call(this);return e.inputs=this.get("inputs").map(function(e){return e.toJSON()}),e},remove_inputs:function(e){var t=this,i=t.get("inputs").filter(function(t){return e.indexOf(t.get("type"))!==-1});t.get("inputs").remove(i)},copy:function(e){var t=new p(this.toJSON());if(e){var i=new o.Collection;t.get("inputs").each(function(e){e.get_samples()&&i.push(e)}),t.set("inputs",i)}return t},apply_search_results:function(t){return e.indexOf(t,this.attributes.id)!==-1?this.show():this.hide(),this.is_visible()},set_input_value:function(e,t){this.get("inputs").find(function(t){return t.get("name")===e}).set("value",t)},set_input_values:function(t){var i=this;e.each(e.keys(t),function(e){i.set_input_value(e,t[e])})},run:function(){return this._run()},rerun:function(e,t){return this._run({action:"rerun",target_dataset_id:e.id,regions:t})},get_inputs_dict:function(){var e={};return this.get("inputs").each(function(t){e[t.get("name")]=t.get("value")}),e},_run:function(n){var s=e.extend({tool_id:this.id,inputs:this.get_inputs_dict()},n),o=a.Deferred(),r=new t.ServerStateDeferred({ajax_settings:{url:this.urlRoot,data:JSON.stringify(s),dataType:"json",contentType:"application/json",type:"POST"},interval:2e3,success_fn:function(e){return"pending"!==e}});return a.when(r.go()).then(function(e){o.resolve(new i.DatasetCollection(e))}),o}});e.extend(p.prototype,s);var f=(o.View.extend({}),o.Collection.extend({model:p})),m=o.Model.extend(s),g=o.Model.extend({defaults:{elems:[],open:!1},clear_search_results:function(){e.each(this.attributes.elems,function(e){e.show()}),this.show(),this.set("open",!1)},apply_search_results:function(t){var i,n=!0;e.each(this.attributes.elems,function(e){e instanceof m?(i=e,i.hide()):e instanceof p&&e.apply_search_results(t)&&(n=!1,i&&i.show())}),n?this.hide():(this.show(),this.set("open",!0))}});e.extend(g.prototype,s);var v=o.Model.extend({defaults:{search_hint_string:"search tools",min_chars_for_search:3,clear_btn_url:"",search_url:"",visible:!0,query:"",results:null,clear_key:27},urlRoot:Galaxy.root+"api/tools",initialize:function(){this.on("change:query",this.do_search)},do_search:function(){var e=this.attributes.query;if(e.length<this.attributes.min_chars_for_search)return void this.set("results",null);var t=e;this.timer&&clearTimeout(this.timer),a("#search-clear-btn").hide(),a("#search-spinner").show();var i=this;this.timer=setTimeout(function(){"undefined"!=typeof ga&&ga("send","pageview",Galaxy.root+"?q="+t),a.get(i.urlRoot,{q:t},function(e){i.set("results",e),a("#search-spinner").hide(),a("#search-clear-btn").show()},"json")},400)},clear_search:function(){this.set("query",""),this.set("results",null)}});e.extend(v.prototype,s);var _=o.Model.extend({initialize:function(e){this.attributes.tool_search=e.tool_search,this.attributes.tool_search.on("change:results",this.apply_search_results,this),this.attributes.tools=e.tools,this.attributes.layout=new o.Collection(this.parse(e.layout))},parse:function(t){var i=this,n=function(t){var s=t.model_class;if(s.indexOf("Tool")===s.length-4)return i.attributes.tools.get(t.id);if("ToolSection"===s){var o=e.map(t.elems,n);return t.elems=o,new g(t)}return"ToolSectionLabel"===s?new m(t):void 0};return e.map(t,n)},clear_search_results:function(){this.get("layout").each(function(e){e instanceof g?e.clear_search_results():e.show()})},apply_search_results:function(){var e=this.get("tool_search").get("results");if(null===e)return void this.clear_search_results();var t=null;this.get("layout").each(function(i){i instanceof m?(t=i,t.hide()):i instanceof p?i.apply_search_results(e)&&t&&t.show():(t=null,i.apply_search_results(e))})}}),w=o.View.extend({initialize:function(){this.model.on("change:hidden",this.update_visible,this),this.update_visible()},update_visible:function(){this.model.attributes.hidden?this.$el.hide():this.$el.show()}}),y=w.extend({tagName:"div",render:function(){var e=a("<div/>");e.append(S.tool_link(this.model.toJSON()));var t=this.model.get("form_style",null);if("upload1"===this.model.id)e.find("a").on("click",function(e){e.preventDefault(),Galaxy.upload.show()});else if("regular"===t){var i=this;e.find("a").on("click",function(e){e.preventDefault();var t=new n.View({id:i.model.id,version:i.model.get("version")});t.deferred.execute(function(){Galaxy.app.display(t)})})}return this.$el.append(e),this}}),b=w.extend({tagName:"div",className:"toolPanelLabel",render:function(){return this.$el.append(a("<span/>").text(this.model.attributes.text)),this}}),x=w.extend({tagName:"div",className:"toolSectionWrapper",initialize:function(){w.prototype.initialize.call(this),this.model.on("change:open",this.update_open,this)},render:function(){this.$el.append(S.panel_section(this.model.toJSON()));var t=this.$el.find(".toolSectionBody");return e.each(this.model.attributes.elems,function(e){if(e instanceof p){var i=new y({model:e,className:"toolTitle"});i.render(),t.append(i.$el)}else if(e instanceof m){var n=new b({model:e});n.render(),t.append(n.$el)}}),this},events:{"click .toolSectionTitle > a":"toggle"},toggle:function(){this.model.set("open",!this.model.attributes.open)},update_open:function(){this.model.attributes.open?this.$el.children(".toolSectionBody").slideDown("fast"):this.$el.children(".toolSectionBody").slideUp("fast")}}),C=o.View.extend({tagName:"div",id:"tool-search",className:"bar",events:{click:"focus_and_select","keyup :input":"query_changed","click #search-clear-btn":"clear"},render:function(){return this.$el.append(S.tool_search(this.model.toJSON())),this.model.is_visible()||this.$el.hide(),this.$el.find("[title]").tooltip(),this},focus_and_select:function(){this.$el.find(":input").focus().select()},clear:function(){return this.model.clear_search(),this.$el.find(":input").val(""),this.focus_and_select(),!1},query_changed:function(e){return this.model.attributes.clear_key&&this.model.attributes.clear_key===e.which?(this.clear(),!1):void this.model.set("query",this.$el.find(":input").val())}}),$=o.View.extend({tagName:"div",className:"toolMenu",initialize:function(){this.model.get("tool_search").on("change:results",this.handle_search_results,this)},render:function(){var e=this,t=new C({model:this.model.get("tool_search")});return t.render(),e.$el.append(t.$el),this.model.get("layout").each(function(t){if(t instanceof g){var i=new x({model:t});i.render(),e.$el.append(i.$el)}else if(t instanceof p){var n=new y({model:t,className:"toolTitleNoSection"});n.render(),e.$el.append(n.$el)}else if(t instanceof m){var s=new b({model:t});s.render(),e.$el.append(s.$el)}}),e.$el.find("a.tool-link").click(function(t){var i=a(this).attr("class").split(/\s+/)[0],n=e.model.get("tools").get(i);e.trigger("tool_link_click",t,n)}),this},handle_search_results:function(){var e=this.model.get("tool_search").get("results");e&&0===e.length?a("#search-no-results").show():a("#search-no-results").hide()}}),k=o.View.extend({className:"toolForm",render:function(){this.$el.children().remove(),this.$el.append(S.tool_form(this.model.toJSON()))}}),S=(o.View.extend({className:"toolMenuAndView",initialize:function(){this.tool_panel_view=new $({collection:this.collection}),this.tool_form_view=new k},render:function(){this.tool_panel_view.render(),this.tool_panel_view.$el.css("float","left"),this.$el.append(this.tool_panel_view.$el),this.tool_form_view.$el.hide(),this.$el.append(this.tool_form_view.$el);var e=this;this.tool_panel_view.on("tool_link_click",function(t,i){t.preventDefault(),e.show_tool(i)})},show_tool:function(e){var t=this;e.fetch().done(function(){t.tool_form_view.model=e,t.tool_form_view.render(),t.tool_form_view.$el.show(),a("#left").width("650px")})}}),{tool_search:e.template(['<input id="tool-search-query" class="search-query parent-width" name="query" ','placeholder="<%- search_hint_string %>" autocomplete="off" type="text" />','<a id="search-clear-btn" title="clear search (esc)"> </a>','<span id="search-spinner" class="search-spinner fa fa-spinner fa-spin"></span>'].join("")),panel_section:e.template(['<div class="toolSectionTitle" id="title_<%- id %>">','<a href="javascript:void(0)"><span><%- name %></span></a>',"</div>",'<div id="<%- id %>" class="toolSectionBody" style="display: none;">','<div class="toolSectionBg"></div>',"<div>"].join("")),tool_link:e.template(['<span class="labels">',"<% _.each( labels, function( label ){ %>",'<span class="label label-default label-<%- label %>">',"<%- label %>","</span>","<% }); %>","</span>",'<a class="<%- id %> tool-link" href="<%= link %>" target="<%- target %>" minsizehint="<%- min_width %>">',"<%- name %>","</a>"," <%- description %>"].join("")),tool_form:e.template(['<div class="toolFormTitle"><%- tool.name %> (version <%- tool.version %>)</div>','<div class="toolFormBody">',"<% _.each( tool.inputs, function( input ){ %>",'<div class="form-row">','<label for="<%- input.name %>"><%- input.label %>:</label>','<div class="form-row-input">',"<%= input.html %>","</div>",'<div class="toolParamHelp" style="clear: both;">',"<%- input.help %>","</div>",'<div style="clear: both;"></div>',"</div>","<% }); %>","</div>",'<div class="form-row form-actions">','<input type="submit" class="btn btn-primary" name="runtool_btn" value="Execute" />',"</div>",'<div class="toolHelp">','<div class="toolHelpBody"><% tool.help %></div>',"</div>"].join(""),{variable:"tool"})});return{ToolParameter:r,IntegerToolParameter:c,SelectToolParameter:u,Tool:p,ToolCollection:f,ToolSearch:v,ToolPanel:_,ToolPanelView:$,ToolFormView:k}}.apply(t,n),!(void 0!==s&&(e.exports=s))}).call(t,i(3),i(1))},,function(e,t,i){var n,s;(function(i,o,a,r){n=[],s=function(){var e=i.View.extend({initialize:function(e,t){this.$button=e,this.$button.length||(this.$button=o("<div/>")),this.options=t||[],this.$button.data("popupmenu",this);var i=this;this.$button.click(function(e){return o(".popmenu-wrapper").remove(),i._renderAndShow(e),!1})},_renderAndShow:function(e){this.render(),this.$el.appendTo("body").css(this._getShownPosition(e)).show(),this._setUpCloseBehavior()},render:function(){if(this.$el.addClass("popmenu-wrapper").hide().css({position:"absolute"}).html(this.template(this.$button.attr("id"),this.options)),this.options.length){var e=this;this.$el.find("li").each(function(t,i){var n=e.options[t];n.func&&o(this).children("a.popupmenu-option").click(function(t){n.func.call(e,t,n),t.preventDefault()})})}return this},template:function(e,t){return['<ul id="',e,'-menu" class="dropdown-menu">',this._templateOptions(t),"</ul>"].join("")},_templateOptions:function(e){return e.length?a.map(e,function(e){if(e.divider)return'<li class="divider"></li>';if(e.header)return['<li class="head"><a href="javascript:void(0);">',e.html,"</a></li>"].join("");var t=e.href||"javascript:void(0);",i=e.target?' target="'+e.target+'"':"",n=e.checked?'<span class="fa fa-check"></span>':"";return['<li><a class="popupmenu-option" href="',t,'"',i,">",n,e.html,"</a></li>"].join("")}).join(""):"<li>(no options)</li>"},_getShownPosition:function(e){var t=this.$el.width(),i=e.pageX-t/2;return i=Math.min(i,o(document).scrollLeft()+o(window).width()-t-5),i=Math.max(i,o(document).scrollLeft()+5),{top:e.pageY,left:i}},_setUpCloseBehavior:function(){function e(e){if(o(document).off("click.close_popup"),window&&window.parent!==window)try{o(window.parent.document).off("click.close_popup")}catch(i){}else try{o("iframe#galaxy_main").contents().off("click.close_popup")}catch(i){}t.remove()}var t=this;if(o("html").one("click.close_popup",e),window&&window.parent!==window)try{o(window.parent.document).find("html").one("click.close_popup",e)}catch(i){}else try{o("iframe#galaxy_main").contents().one("click.close_popup",e)}catch(i){}},addItem:function(e,t){return t=t>=0?t:this.options.length,this.options.splice(t,0,e),this},removeItem:function(e){return e>=0&&this.options.splice(e,1),this},findIndexByHtml:function(e){for(var t=0;t<this.options.length;t++)if(a.has(this.options[t],"html")&&this.options[t].html===e)return t;return null},findItemByHtml:function(e){return this.options[this.findIndexByHtml(e)]},toString:function(){return"PopupMenu"}});return e.create=function(t,i){return new e(t,i)},e.make_popupmenu=function(t,i){var n=[];return a.each(i,function(e,t){var i={html:t};null===e?i.header=!0:"function"===r.type(e)&&(i.func=e),n.push(i)}),new e(o(t),n)},e.convertLinksToOptions=function(e,t){e=o(e),t=t||"a";var i=[];return e.find(t).each(function(e,t){var n={},s=o(e);if(n.html=s.text(),s.attr("href")){var a=s.attr("href"),r=s.attr("target"),l=s.attr("confirm");n.func=function(){if(!l||confirm(l))switch(r){case"_parent":window.parent.location=a;break;case"_top":window.top.location=a;break;default:window.location=a}}}i.push(n)}),i},e.fromExistingDom=function(t,i,n){t=o(t),i=o(i);var s=e.convertLinksToOptions(i,n);return i.remove(),new e(t,s)},e.make_popup_menus=function(t,i,n){t=t||document,i=i||"div[popupmenu]",n=n||function(e,t){return"#"+e.attr("popupmenu")};var s=[];return o(t).find(i).each(function(){var i=o(this),a=o(t).find(n(i,t));s.push(e.fromDom(a,i)),a.addClass("popup")}),s},e}.apply(t,n),!(void 0!==s&&(e.exports=s))}).call(t,i(3),i(1),i(2),i(1))},,,function(e,t,i){var n,s;(function(i){n=[],s=function(){var e=i.Model.extend({defaults:{extension:"auto",genome:"?",url_paste:"",status:"init",info:null,file_name:"",file_mode:"",file_size:0,file_type:null,file_path:"",file_data:null,percentage:0,space_to_tab:!1,to_posix_lines:!0,enabled:!0},reset:function(e){this.clear().set(this.defaults).set(e)}}),t=i.Collection.extend({model:e});return{Model:e,Collection:t}}.apply(t,n),!(void 0!==s&&(e.exports=s))}).call(t,i(3))},,,,,,,,,,,,,,function(e,t,i){var n,s;(function(o,a){n=[i(6),i(4),i(14)],s=function(e,t){var i=o.View.extend(e.LoggableMixin).extend(e.HiddenUntilActivatedViewMixin).extend({tagName:"div",className:"annotation-display",initialize:function(e){e=e||{},this.tooltipConfig=e.tooltipConfig||{placement:"bottom"},this.listenTo(this.model,"change:annotation",function(){this.render()}),this.hiddenUntilActivated(e.$activator,e)},render:function(){var e=this;return this.$el.html(this._template()),this.$el.find("[title]").tooltip(this.tooltipConfig),this.$annotation().make_text_editable({use_textarea:!0,on_finish:function(t){e.$annotation().text(t),e.model.save({annotation:t},{silent:!0}).fail(function(){e.$annotation().text(e.model.previous("annotation"))})}}),this},_template:function(){var e=this.model.get("annotation");return['<label class="prompt">',t("Annotation"),"</label>",'<div class="annotation" title="',t("Edit annotation"),'">',a.escape(e),"</div>"].join("")},$annotation:function(){return this.$el.find(".annotation")},remove:function(){this.$annotation.off(),this.stopListening(this.model),o.View.prototype.remove.call(this)},toString:function(){return["AnnotationEditor(",this.model+"",")"].join("")}});return{AnnotationEditor:i}}.apply(t,n),!(void 0!==s&&(e.exports=s))}).call(t,i(3),i(2))},,function(e,t,i){var n,s;(function(o){n=[i(57),i(22),i(21),i(6),i(4)],s=function(e,t,i,n,s){"use strict";var a="collections",r=e.ModelListPanel,l=r.extend({_logNamespace:a,className:r.prototype.className+" dataset-collection-panel",DatasetDCEViewClass:i.DatasetDCEListItemView,NestedDCDCEViewClass:i.NestedDCDCEListItemView,modelCollectionKey:"elements",initialize:function(e){r.prototype.initialize.call(this,e),this.linkTarget=e.linkTarget||"_blank",this.hasUser=e.hasUser,this.panelStack=[],this.parentName=e.parentName,this.foldoutStyle=e.foldoutStyle||"foldout"},_filterCollection:function(){return this.model.getVisibleContents()},_getItemViewClass:function(e){switch(e.get("element_type")){case"hda":return this.DatasetDCEViewClass;case"dataset_collection":return this.NestedDCDCEViewClass}throw new TypeError("Unknown element type:",e.get("element_type"))},_getItemViewOptions:function(e){var t=r.prototype._getItemViewOptions.call(this,e);return o.extend(t,{linkTarget:this.linkTarget,hasUser:this.hasUser,foldoutStyle:this.foldoutStyle})},_setUpItemViewListeners:function(e){var t=this;return r.prototype._setUpItemViewListeners.call(t,e),t.listenTo(e,{"expanded:drilldown":function(e,t){this._expandDrilldownPanel(t)},"collapsed:drilldown":function(e,t){this._collapseDrilldownPanel(t)}}),this},_expandDrilldownPanel:function(e){this.panelStack.push(e),this.$("> .controls").add(this.$list()).hide(),e.parentName=this.model.get("name"),this.$el.append(e.render().$el)},_collapseDrilldownPanel:function(e){this.panelStack.pop(),this.render()},events:{"click .navigation .back":"close"},close:function(e){this.$el.remove(),this.trigger("close")},toString:function(){return"CollectionView("+(this.model?this.model.get("name"):"")+")"}});l.prototype.templates=function(){var e=n.wrapTemplate(['<div class="controls">','<div class="navigation">','<a class="back" href="javascript:void(0)">','<span class="fa fa-icon fa-angle-left"></span>',s("Back to "),"<%- view.parentName %>","</a>","</div>",'<div class="title">','<div class="name"><%- collection.name || collection.element_identifier %></div>','<div class="subtitle">','<% if( collection.collection_type === "list" ){ %>',s("a list of datasets"),'<% } else if( collection.collection_type === "paired" ){ %>',s("a pair of datasets"),'<% } else if( collection.collection_type === "list:paired" ){ %>',s("a list of paired datasets"),"<% } %>","</div>","</div>","</div>"],"collection");return o.extend(o.clone(r.prototype.templates),{controls:e})}();var d=l.extend({DatasetDCEViewClass:i.DatasetDCEListItemView,toString:function(){return"ListCollectionView("+(this.model?this.model.get("name"):"")+")"}}),c=d.extend({toString:function(){return"PairCollectionView("+(this.model?this.model.get("name"):"")+")"}}),h=l.extend({NestedDCDCEViewClass:i.NestedDCDCEListItemView.extend({foldoutPanelClass:c}),toString:function(){return"ListOfPairsCollectionView("+(this.model?this.model.get("name"):"")+")"}});return{CollectionView:l,ListCollectionView:d,PairCollectionView:c,ListOfPairsCollectionView:h}}.apply(t,n),!(void 0!==s&&(e.exports=s))}).call(t,i(2))},function(e,t,i){var n,s;(function(o,a){n=[i(8),i(24),i(58),i(48),i(16),i(6),i(4)],s=function(e,t,n,s,r,l,d){"use strict";var c=t.DatasetListItemView,h=c.extend({initialize:function(e){c.prototype.initialize.call(this,e),this.hasUser=e.hasUser,this.purgeAllowed=e.purgeAllowed||!1,this.tagsEditorShown=e.tagsEditorShown||!1,this.annotationEditorShown=e.annotationEditorShown||!1},_renderPrimaryActions:function(){var t=c.prototype._renderPrimaryActions.call(this);return this.model.get("state")===e.NOT_VIEWABLE?t:c.prototype._renderPrimaryActions.call(this).concat([this._renderEditButton(),this._renderDeleteButton()])},_renderEditButton:function(){if(this.model.get("state")===e.DISCARDED||!this.model.get("accessible"))return null;var t=this.model.get("purged"),i=this.model.get("deleted"),n={title:d("Edit attributes"),href:this.model.urls.edit,target:this.linkTarget,faIcon:"fa-pencil",classes:"edit-btn"};return i||t?(n.disabled=!0,t?n.title=d("Cannot edit attributes of datasets removed from disk"):i&&(n.title=d("Undelete dataset to edit attributes"))):o.contains([e.UPLOAD,e.NEW],this.model.get("state"))&&(n.disabled=!0,n.title=d("This dataset is not yet editable")),r(n)},_renderDeleteButton:function(){if(!this.model.get("accessible"))return null;var e=this,t=this.model.isDeletedOrPurged();return r({title:d(t?"Dataset is already deleted":"Delete"),disabled:t,faIcon:"fa-times",classes:"delete-btn",onclick:function(){e.$el.find(".icon-btn.delete-btn").trigger("mouseout"),e.model["delete"]()}})},_renderDetails:function(){var t=c.prototype._renderDetails.call(this),i=this.model.get("state");return!this.model.isDeletedOrPurged()&&o.contains([e.OK,e.FAILED_METADATA],i)&&(this._renderTags(t),this._renderAnnotation(t),this._makeDbkeyEditLink(t)),this._setUpBehaviors(t),t},_renderSecondaryActions:function(){var t=c.prototype._renderSecondaryActions.call(this);switch(this.model.get("state")){case e.UPLOAD:case e.NOT_VIEWABLE:return t;case e.ERROR:return t.unshift(this._renderErrButton()),t.concat([this._renderRerunButton()]);case e.OK:case e.FAILED_METADATA:return t.concat([this._renderRerunButton(),this._renderVisualizationsButton()])}return t.concat([this._renderRerunButton()])},_renderErrButton:function(){return r({title:d("View or report this error"),href:this.model.urls.report_error,classes:"report-error-btn",target:this.linkTarget,faIcon:"fa-bug"})},_renderRerunButton:function(){var e=this.model.get("creating_job");if(this.model.get("rerunnable"))return r({title:d("Run this job again"),href:this.model.urls.rerun,classes:"rerun-btn",target:this.linkTarget,faIcon:"fa-refresh",onclick:function(t){t.preventDefault(),!function(){var t=[i(12)];(function(t){var i=new t.View({job_id:e});i.deferred.execute(function(){Galaxy.app.display(i)})}).apply(null,t)}()}})},_renderVisualizationsButton:function(){var e=this.model.get("visualizations");if(this.model.isDeletedOrPurged()||!this.hasUser||!this.model.hasData()||o.isEmpty(e))return null;if(!o.isObject(e[0]))return this.warn("Visualizations have been switched off"),null;var t=a(this.templates.visualizations(e,this));return t.find('[target="galaxy_main"]').attr("target",this.linkTarget),this._addScratchBookFn(t.find(".visualization-link").addBack(".visualization-link")),t},_addScratchBookFn:function(e){e.click(function(e){Galaxy.frame&&Galaxy.frame.active&&(Galaxy.frame.add({title:"Visualization",url:a(this).attr("href")}),e.preventDefault(),e.stopPropagation())})},_renderTags:function(e){if(this.hasUser){var t=this;this.tagsEditor=new n.TagsEditor({model:this.model,el:e.find(".tags-display"),onshowFirstTime:function(){this.render()},onshow:function(){t.tagsEditorShown=!0},onhide:function(){t.tagsEditorShown=!1},$activator:r({title:d("Edit dataset tags"),classes:"tag-btn",faIcon:"fa-tags"}).appendTo(e.find(".actions .right"))}),this.tagsEditorShown&&this.tagsEditor.toggle(!0)}},_renderAnnotation:function(e){if(this.hasUser){var t=this;this.annotationEditor=new s.AnnotationEditor({model:this.model,el:e.find(".annotation-display"),onshowFirstTime:function(){this.render()},onshow:function(){t.annotationEditorShown=!0},onhide:function(){t.annotationEditorShown=!1},$activator:r({title:d("Edit dataset annotation"),classes:"annotate-btn",faIcon:"fa-comment"}).appendTo(e.find(".actions .right"))}),this.annotationEditorShown&&this.annotationEditor.toggle(!0)}},_makeDbkeyEditLink:function(e){if("?"===this.model.get("metadata_dbkey")&&!this.model.isDeletedOrPurged()){var t=a('<a class="value">?</a>').attr("href",this.model.urls.edit).attr("target",this.linkTarget);e.find(".dbkey .value").replaceWith(t)}},events:o.extend(o.clone(c.prototype.events),{"click .undelete-link":"_clickUndeleteLink","click .purge-link":"_clickPurgeLink","click .edit-btn":function(e){this.trigger("edit",this,e)},"click .delete-btn":function(e){this.trigger("delete",this,e)},"click .rerun-btn":function(e){this.trigger("rerun",this,e)},"click .report-err-btn":function(e){this.trigger("report-err",this,e)},"click .visualization-btn":function(e){this.trigger("visualize",this,e)},"click .dbkey a":function(e){this.trigger("edit",this,e)}}),_clickUndeleteLink:function(e){return this.model.undelete(),!1},_clickPurgeLink:function(e){return this.model.purge(),!1},toString:function(){var e=this.model?this.model+"":"(no model)";return"HDAEditView("+e+")"}});return h.prototype.templates=function(){var e=o.extend({},c.prototype.templates.warnings,{failed_metadata:l.wrapTemplate(['<% if( dataset.state === "failed_metadata" ){ %>','<div class="failed_metadata-warning warningmessagesmall">',d("An error occurred setting the metadata for this dataset"),'<br /><a href="<%- dataset.urls.edit %>" target="<%- view.linkTarget %>">',d("Set it manually or retry auto-detection"),"</a>","</div>","<% } %>"],"dataset"),deleted:l.wrapTemplate(["<% if( dataset.deleted && !dataset.purged ){ %>",'<div class="deleted-msg warningmessagesmall">',d("This dataset has been deleted"),'<br /><a class="undelete-link" href="javascript:void(0);">',d("Undelete it"),"</a>","<% if( view.purgeAllowed ){ %>",'<br /><a class="purge-link" href="javascript:void(0);">',d("Permanently remove it from disk"),"</a>","<% } %>","</div>","<% } %>"],"dataset")
}),t=l.wrapTemplate(["<% if( visualizations.length === 1 ){ %>",'<a class="visualization-btn visualization-link icon-btn" href="<%- visualizations[0].href %>"',' target="<%- visualizations[0].target %>" title="',d("Visualize in"),' <%- visualizations[0].html %>">','<span class="fa fa-bar-chart-o"></span>',"</a>","<% } else { %>",'<div class="visualizations-dropdown dropdown">','<a class="visualization-btn icon-btn" data-toggle="dropdown" title="',d("Visualize"),'">','<span class="fa fa-bar-chart-o"></span>',"</a>",'<ul class="dropdown-menu" role="menu">',"<% _.each( visualizations, function( visualization ){ %>",'<li><a class="visualization-link" href="<%- visualization.href %>"',' target="<%- visualization.target %>">',"<%- visualization.html %>","</a></li>","<% }); %>","</ul>","</div>","<% } %>"],"visualizations");return o.extend({},c.prototype.templates,{warnings:e,visualizations:t})}(),{DatasetListItemEdit:h}}.apply(t,n),!(void 0!==s&&(e.exports=s))}).call(t,i(2),i(1))},function(e,t,i){var n,s;(function(o,a,r){n=[i(8),i(6),i(4)],s=function(e,t,i){"use strict";var n="dataset",s=t.SearchableModelMixin,l=o.Model.extend(t.LoggableMixin).extend(t.mixin(s,{_logNamespace:n,defaults:{state:e.NEW,deleted:!1,purged:!1,name:"(unnamed dataset)",accessible:!0,data_type:"",file_ext:"",file_size:0,meta_files:[],misc_blurb:"",misc_info:"",tags:[]},initialize:function(t,i){this.debug(this+"(Dataset).initialize",t,i),
//!! this state is not in trans.app.model.Dataset.states - set it here -
this.get("accessible")||this.set("state",e.NOT_VIEWABLE),this.urls=this._generateUrls(),this._setUpListeners()},_generateUrls:function(){var e=this.get("id");if(!e)return{};var t={purge:"datasets/"+e+"/purge_async",display:"datasets/"+e+"/display/?preview=True",edit:"datasets/"+e+"/edit",download:"datasets/"+e+"/display?to_ext="+this.get("file_ext"),report_error:"dataset/errors?id="+e,rerun:"tool_runner/rerun?id="+e,show_params:"datasets/"+e+"/show_params",visualization:"visualization",meta_download:"dataset/get_metadata_file?hda_id="+e+"&metadata_name="};return a.each(t,function(e,i){t[i]=Galaxy.root+e}),this.urls=t,t},_setUpListeners:function(){this.on("change:state",function(e,t){this.log(this+" has changed state:",e,t),this.inReadyState()&&this.trigger("state:ready",e,t,this.previous("state"))}),this.on("change:id change:file_ext",function(e){this._generateUrls()})},toJSON:function(){var e=o.Model.prototype.toJSON.call(this);return a.extend(e,{urls:this.urls})},isDeletedOrPurged:function(){return this.get("deleted")||this.get("purged")},inReadyState:function(){var t=a.contains(e.READY_STATES,this.get("state"));return this.isDeletedOrPurged()||t},hasDetails:function(){return!this.get("accessible")||a.has(this.attributes,"genome_build")},hasData:function(){return this.get("file_size")>0},fetch:function(e){var t=this;return o.Model.prototype.fetch.call(this,e).always(function(){t._generateUrls()})},"delete":function(e){return this.get("deleted")?r.when():this.save({deleted:!0},e)},undelete:function(e){return!this.get("deleted")||this.get("purged")?r.when():this.save({deleted:!1},e)},purge:function(e){if(this.get("purged"))return r.when();e=e||{},e.url=this.urls.purge;var t=this,n=r.ajax(e);return n.done(function(e,i,n){t.set({deleted:!0,purged:!0})}),n.fail(function(n,s,o){var a=i("Unable to purge dataset"),r="Removal of datasets by users is not allowed in this Galaxy instance";n.responseJSON&&n.responseJSON.error?a=n.responseJSON.error:n.responseText.indexOf(r)!==-1&&(a=r),n.responseText=a,t.trigger("error",t,n,e,i(a),{error:a})}),n},searchAttributes:["name","file_ext","genome_build","misc_blurb","misc_info","annotation","tags"],searchAliases:{title:"name",format:"file_ext",database:"genome_build",blurb:"misc_blurb",description:"misc_blurb",info:"misc_info",tag:"tags"},toString:function(){var e=this.get("id")||"";return this.get("name")&&(e='"'+this.get("name")+'",'+e),"Dataset("+e+")"}})),d=o.Collection.extend(t.LoggableMixin).extend({_logNamespace:n,model:l,urlRoot:Galaxy.root+"api/datasets",url:function(){return this.urlRoot},ids:function(){return this.map(function(e){return e.get("id")})},notReady:function(){return this.filter(function(e){return!e.inReadyState()})},haveDetails:function(){return this.all(function(e){return e.hasDetails()})},ajaxQueue:function(e,t){var i=r.Deferred(),n=this.length,s=[];if(!n)return i.resolve([]),i;var o=this.chain().reverse().map(function(a,r){return function(){var l=e.call(a,t);l.done(function(e){i.notify({curr:r,total:n,response:e,model:a})}),l.always(function(e){s.push(e),o.length?o.shift()():i.resolve(s)})}}).value();return o.shift()(),i},matches:function(e){return this.filter(function(t){return t.matches(e)})},toString:function(){return["DatasetAssociationCollection(",this.length,")"].join("")}});return{DatasetAssociation:l,DatasetAssociationCollection:d}}.apply(t,n),!(void 0!==s&&(e.exports=s))}).call(t,i(3),i(2),i(1))},function(e,t,i){var n,s;(function(o){n=[i(24),i(6),i(4)],s=function(e,t,i){"use strict";var n=e.DatasetListItemView,s=n.extend({className:n.prototype.className+" history-content",initialize:function(e,t){n.prototype.initialize.call(this,e,t)},toString:function(){var e=this.model?this.model+"":"(no model)";return"HDAListItemView("+e+")"}});return s.prototype.templates=function(){var e=t.wrapTemplate(['<div class="title-bar clear" tabindex="0">','<span class="state-icon"></span>','<div class="title">','<span class="hid"><%- dataset.hid %></span> ','<span class="name"><%- dataset.name %></span>',"</div>","</div>"],"dataset"),s=o.extend({},n.prototype.templates.warnings,{hidden:t.wrapTemplate(["<% if( !dataset.visible ){ %>",'<div class="hidden-msg warningmessagesmall">',i("This dataset has been hidden"),"</div>","<% } %>"],"dataset")});return o.extend({},n.prototype.templates,{titleBar:e,warnings:s})}(),{HDAListItemView:s}}.apply(t,n),!(void 0!==s&&(e.exports=s))}).call(t,i(2))},function(e,t,i){var n,s;(function(o){n=[i(52),i(26),i(6),i(4)],s=function(e,t,i,n){"use strict";var s=e.DatasetAssociation,a=t.HistoryContentMixin,r=s.extend(i.mixin(a,{constructor:function(e,t){a.constructor.call(this,e,t)},defaults:o.extend({},s.prototype.defaults,a.defaults,{model_class:"HistoryDatasetAssociation"}),initialize:function(e,t){s.prototype.initialize.call(this,e,t),a.initialize.call(this,e,t)},toString:function(){var e=this.get("id")||"";return this.get("name")&&(e=this.get("hid")+' :"'+this.get("name")+'",'+e),"HDA("+e+")"}}));return{HistoryDatasetAssociation:r}}.apply(t,n),!(void 0!==s&&(e.exports=s))}).call(t,i(2))},function(e,t,i){var n,s;(function(o){n=[i(8),i(21),i(50),i(6),i(4)],s=function(e,t,i,n,s){"use strict";var a=t.DCListItemView,r=a.extend({className:a.prototype.className+" history-content",_setUpListeners:function(){a.prototype._setUpListeners.call(this),this.listenTo(this.model,{"change:populated change:visible":function(e,t){this.render()}})},_getFoldoutPanelClass:function(){switch(this.model.get("collection_type")){case"list":return i.ListCollectionView;case"paired":return i.PairCollectionView;case"list:paired":return i.ListOfPairsCollectionView}throw new TypeError("Uknown collection_type: "+this.model.get("collection_type"))},_swapNewRender:function(t){a.prototype._swapNewRender.call(this,t);var i=this.model.get("populated")?e.OK:e.RUNNING;return this.$el.addClass("state-"+i),this.$el},toString:function(){var e=this.model?this.model+"":"(no model)";return"HDCAListItemView("+e+")"}});return r.prototype.templates=function(){var e=o.extend({},a.prototype.templates.warnings,{hidden:n.wrapTemplate(["<% if( !collection.visible ){ %>",'<div class="hidden-msg warningmessagesmall">',s("This collection has been hidden"),"</div>","<% } %>"],"collection")}),t=n.wrapTemplate(['<div class="title-bar clear" tabindex="0">','<span class="state-icon"></span>','<div class="title">','<span class="hid"><%- collection.hid %></span> ','<span class="name"><%- collection.name %></span>',"</div>",'<div class="subtitle"></div>',"</div>"],"collection");return o.extend({},a.prototype.templates,{warnings:e,titleBar:t})}(),{HDCAListItemView:r}}.apply(t,n),!(void 0!==s&&(e.exports=s))}).call(t,i(2))},function(e,t,i){var n,s;(function(o,a,r,l){n=[i(27),i(5),i(6),i(4)],s=function(e,t,i,n){"use strict";var s="history",d=o.Model.extend(i.LoggableMixin).extend(i.mixin(i.SearchableModelMixin,{_logNamespace:s,defaults:{model_class:"History",id:null,name:"Unnamed History",state:"new",deleted:!1},urlRoot:Galaxy.root+"api/histories",initialize:function(t,i,n){n=n||{},this.logger=n.logger||null,this.log(this+".initialize:",t,i,n),this.log("creating history contents:",i),this.contents=new e.HistoryContents(i||[],{historyId:this.get("id")}),this._setUpListeners(),this.updateTimeoutId=null},_setUpListeners:function(){this.on("error",function(e,t,i,n,s){this.errorHandler(e,t,i,n,s)}),this.contents&&this.listenTo(this.contents,"error",function(){this.trigger.apply(this,["error:contents"].concat(a.makeArray(arguments)))}),this.on("change:id",function(e,t){this.contents&&(this.contents.historyId=t)})},errorHandler:function(e,t,i,n,s){this.clearUpdateTimeout()},nice_size:function(){return t.bytesToString(this.get("size"),!0,2)},toJSON:function(){return r.extend(o.Model.prototype.toJSON.call(this),{nice_size:this.nice_size()})},get:function(e){return"nice_size"===e?this.nice_size():o.Model.prototype.get.apply(this,arguments)},ownedByCurrUser:function(){return!(!Galaxy||!Galaxy.user)&&(!Galaxy.user.isAnonymous()&&Galaxy.user.id===this.get("user_id"))},contentsCount:function(){return r.reduce(r.values(this.get("state_details")),function(e,t){return e+t},0)},numOfUnfinishedJobs:function(){var e=this.get("non_ready_jobs");return e?e.length:0},numOfUnfinishedShownContents:function(){var e=this.contents.running().visibleAndUndeleted();return e?e.length:0},searchAttributes:["name","annotation","tags"],searchAliases:{title:"name",tag:"tags"},_getSizeAndRunning:function(){return this.fetch({data:l.param({keys:"size,non_ready_jobs"})})},refresh:function(e){e=e||{};var t=this,i=t.lastUpdateTime;return t.contents.fetchUpdated(i).done(function(i,n,s){var o;try{o=new Date(s.getResponseHeader("Date"))}catch(a){}t.lastUpdateTime=o||new Date,t.checkForUpdates(e)})},checkForUpdates:function(e){function t(){n.clearUpdateTimeout(),n.updateTimeoutId=setTimeout(function(){n.refresh(e)},i)}e=e||{};var i=d.UPDATE_DELAY,n=this;this.numOfUnfinishedShownContents()>0?t():n._getSizeAndRunning().done(function(e){n.numOfUnfinishedJobs()>0?t():n.trigger("ready")})},clearUpdateTimeout:function(){this.updateTimeoutId&&(clearTimeout(this.updateTimeoutId),this.updateTimeoutId=null)},_delete:function(e){return this.get("deleted")?a.when():this.save({deleted:!0},e)},purge:function(e){return this.get("purged")?a.when():this.save({deleted:!0,purged:!0},e)},undelete:function(e){return this.get("deleted")?this.save({deleted:!1},e):a.when()},copy:function(e,t,i){if(e=void 0===e||e,!this.id)throw new Error("You must set the history ID before copying it.");var n={history_id:this.id};e&&(n.current=!0),t&&(n.name=t),i||(n.all_datasets=!1);var s=this,o=a.post(this.urlRoot,n);return e?o.then(function(e){var t=new d(e);return t.setAsCurrent().done(function(){s.trigger("copied",s,e)})}):o.done(function(e){s.trigger("copied",s,e)})},setAsCurrent:function(){var e=this,t=a.getJSON(Galaxy.root+"history/set_as_current?id="+this.id);return t.done(function(){e.trigger("set-as-current",e)}),t},toString:function(){return"History("+this.get("id")+","+this.get("name")+")"}}));d.UPDATE_DELAY=4e3,d.getHistoryData=function(e,t){function i(t){return"current"===e?a.getJSON(Galaxy.root+"history/current_history_json"):a.ajax(Galaxy.root+"api/histories/"+e)}function n(e){return e&&e.empty}function s(e){if(n(e))return[];r.isFunction(o)&&(o=o(e)),r.isFunction(l)&&(l=l(e));var t={v:"dev"};return o.length&&(t.details=o.join(",")),a.ajax(Galaxy.root+"api/histories/"+e.id+"/contents",{data:t})}t=t||{};var o=t.detailIdsFn||[],l=t.hdcaDetailIds||[],d=a.Deferred(),c=null,h=t.historyFn||i,u=t.contentsFn||s,p=h(e);p.done(function(e){c=e,d.notify({status:"history data retrieved",historyJSON:c})}),p.fail(function(e,t,i){d.reject(e,"loading the history")});var f=p.then(u);return f.then(function(e){d.notify({status:"contents data retrieved",historyJSON:c,contentsJSON:e}),d.resolve(c,e)}),f.fail(function(e,t,i){d.reject(e,"loading the contents",{history:c})}),d};var c={fetch:function(e){return e=e||{},e.data=e.data||this._buildFetchData(e),e.traditional=!0,o.Collection.prototype.fetch.call(this,e)},_fetchOptions:["order","limit","offset","view","keys"],_buildFetchData:function(e){var t={},i=this._fetchDefaults();e=r.defaults(e||{},i),t=r.pick(e,this._fetchOptions);var n=r.has(e,"filters")?e.filters:i.filters||{};return r.isEmpty(n)||r.extend(t,this._buildFetchFilters(n)),t},_fetchDefaults:function(){return{}},_buildFetchFilters:function(e){var t={q:[],qv:[]};return r.each(e,function(e,i){e===!0&&(e="True"),e===!1&&(e="False"),null===e&&(e="None"),t.q.push(i),t.qv.push(e)}),t}},h=o.Collection.extend(i.LoggableMixin).extend(c).extend({_logNamespace:s,model:d,DEFAULT_ORDER:"update_time",sortOrders:{update_time:{getter:function(e){return new Date(e.get("update_time"))},asc:!1},"update_time-asc":{getter:function(e){return new Date(e.get("update_time"))},asc:!0},name:{getter:function(e){return e.get("name")},asc:!0},"name-dsc":{getter:function(e){return e.get("name")},asc:!1},size:{getter:function(e){return e.get("size")},asc:!1},"size-asc":{getter:function(e){return e.get("size")},asc:!0}},initialize:function(e,t){t=t||{},this.log("HistoryCollection.initialize",arguments),this.includeDeleted=t.includeDeleted||!1,this.setOrder(t.order||this.DEFAULT_ORDER),this.currentHistoryId=t.currentHistoryId,this.allFetched=t.allFetched||!1,this.setUpListeners()},urlRoot:Galaxy.root+"api/histories",url:function(){return this.urlRoot},_fetchDefaults:function(){var e={order:this.order,view:"detailed"};return this.includeDeleted?e.filters={deleted:null}:e.filters={deleted:!1,purged:!1},e},setUpListeners:function(){this.on({"change:deleted":function(e){this.debug("change:deleted",this.includeDeleted,e.get("deleted")),!this.includeDeleted&&e.get("deleted")&&this.remove(e)},copied:function(e,t){this.setCurrent(new d(t,[]))},"set-as-current":function(e){var t=this.currentHistoryId;this.trigger("no-longer-current",t),this.currentHistoryId=e.id}})},sort:function(e){return e=e||{},this.setOrder(e.order),o.Collection.prototype.sort.call(this,e)},setOrder:function(e){var t=this,i=this.sortOrders[e];if(!r.isUndefined(i))return t.order=e,t.comparator=function(e,n){var s=t.currentHistoryId;return e.id===s?-1:n.id===s?1:(e=i.getter(e),n=i.getter(n),i.asc?e===n?0:e>n?1:-1:e===n?0:e>n?-1:1)},t.trigger("changed-order",t.order,t),t},fetch:function(e){if(e=e||{},this.allFetched)return a.when({});var t=this,i=r.defaults(e,{remove:!1,offset:t.length>=1?t.length-1:0,order:t.order}),n=e.limit;return r.isUndefined(n)||(i.limit=n),c.fetch.call(this,i).done(function(e){var i=r.isArray(e)?e.length:0;(!n||i<n)&&(t.allFetched=!0,t.trigger("all-fetched",t))})},create:function(e,t,i,n){var s=this,o=a.getJSON(Galaxy.root+"history/create_new_current");return o.done(function(e){s.setCurrent(new d(e,[],i||{}))})},setCurrent:function(e,t){return t=t||{},this.unshift(e,t),this.currentHistoryId=e.get("id"),t.silent||this.trigger("new-current",e,this),this},reset:function(e,t){return this.allFetched=!1,o.Collection.prototype.reset.call(this,e,t)},toString:function(){return"HistoryCollection("+this.length+")"}});return{History:d,HistoryCollection:h}}.apply(t,n),!(void 0!==s&&(e.exports=s))}).call(t,i(3),i(1),i(2),i(1))},function(e,t,i){var n,s;(function(o,a,r){n=[i(28),i(118),i(39),i(6),i(4),i(67)],s=function(e,t,i,n,s){"use strict";var l="list",d=o.View.extend(n.LoggableMixin).extend({_logNamespace:l,viewClass:e.ListItemView,collectionClass:o.Collection,tagName:"div",className:"list-panel",fxSpeed:"fast",emptyMsg:s("This list is empty"),noneFoundMsg:s("No matching items found"),searchPlaceholder:s("search"),initialize:function(e,i){e=e||{},e.logger&&(this.logger=e.logger),this.log(this+".initialize:",e),this.fxSpeed=a.has(e,"fxSpeed")?e.fxSpeed:this.fxSpeed,this.filters=[],this.searchFor=e.searchFor||"",this.indicator=new t(this.$el),this.selecting=void 0===e.selecting||e.selecting,this.selected=e.selected||[],this.lastSelected=null,this.dragItems=e.dragItems||!1,this.viewClass=e.viewClass||this.viewClass,this.views=[],this.collection=e.collection||new this.collectionClass([]),this.filters=e.filters||[],this.$scrollContainer=e.$scrollContainer||this.$scrollContainer,this.title=e.title||"",this.subtitle=e.subtitle||"",this._setUpListeners()},freeViews:function(){return a.each(this.views,function(e){e.off()}),this.views=[],this},_setUpListeners:function(){return this.off(),this.on({error:function(e,t,i,n,s){console.error(e,t,i,n,s)},loading:function(){this._showLoadingIndicator("loading...",40)},"loading-done":function(){this._hideLoadingIndicator(40)}}),this.once("rendered",function(){this.trigger("rendered:initial",this)}),this.logger&&this.on("all",function(e){this.log(this+"",arguments)}),this._setUpCollectionListeners(),this._setUpViewListeners(),this},_setUpCollectionListeners:function(){return this.log(this+"._setUpCollectionListeners",this.collection),this.collection.off(),this.listenTo(this.collection,{error:function(e,t,i,n,s){this.trigger("error",e,t,i,n,s)},reset:function(){this.renderItems()},add:this.addItemView,remove:this.removeItemView}),this.logger&&this.listenTo(this.collection,"all",function(e){this.info(this+"(collection)",arguments)}),this},_setUpViewListeners:function(){this.log(this+"._setUpViewListeners"),this.on({"view:selected":function(e,t){if(t&&t.shiftKey&&this.lastSelected){var i=this.viewFromModelId(this.lastSelected);i&&this.selectRange(e,i)}else t&&t.altKey&&!this.selecting&&this.showSelectors();this.selected.push(e.model.id),this.lastSelected=e.model.id},"view:de-selected":function(e,t){this.selected=a.without(this.selected,e.model.id)}})},render:function(e){this.log(this+".render",e);var t=this._buildNewRender();return this._setUpBehaviors(t),this._queueNewRender(t,e),this},_buildNewRender:function(){this.debug(this+"(ListPanel)._buildNewRender");var e=r(this.templates.el({},this));return this._renderControls(e),this._renderTitle(e),this._renderSubtitle(e),this._renderSearch(e),this.renderItems(e),e},_renderControls:function(e){this.debug(this+"(ListPanel)._renderControls");var t=r(this.templates.controls({},this));return e.find(".controls").replaceWith(t),t},_renderTitle:function(e){},_renderSubtitle:function(e){},_queueNewRender:function(e,t){t=void 0===t?this.fxSpeed:t;var i=this;i.log("_queueNewRender:",e,t),r(i).queue("fx",[function(e){this.$el.fadeOut(t,e)},function(t){i._swapNewRender(e),t()},function(e){this.$el.fadeIn(t,e)},function(e){i.trigger("rendered",i),e()}])},_swapNewRender:function(e){return this.$el.empty().attr("class",this.className).append(e.children()),this.selecting&&this.showSelectors(0),this},_setUpBehaviors:function(e){return e=e||this.$el,e.find(".controls [title]").tooltip({placement:"bottom"}),this._renderMultiselectActionMenu(e),this},_renderMultiselectActionMenu:function(e){e=e||this.$el;var t=e.find(".list-action-menu"),i=this.multiselectActions();if(!i.length)return t.empty();var n=r(['<div class="list-action-menu btn-group">','<button class="list-action-menu-btn btn btn-default dropdown-toggle" data-toggle="dropdown">',s("For all selected"),"...","</button>",'<ul class="dropdown-menu pull-right" role="menu">',"</ul>","</div>"].join("")),o=i.map(function(e){var t=['<li><a href="javascript:void(0);">',e.html,"</a></li>"].join("");return r(t).click(function(t){return t.preventDefault(),e.func(t)})});return n.find("ul").append(o),t.replaceWith(n),n},multiselectActions:function(){return[]},$scrollContainer:function(){return this.$el.parent().parent()},$list:function(e){return(e||this.$el).find("> .list-items")},$messages:function(e){return(e||this.$el).find("> .controls .messages")},$emptyMessage:function(e){return(e||this.$el).find("> .empty-message")},renderItems:function(e){e=e||this.$el;var t=this,n=null;t.log(this+".renderItems",e);var s=t.$list(e);return t.views=t._filterCollection().map(function(e){return t._createItemView(e).render(0)}),s.empty(),t.views.length?(t._attachItems(e),t.$emptyMessage(e).hide()):t._renderEmptyMessage(e).show(),t.trigger("views:ready",t.views),this.searchFor.length>0&&(n=new i.SearchItems({current_dataset:t._filterCollection()})),t.views},_filterCollection:function(){var e=this;return e.collection.filter(a.bind(e._filterItem,e))},_filterItem:function(e){var t=this;return a.every(t.filters.map(function(t){return t.call(e)}))&&(!t.searchFor||e.matchesAll(t.searchFor))},_createItemView:function(e){var t=this._getItemViewClass(e),i=a.extend(this._getItemViewOptions(e),{model:e}),n=new t(i);return this._setUpItemViewListeners(n),n},_getItemViewClass:function(e){return this.viewClass},_getItemViewOptions:function(e){return{fxSpeed:this.fxSpeed,expanded:!1,selectable:this.selecting,selected:a.contains(this.selected,e.id),draggable:this.dragItems}},_setUpItemViewListeners:function(e){var t=this;return this.listenTo(e,"all",function(){var e=Array.prototype.slice.call(arguments,0);e[0]="view:"+e[0],t.trigger.apply(t,e)}),this.listenTo(e,"draggable:dragstart",function(e,t){var i={},n=this.getSelectedModels();i=n.length?n.toJSON():[t.model.toJSON()],e.dataTransfer.setData("text",JSON.stringify(i))},this),t},_attachItems:function(e){return this.$list(e).append(this.views.map(function(e){return e.$el})),this},_renderEmptyMessage:function(e){this.debug("_renderEmptyMessage",e,this.searchFor);var t=this.searchFor?this.noneFoundMsg:this.emptyMsg;return this.$emptyMessage(e).text(t)},expandAll:function(){a.each(this.views,function(e){e.expand()})},collapseAll:function(){a.each(this.views,function(e){e.collapse()})},addItemView:function(e,t,i){this.log(this+".addItemView:",e);var n=this;if(n._filterItem(e)){var s=n._createItemView(e);return r(s).queue("fx",[function(e){n.$emptyMessage().fadeOut(n.fxSpeed,e)},function(e){n._attachView(s),e()}]),s}},_attachView:function(e){var t=this;t.views.push(e),t.$list().append(e.render(0).$el.hide()),t.trigger("view:attached",e),e.$el.slideDown(t.fxSpeed,function(){t.trigger("view:attached:rendered")})},removeItemView:function(e,t,i){this.log(this+".removeItemView:",e);var n=this,s=n.viewFromModel(e);if(s)return n.views=a.without(n.views,s),n.trigger("view:removed",s),r({}).queue("fx",[function(e){s.$el.fadeOut(n.fxSpeed,e)},function(e){s.remove(),n.trigger("view:removed:rendered"),n.views.length?e():n._renderEmptyMessage().fadeIn(n.fxSpeed,e)}]),s},viewFromModelId:function(e){for(var t=0;t<this.views.length;t++)if(this.views[t].model.id===e)return this.views[t]},viewFromModel:function(e){if(e)return this.viewFromModelId(e.id)},viewsWhereModel:function(e){return this.views.filter(function(t){var i=t.model.toJSON();for(var n in e)if(e.hasOwnProperty(n)&&i[n]!==e[n])return!1;return!0})},viewRange:function(e,t){if(e===t)return e?[e]:[];var i=this.views.indexOf(e),n=this.views.indexOf(t);return i===-1||n===-1?i===n?[]:i===-1?[t]:[e]:i<n?this.views.slice(i,n+1):this.views.slice(n,i+1)},_renderSearch:function(e){return e.find(".controls .search-input").searchInput({placeholder:this.searchPlaceholder,initialVal:this.searchFor,onfirstsearch:a.bind(this._firstSearch,this),onsearch:a.bind(this.searchItems,this),onclear:a.bind(this.clearSearch,this)}),e},_firstSearch:function(e){return this.log("onFirstSearch",e),this.searchItems(e)},searchItems:function(e){return this.searchFor=e,this.trigger("search:searching",e,this),this.renderItems(),this.$("> .controls .search-query").val(e),this},clearSearch:function(e){return this.searchFor="",this.trigger("search:clear",this),this.$("> .controls .search-query").val(""),this.renderItems(),this},THROTTLE_SELECTORS_AT:20,showSelectors:function(e){e=void 0!==e?e:this.fxSpeed,this.selecting=!0,this.$(".list-actions").slideDown(e),e=this.views.length>=this.THROTTLE_SELECTORS_AT?0:e,a.each(this.views,function(t){t.showSelector(e)})},hideSelectors:function(e){e=void 0!==e?e:this.fxSpeed,this.selecting=!1,this.$(".list-actions").slideUp(e),e=this.views.length>=this.THROTTLE_SELECTORS_AT?0:e,a.each(this.views,function(t){t.hideSelector(e)}),this.selected=[],this.lastSelected=null},toggleSelectors:function(){this.selecting?this.hideSelectors():this.showSelectors()},selectAll:function(e){a.each(this.views,function(t){t.select(e)})},deselectAll:function(e){this.lastSelected=null,a.each(this.views,function(t){t.deselect(e)})},selectRange:function(e,t){var i=this.viewRange(e,t);return a.each(i,function(e){e.select()}),i},getSelectedViews:function(){return a.filter(this.views,function(e){return e.selected})},getSelectedModels:function(){return new this.collection.constructor(a.map(this.getSelectedViews(),function(e){return e.model}))},_showLoadingIndicator:function(e,i,n){this.debug("_showLoadingIndicator",this.indicator,e,i,n),i=void 0!==i?i:this.fxSpeed,this.indicator||(this.indicator=new t(this.$el,this.$el.parent()),this.debug("\t created",this.indicator)),this.$el.is(":visible")?(this.$el.fadeOut(i),this.indicator.show(e,i,n)):this.indicator.show(0,n)},_hideLoadingIndicator:function(e,t){this.debug("_hideLoadingIndicator",this.indicator,e,t),e=void 0!==e?e:this.fxSpeed,this.indicator&&this.indicator.hide(e,t)},scrollPosition:function(){return this.$scrollContainer().scrollTop()},scrollTo:function(e,t){return t=t||0,this.$scrollContainer().animate({scrollTop:e},t),this},scrollToTop:function(e){return this.scrollTo(0,e)},scrollToItem:function(e,t){if(!e)return this;var i=e.el.offsetTop;return this.scrollTo(i,t)},scrollToId:function(e,t){return this.scrollToItem(this.viewFromModelId(e),t)},events:{"click .select-all":"selectAll","click .deselect-all":"deselectAll"},toString:function(){return"ListPanel("+this.collection+")"}});d.prototype.templates=function(){var e=n.wrapTemplate(["<div>",'<div class="controls"></div>','<div class="list-items"></div>','<div class="empty-message infomessagesmall"></div>',"</div>"]),t=n.wrapTemplate(['<div class="controls">','<div class="title">','<div class="name"><%- view.title %></div>',"</div>",'<div class="subtitle"><%- view.subtitle %></div>','<div class="actions"></div>','<div class="messages"></div>','<div class="search">','<div class="search-input"></div>',"</div>",'<div class="list-actions">','<div class="btn-group">','<button class="select-all btn btn-default"','data-mode="select">',s("All"),"</button>",'<button class="deselect-all btn btn-default"','data-mode="select">',s("None"),"</button>","</div>",'<div class="list-action-menu btn-group">',"</div>","</div>","</div>"]);return{el:e,controls:t}}();var c=d.extend({modelCollectionKey:"contents",initialize:function(e){d.prototype.initialize.call(this,e),this.selecting=void 0!==e.selecting&&e.selecting,this.setModel(this.model,e)},setModel:function(e,t){if(t=t||{},this.debug(this+".setModel:",e,t),this.freeModel(),this.freeViews(),e){var i=this.model?this.model.get("id"):null;this.model=e,this.logger&&(this.model.logger=this.logger),this._setUpModelListeners(),this.collection.off(),this.collection=this.model[this.modelCollectionKey]?this.model[this.modelCollectionKey]:t.collection||new this.collectionClass([]),this._setUpCollectionListeners(),i&&e.get("id")!==i&&this.trigger("new-model",this)}return this},freeModel:function(){return this.model&&this.stopListening(this.model),this},_setUpModelListeners:function(){return this.log(this+"._setUpModelListeners",this.model),this.listenTo(this.model,"error",function(){var e=Array.prototype.slice.call(arguments,0);e.unshift("error"),this.trigger.apply(this,e)},this),this},_renderControls:function(e){this.debug(this+"(ListPanel)._renderControls");var t=this.model?this.model.toJSON():{},i=r(this.templates.controls(t,this));return e.find(".controls").replaceWith(i),i},toString:function(){return"ModelListPanel("+this.model+")"}});return c.prototype.templates=function(){var e=n.wrapTemplate(['<div class="controls">','<div class="title">','<div class="name"><%- model.name %></div>',"</div>",'<div class="subtitle"><%- view.subtitle %></div>','<div class="actions"></div>','<div class="messages"></div>','<div class="search">','<div class="search-input"></div>',"</div>",'<div class="list-actions">','<div class="btn-group">','<button class="select-all btn btn-default"','data-mode="select">',s("All"),"</button>",'<button class="deselect-all btn btn-default"','data-mode="select">',s("None"),"</button>","</div>",'<div class="list-action-menu btn-group">',"</div>","</div>","</div>"]);return a.extend(a.clone(d.prototype.templates),{controls:e})}(),{ListPanel:d,ModelListPanel:c}}.apply(t,n),!(void 0!==s&&(e.exports=s))}).call(t,i(3),i(2),i(1))},function(e,t,i){var n,s;(function(o,a){n=[i(6),i(4)],s=function(e,t){var i=o.View.extend(e.LoggableMixin).extend(e.HiddenUntilActivatedViewMixin).extend({tagName:"div",className:"tags-display",initialize:function(e){this.listenTo(this.model,"change:tags",function(){this.render()}),this.hiddenUntilActivated(e.$activator,e)},render:function(){var e=this;return this.$el.html(this._template()),this.$input().select2({placeholder:"Add tags",width:"100%",tags:function(){return e._getTagsUsed()}}),this._setUpBehaviors(),this},_template:function(){return['<label class="prompt">',t("Tags"),"</label>",'<input class="tags-input" value="',this.tagsToCSV(),'" />'].join("")},tagsToCSV:function(){var e=this.model.get("tags");return!a.isArray(e)||a.isEmpty(e)?"":e.map(function(e){return a.escape(e)}).sort().join(",")},$input:function(){return this.$el.find("input.tags-input")},_getTagsUsed:function(){return Galaxy.user.get("tags_used")},_setUpBehaviors:function(){var e=this;this.$input().on("change",function(t){e.model.save({tags:t.val},{silent:!0}),t.added&&e._addNewTagToTagsUsed(t.added.text+"")})},_addNewTagToTagsUsed:function(e){var t=Galaxy.user.get("tags_used");a.contains(t,e)||(t.push(e),t.sort(),Galaxy.user.set("tags_used",t))},remove:function(){this.$input.off(),this.stopListening(this.model),o.View.prototype.remove.call(this)},toString:function(){return["TagsEditor(",this.model+"",")"].join("")}});return{TagsEditor:i}}.apply(t,n),!(void 0!==s&&(e.exports=s))}).call(t,i(3),i(2))},,,,function(e,t,i){var n,s;(function(o,a){n=[i(5)],s=function(e){return o.View.extend({initialize:function(t){this.options=e.merge(t,{class_add:"upload-icon-button fa fa-square-o",class_remove:"upload-icon-button fa fa-check-square-o",class_partial:"upload-icon-button fa fa-minus-square-o",collection:null,onchange:function(){},onadd:function(){},onremove:function(){}});var i=this;this.collection=this.options.collection,this.setElement(this._template()),this.rows=[],e.get({url:Galaxy.root+"api/remote_files",success:function(e){i._fill(e)},error:function(){i._fill()}})},_fill:function(t){if(t&&t.length>0){this.$el.find("#upload-ftp-content").html(a(this._templateTable()));var i=0;for(index in t)this.rows.push(this._add(t[index])),i+=t[index].size;if(this.$el.find("#upload-ftp-number").html(t.length+" files"),this.$el.find("#upload-ftp-disk").html(e.bytesToString(i,!0)),this.collection){var n=this;this.$("._has_collection").show(),this.$select_all=a("#upload-selectall"),this.$select_all.addClass(this.options.class_add),this.$select_all.on("click",function(){var e=n.$select_all.hasClass(n.options.class_add);for(index in t){var i=t[index],s=n._find(i);(!s&&e||s&&!e)&&n.rows[index].trigger("click")}}),this._refresh()}}else this.$el.find("#upload-ftp-content").html(a(this._templateInfo()));this.$el.find("#upload-ftp-wait").hide()},_add:function(e){var t=this,i=a(this._templateRow(e)),n=i.find(".icon");if(a(this.el).find("tbody").append(i),this.collection){var s="";s=this._find(e)?this.options.class_remove:this.options.class_add,n.addClass(s),i.on("click",function(){var i=t._find(e);n.removeClass(),i?(t.options.onremove(i),n.addClass(t.options.class_add)):(t.options.onadd(e),n.addClass(t.options.class_remove)),t._refresh()})}else i.on("click",function(){t.options.onchange(e)});return i},_refresh:function(){var e=this.collection.where({file_mode:"ftp",enabled:!0});this.$select_all.removeClass(),0==e.length?this.$select_all.addClass(this.options.class_add):e.length==this.rows.length?this.$select_all.addClass(this.options.class_remove):this.$select_all.addClass(this.options.class_partial)},_find:function(e){var t=this.collection.findWhere({file_path:e.path,file_mode:"ftp",enabled:!0});return t&&t.get("id")},_templateRow:function(t){return'<tr class="upload-ftp-row"><td class="_has_collection" style="display: none;"><div class="icon"/></td><td class="ftp-name">'+t.path+'</td><td class="ftp-size">'+e.bytesToString(t.size)+'</td><td class="ftp-time">'+t.ctime+"</td></tr>"},_templateTable:function(){return'<span style="whitespace: nowrap; float: left;">Available files: </span><span style="whitespace: nowrap; float: right;"><span class="upload-icon fa fa-file-text-o"/><span id="upload-ftp-number"/>&nbsp;&nbsp;<span class="upload-icon fa fa-hdd-o"/><span id="upload-ftp-disk"/></span><table class="grid" style="float: left;"><thead><tr><th class="_has_collection" style="display: none;"><div id="upload-selectall"></th><th>Name</th><th>Size</th><th>Created</th></tr></thead><tbody/></table>'},_templateInfo:function(){return'<div class="upload-ftp-warning warningmessage">Your FTP directory does not contain any files.</div>';
},_template:function(){return'<div class="upload-ftp"><div id="upload-ftp-wait" class="upload-ftp-wait fa fa-spinner fa-spin"/><div class="upload-ftp-help">This Galaxy server allows you to upload files via FTP. To upload some files, log in to the FTP server at <strong>'+this.options.ftp_upload_site+'</strong> using your Galaxy credentials (email address and password).</div><div id="upload-ftp-content"/><div>'}})}.apply(t,n),!(void 0!==s&&(e.exports=s))}).call(t,i(3),i(1))},function(e,t,i){var n,s;(function(o,a,r){n=[i(5)],s=function(e){return o.View.extend({options:{class_check:"fa-check-square-o",class_uncheck:"fa-square-o",parameters:[{id:"space_to_tab",title:"Convert spaces to tabs"},{id:"to_posix_lines",title:"Use POSIX standard"}]},initialize:function(e){this.model=e.model,this.setElement(a("<div/>").addClass("upload-settings")),this.$el.append(a("<div/>").addClass("upload-settings-cover")),this.$el.append(a("<table/>").addClass("upload-settings-table ui-table-striped").append("<tbody/>")),this.$cover=this.$(".upload-settings-cover"),this.$table=this.$(".upload-settings-table > tbody"),this.listenTo(this.model,"change",this.render,this),this.model.trigger("change")},render:function(){var e=this;this.$table.empty(),r.each(this.options.parameters,function(t){var i=a("<div/>").addClass("upload-"+t.id+" upload-icon-button fa").addClass(e.model.get(t.id)&&e.options.class_check||e.options.class_uncheck).on("click",function(){e.model.get("enabled")&&e.model.set(t.id,!e.model.get(t.id))});e.$table.append(a("<tr/>").append(a("<td/>").append(i)).append(a("<td/>").append(t.title)))}),this.$cover[this.model.get("enabled")&&"hide"||"show"]()}})}.apply(t,n),!(void 0!==s&&(e.exports=s))}).call(t,i(3),i(1),i(2))},,,function(e,t,i){var n,s,o;(function(i,a){!function(i){s=[],n=i,o="function"==typeof n?n.apply(t,s):n,!(void 0!==o&&(e.exports=o))}(function(){i.fn.extend({hoverhighlight:function(e,t){return e=e||"body",this.length?(a(this).each(function(){var i=a(this),n=i.data("target");n&&i.mouseover(function(i){a(n,e).css({background:t})}).mouseout(function(e){a(n).css({background:""})})}),this):this}})})}).call(t,i(1),i(1))},function(e,t,i){var n,s,o;(function(i,a){!function(i){s=[],n=i,o="function"==typeof n?n.apply(t,s):n,!(void 0!==o&&(e.exports=o))}(function(){function e(e,n){function s(e){var t=i(this).parent().children("input");t.focus().val("").trigger("clear:searchInput"),n.onclear()}function o(e,t){i(this).trigger("search:searchInput",t),"function"==typeof n.onfirstsearch&&m?(m=!1,n.onfirstsearch(t)):n.onsearch(t)}function r(){return['<input type="text" name="',n.name,'" placeholder="',n.placeholder,'" ','class="search-query ',n.classes,'" ',"/>"].join("")}function l(){return i(r()).focus(function(e){i(this).select()}).keyup(function(e){if(e.preventDefault(),e.stopPropagation(),i(this).val()||i(this).blur(),e.which===u&&n.escWillClear)s.call(this,e);else{var t=i(this).val();e.which===p||n.minSearchLen&&t.length>=n.minSearchLen?o.call(this,e,t):t.length||s.call(this,e)}}).on("change",function(e){o.call(this,e,i(this).val())}).val(n.initialVal)}function d(){return i(['<span class="search-clear fa fa-times-circle" ','title="',t("clear search (esc)"),'"></span>'].join("")).tooltip({placement:"bottom"}).click(function(e){s.call(this,e)})}function c(){return i(['<span class="search-loading fa fa-spinner fa-spin" ','title="',t("loading..."),'"></span>'].join("")).hide().tooltip({placement:"bottom"})}function h(){f.find(".search-loading").toggle(),f.find(".search-clear").toggle()}var u=27,p=13,f=i(e),m=!0,g={initialVal:"",name:"search",placeholder:"search",classes:"",onclear:function(){},onfirstsearch:null,onsearch:function(e){},minSearchLen:0,escWillClear:!0,oninit:function(){}};return"string"===a.type(n)?("toggle-loading"===n&&h(),f):("object"===a.type(n)&&(n=a.extend(!0,{},g,n)),f.addClass("search-input").prepend([l(),d(),c()]))}var t=window._l||function(e){return e};a.fn.extend({searchInput:function(t){return this.each(function(){return e(this,t)})}})})}).call(t,i(1),i(1))},,function(e,t,i){var n,s;n=[],s=function(){function e(e,t){var i=/(-?[0-9\.]+)/g,n=e.toString().toLowerCase()||"",s=t.toString().toLowerCase()||"",o=String.fromCharCode(0),a=n.replace(i,o+"$1"+o).split(o),r=s.replace(i,o+"$1"+o).split(o),l=new Date(n).getTime(),d=l?new Date(s).getTime():null;if(d){if(l<d)return-1;if(l>d)return 1}for(var c,h,u=0,p=Math.max(a.length,r.length);u<p;u++){if(c=parseFloat(a[u])||a[u],h=parseFloat(r[u])||r[u],c<h)return-1;if(c>h)return 1}return 0}return e}.apply(t,n),!(void 0!==s&&(e.exports=s))},function(e,t,i){(function(e,t){!function(i){e.event.props.push("dataTransfer"),i.uploadpost=function(t){var n=i.extend({},{data:{},success:function(){},error:function(){},progress:function(){},url:null,maxfilesize:2048,error_filesize:"File exceeds 2GB. Please use a FTP client.",error_default:"Please make sure the file is available.",error_server:"Upload request failed.",error_login:"Uploads require you to log in."},t),s=n.data;if(s.error_message)return void n.error(s.error_message);var o=new FormData;for(var a in s.payload)o.append(a,s.payload[a]);var r=0;for(var a in s.files){var l=s.files[a];o.append(l.name,l.file,l.file.name),r+=l.file.size}return r>1048576*n.maxfilesize?void n.error(n.error_filesize):(xhr=new XMLHttpRequest,xhr.open("POST",n.url,!0),xhr.setRequestHeader("Accept","application/json"),xhr.setRequestHeader("Cache-Control","no-cache"),xhr.setRequestHeader("X-Requested-With","XMLHttpRequest"),xhr.onreadystatechange=function(){if(xhr.readyState==xhr.DONE){var t=null;if(xhr.responseText)try{t=e.parseJSON(xhr.responseText)}catch(i){t=xhr.responseText}if(xhr.status<200||xhr.status>299){var s=xhr.statusText;403==xhr.status?s=n.error_login:0==xhr.status?s=n.error_server:s||(s=n.error_default),n.error(s+" ("+xhr.status+")")}else n.success(t)}},xhr.upload.addEventListener("progress",function(e){e.lengthComputable&&n.progress(Math.round(100*e.loaded/e.total))},!1),Galaxy.emit.debug("uploadbox::uploadpost()","Posting following data.",n),void xhr.send(o))},i.fn.uploadinput=function(e){var t=this,n=i.extend({},{ondragover:function(){},ondragleave:function(){},onchange:function(){},multiple:!1},e),s=i('<input type="file" style="display: none" '+(n.multiple&&"multiple"||"")+"/>");return t.append(s.change(function(e){n.onchange(e.target.files),i(this).val("")})),t.on("drop",function(e){n.ondragleave(e),e.dataTransfer&&(n.onchange(e.dataTransfer.files),e.preventDefault())}),t.on("dragover",function(e){e.preventDefault(),n.ondragover(e)}),t.on("dragleave",function(e){e.stopPropagation(),n.ondragleave(e)}),{dialog:function(){s.trigger("click")}}},i.fn.uploadbox=function(e){function n(e){if(e&&e.length&&!g){var i=f;return t.each(e,function(e,i){"new"!==e.mode&&t.filter(p,function(t){return t.name===e.name&&t.size===e.size}).length&&(e.duplicate=!0)}),t.each(e,function(e){if(!e.duplicate){var t=String(f++);p[t]=e,u.announce(t,p[t]),m++}}),i}}function s(e){p[e]&&(delete p[e],m--)}function o(){if(0==m||v)return v=!1,g=!1,void u.complete();g=!0;var e=-1;for(var t in p){e=t;break}p[e];s(e),i.uploadpost({url:u.url,data:u.initialize(e),success:function(t){u.success(e,t),o()},error:function(t){u.error(e,t),o()},progress:function(t){u.progress(e,t)}})}function a(){_.dialog()}function r(e){for(e in p)s(e)}function l(){g||(g=!0,o())}function d(){v=!0}function c(e){return u=i.extend({},u,e)}function h(){return window.File&&window.FormData&&window.XMLHttpRequest&&window.FileList}var u=i.extend({},{dragover:function(){},dragleave:function(){},announce:function(e){},initialize:function(e){},progress:function(e,t){},success:function(e,t){},error:function(e,t){alert(t)},complete:function(){}},e),p={},f=0,m=0,g=!1,v=!1,_=i(this).uploadinput({multiple:!0,onchange:function(e){n(e)},ondragover:e.ondragover,ondragleave:e.ondragleave});return{select:a,add:n,remove:s,start:l,stop:d,reset:r,configure:c,compatible:h}}}(e)}).call(t,i(1),i(2))},function(e,t,i){var n=i(10).RightPanel,s=i(7),o=i(100);CurrentHistoryView=i(97).CurrentHistoryView,_l=i(4);var a=n.extend({title:_l("History"),initialize:function(e){n.prototype.initialize.call(this,e);var t=this;this.refreshButton=new s.ButtonLink({id:"history-refresh-button",title:_l("Refresh history"),cls:"panel-header-button",icon:"fa fa-refresh",onclick:function(){t.historyView.loadCurrentHistory()}}),this.optionsButton=new s.ButtonLink({id:"history-options-button",title:_l("History options"),cls:"panel-header-button",icon:"fa fa-cog"}),this.viewMultiButton=null,e.userIsAnonymous||(this.viewMultiButton=new s.ButtonLink({id:"history-view-multi-button",title:_l("View all histories"),cls:"panel-header-button",icon:"fa fa-columns",href:e.galaxyRoot+"history/view_multiple"})),this.optionsMenu=o(this.optionsButton.$el,{anonymous:e.userIsAnonymous,purgeAllowed:e.allow_user_dataset_purge,root:e.galaxyRoot}),this.historyView=new CurrentHistoryView({purgeAllowed:e.allow_user_dataset_purge,linkTarget:"galaxy_main",$scrollContainer:function(){return this.$el.parent()}})},render:function(){n.prototype.render.call(this),this.$(".unified-panel-header").addClass("history-panel-header"),this.$(".panel-header-buttons").append([this.refreshButton.$el,this.optionsButton.$el,this.viewMultiButton?this.viewMultiButton.$el:null]),this.historyView.setElement(this.$(".history-panel"))},_templateBody:function(e){return['<div class="unified-panel-body unified-panel-body-background">','<div id="current-history-panel" class="history-panel"/>',"</div>"].join("")},toString:function(){return"HistoryPanel"}});e.exports=a},function(e,t,i){(function(t,n){var s=i(10).LeftPanel,o=i(29),a=i(114),r=i(4),l=s.extend({title:r("Tools"),initialize:function(e){s.prototype.initialize.call(this,e),this.log(this+".initialize:",e),this.stored_workflow_menu_entries=e.stored_workflow_menu_entries||[];var t=new o.ToolSearch({search_url:e.search_url,hidden:!1}),i=new o.ToolCollection(e.toolbox);this.tool_panel=new o.ToolPanel({tool_search:t,tools:i,layout:e.toolbox_in_panel}),this.tool_panel_view=new o.ToolPanelView({model:this.tool_panel}),this.uploadButton=new a({nginx_upload_path:e.nginx_upload_path,ftp_upload_site:e.ftp_upload_site,default_genome:e.default_genome,default_extension:e.default_extension})},render:function(){var e=this;s.prototype.render.call(e),e.$(".panel-header-buttons").append(e.uploadButton.$el),e.tool_panel.get("layout").size()>0&&(e.tool_panel_view.render(),e.$(".toolMenu").show()),e.$(".toolMenuContainer").prepend(e.tool_panel_view.$el),e._renderWorkflowMenu(),e.$("a[minsizehint]").click(function(){parent.handle_minwidth_hint&&parent.handle_minwidth_hint(t(e).attr("minsizehint"))})},_renderWorkflowMenu:function(){var e=this;e.$("#internal-workflows").append(e._templateTool({title:r("All workflows"),href:"workflow/list_for_run"})),n.each(e.stored_workflow_menu_entries,function(t){e.$("#internal-workflows").append(e._templateTool({title:t.stored_workflow.name,href:"workflow/run?id="+t.encoded_stored_workflow_id}))})},_templateTool:function(e){return['<div class="toolTitle">','<a href="',Galaxy.root,e.href,'" target="galaxy_main">',e.title,"</a>","</div>"].join("")},_templateBody:function(){return['<div class="unified-panel-body unified-panel-body-background">','<div class="toolMenuContainer">','<div class="toolMenu" style="display: none">','<div id="search-no-results" style="display: none; padding-top: 5px">',"<em><strong>",r("Search did not match any tools."),"</strong></em>","</div>","</div>",'<div class="toolSectionPad"/>','<div class="toolSectionPad"/>','<div class="toolSectionTitle" id="title_XXinternalXXworkflow">',"<span>",r("Workflows"),"</span>","</div>",'<div id="internal-workflows" class="toolSectionBody">','<div class="toolSectionBg"/>',"</div>","</div>","</div>"].join("")},toString:function(){return"ToolPanel"}});e.exports=l}).call(t,i(1),i(2))},,,,,,,,,,,,function(e,t,i){var n,s;(function(o,a){n=[i(21),i(51),i(6),i(4)],s=function(e,t,i,n){"use strict";var s=e.DCListItemView,r=s.extend({initialize:function(e){s.prototype.initialize.call(this,e)},toString:function(){var e=this.model?this.model+"":"(no model)";return"DCListItemEdit("+e+")"}}),l=e.DCEListItemView,d=l.extend({initialize:function(e){l.prototype.initialize.call(this,e)},toString:function(){var e=this.model?this.model+"":"(no model)";return"DCEListItemEdit("+e+")"}}),c=t.DatasetListItemEdit.extend({initialize:function(e){t.DatasetListItemEdit.prototype.initialize.call(this,e)},_fetchModelDetails:function(){var e=this;return e.model.inReadyState()&&!e.model.hasDetails()?e.model.fetch({silent:!0}):o.when()},_renderDeleteButton:function(){return null},toString:function(){var e=this.model?this.model+"":"(no model)";return"DatasetDCEListItemEdit("+e+")"}});c.prototype.templates=function(){return a.extend({},t.DatasetListItemEdit.prototype.templates,{titleBar:e.DatasetDCEListItemView.prototype.templates.titleBar})}();var h=e.NestedDCDCEListItemView.extend({toString:function(){var e=this.model?this.model+"":"(no model)";return"NestedDCDCEListItemEdit("+e+")"}});return{DCListItemEdit:r,DCEListItemEdit:d,DatasetDCEListItemEdit:c,NestedDCDCEListItemEdit:h}}.apply(t,n),!(void 0!==s&&(e.exports=s))}).call(t,i(1),i(2))},function(e,t,i){var n,s;n=[i(50),i(22),i(84),i(6),i(4),i(14)],s=function(e,t,i,n,s){"use strict";var o=e.CollectionView,a=o.extend({DatasetDCEViewClass:i.DatasetDCEListItemEdit,NestedDCDCEViewClass:i.NestedDCDCEListItemEdit,initialize:function(e){o.prototype.initialize.call(this,e)},_setUpBehaviors:function(e){if(e=e||this.$el,o.prototype._setUpBehaviors.call(this,e),this.model&&Galaxy.user&&!Galaxy.user.isAnonymous()){var t=this,i="> .controls .name";e.find(i).attr("title",s("Click to rename collection")).tooltip({placement:"bottom"}).make_text_editable({on_finish:function(e){var n=t.model.get("name");e&&e!==n?(t.$el.find(i).text(e),t.model.save({name:e}).fail(function(){t.$el.find(i).text(t.model.previous("name"))})):t.$el.find(i).text(n)}})}},toString:function(){return"CollectionViewEdit("+(this.model?this.model.get("name"):"")+")"}}),r=a.extend({DatasetDCEViewClass:i.DatasetDCEListItemEdit,toString:function(){return"ListCollectionViewEdit("+(this.model?this.model.get("name"):"")+")"}}),l=r.extend({toString:function(){return"PairCollectionViewEdit("+(this.model?this.model.get("name"):"")+")"}}),d=l.extend({_setUpBehaviors:function(e){o.prototype._setUpBehaviors.call(this,e)},toString:function(){return"NestedPairCollectionViewEdit("+(this.model?this.model.get("name"):"")+")"}}),c=a.extend({NestedDCDCEViewClass:i.NestedDCDCEListItemEdit.extend({foldoutPanelClass:d}),toString:function(){return"ListOfPairsCollectionViewEdit("+(this.model?this.model.get("name"):"")+")"}});return{CollectionViewEdit:a,ListCollectionViewEdit:r,PairCollectionViewEdit:l,ListOfPairsCollectionViewEdit:c}}.apply(t,n),!(void 0!==s&&(e.exports=s))},function(e,t,i){var n,s;(function(o,a,r,l){n=[i(122),i(69),i(23),i(6),i(4),i(66)],s=function(e,t,i,n,s){"use strict";function d(e){function t(){return i.length||(i=[new RegExp(this.filters[0]),new RegExp(this.filters[1])]),i}e=e||{},e.createPair=e.createPair||function(e){e=e||{};var t=e.listA.splice(e.indexA,1)[0],i=e.listB.splice(e.indexB,1)[0],n=e.listB.indexOf(t),s=e.listA.indexOf(i);return n!==-1&&e.listB.splice(n,1),s!==-1&&e.listA.splice(s,1),this._pair(t,i,{silent:!0})};var i=[];return e.preprocessMatch=e.preprocessMatch||function(e){var i=t.call(this);return a.extend(e,{matchTo:e.matchTo.name.replace(i[0],""),possible:e.possible.name.replace(i[1],"")})},function(t){this.debug("autopair _strategy ---------------------------"),t=t||{};var i,n=t.listA,s=t.listB,o=0,a={score:0,index:null},r=[];for(this.debug("starting list lens:",n.length,s.length),this.debug("bestMatch (starting):",JSON.stringify(a,null,"  "));o<n.length;){var l=n[o];for(a.score=0,i=0;i<s.length;i++){var d=s[i];if(this.debug(o+":"+l.name),this.debug(i+":"+d.name),n[o]!==s[i]&&(a=e.match.call(this,e.preprocessMatch.call(this,{matchTo:l,possible:d,index:i,bestMatch:a})),this.debug("bestMatch:",JSON.stringify(a,null,"  ")),1===a.score)){this.debug("breaking early due to perfect match");break}}var c=e.scoreThreshold.call(this);if(this.debug("scoreThreshold:",c),this.debug("bestMatch.score:",a.score),a.score>=c?r.push(e.createPair.call(this,{listA:n,indexA:o,listB:s,indexB:a.index})):o+=1,!n.length||!s.length)return r}return this.debug("paired:",JSON.stringify(r,null,"  ")),this.debug("autopair _strategy ---------------------------"),r}}function c(e){var t=e.toJSON();return f(t,{historyId:e.historyId})}var h="collections",u=o.View.extend(n.LoggableMixin).extend({_logNamespace:h,tagName:"li",className:"dataset paired",initialize:function(e){this.pair=e.pair||{}},template:a.template(['<span class="forward-dataset-name flex-column"><%- pair.forward.name %></span>','<span class="pair-name-column flex-column">','<span class="pair-name"><%- pair.name %></span>',"</span>",'<span class="reverse-dataset-name flex-column"><%- pair.reverse.name %></span>'].join("")),render:function(){return this.$el.attr("draggable",!0).data("pair",this.pair).html(this.template({pair:this.pair})).addClass("flex-column-container"),this},events:{dragstart:"_dragstart",dragend:"_dragend",dragover:"_sendToParent",drop:"_sendToParent"},_dragstart:function(e){e.currentTarget.style.opacity="0.4",e.originalEvent&&(e=e.originalEvent),e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/plain",JSON.stringify(this.pair)),this.$el.parent().trigger("pair.dragstart",[this])},_dragend:function(e){e.currentTarget.style.opacity="1.0",this.$el.parent().trigger("pair.dragend",[this])},_sendToParent:function(e){this.$el.parent().trigger(e)},toString:function(){return"PairView("+this.pair.name+")"}}),p=o.View.extend(n.LoggableMixin).extend({_logNamespace:h,className:"list-of-pairs-collection-creator collection-creator flex-row-container",initialize:function(e){this.metric("PairedCollectionCreator.initialize",e),e=a.defaults(e,{datasets:[],filters:this.DEFAULT_FILTERS,automaticallyPair:!0,strategy:"lcs",matchPercentage:.9,twoPassAutopairing:!0}),this.initialList=e.datasets,this.historyId=e.historyId,this.filters=this.commonFilters[e.filters]||this.commonFilters[this.DEFAULT_FILTERS],a.isArray(e.filters)&&(this.filters=e.filters),this.automaticallyPair=e.automaticallyPair,this.strategy=this.strategies[e.strategy]||this.strategies[this.DEFAULT_STRATEGY],a.isFunction(e.strategy)&&(this.strategy=e.strategy),this.matchPercentage=e.matchPercentage,this.twoPassAutopairing=e.twoPassAutopairing,this.removeExtensions=!0,this.oncancel=e.oncancel,this.oncreate=e.oncreate,this.autoscrollDist=e.autoscrollDist||24,this.unpairedPanelHidden=!1,this.pairedPanelHidden=!1,this.$dragging=null,this.blocking=!1,this._setUpBehaviors(),this._dataSetUp()},commonFilters:{illumina:["_1","_2"],Rs:["_R1","_R2"]},DEFAULT_FILTERS:"illumina",strategies:{simple:"autopairSimple",lcs:"autopairLCS",levenshtein:"autopairLevenshtein"},DEFAULT_STRATEGY:"lcs",_dataSetUp:function(){this.paired=[],this.unpaired=[],this.selectedIds=[],this._sortInitialList(),this._ensureIds(),this.unpaired=this.initialList.slice(0),this.automaticallyPair&&(this.autoPair(),this.once("rendered:initial",function(){this.trigger("autopair")}))},_sortInitialList:function(){this._sortDatasetList(this.initialList)},_sortDatasetList:function(e){return e.sort(function(e,i){return t(e.name,i.name)}),e},_ensureIds:function(){return this.initialList.forEach(function(e){e.hasOwnProperty("id")||(e.id=a.uniqueId())}),this.initialList},_splitByFilters:function(){function e(e,t){return t.test(e.name)}var t=this.filters.map(function(e){return new RegExp(e)}),i=[[],[]];return this.unpaired.forEach(function(n){t.forEach(function(t,s){e(n,t)&&i[s].push(n)})}),i},_addToUnpaired:function(e){var i=function(n,s){if(n===s)return n;var o=Math.floor((s-n)/2)+n,a=t(e.name,this.unpaired[o].name);if(a<0)return i(n,o);if(a>0)return i(o+1,s);for(;this.unpaired[o]&&this.unpaired[o].name===e.name;)o++;return o}.bind(this);this.unpaired.splice(i(0,this.unpaired.length),0,e)},autoPair:function(e){var t=this._splitByFilters(),i=[];return this.twoPassAutopairing&&(i=this.autopairSimple({listA:t[0],listB:t[1]}),t=this._splitByFilters()),e=e||this.strategy,t=this._splitByFilters(),i=i.concat(this[e].call(this,{listA:t[0],listB:t[1]}))},autopairSimple:d({scoreThreshold:function(){return 1},match:function(e){return e=e||{},e.matchTo===e.possible?{index:e.index,score:1}:e.bestMatch}}),autopairLevenshtein:d({scoreThreshold:function(){return this.matchPercentage},match:function(t){t=t||{};var i=e(t.matchTo,t.possible),n=1-i/Math.max(t.matchTo.length,t.possible.length);return n>t.bestMatch.score?{index:t.index,score:n}:t.bestMatch}}),autopairLCS:d({scoreThreshold:function(){return this.matchPercentage},match:function(e){e=e||{};var t=this._naiveStartingAndEndingLCS(e.matchTo,e.possible).length,i=t/Math.max(e.matchTo.length,e.possible.length);return i>e.bestMatch.score?{index:e.index,score:i}:e.bestMatch}}),_naiveStartingAndEndingLCS:function(e,t){for(var i="",n="",s=0,o=0;s<e.length&&s<t.length&&e[s]===t[s];)i+=e[s],s+=1;if(s===e.length)return e;if(s===t.length)return t;for(s=e.length-1,o=t.length-1;s>=0&&o>=0&&e[s]===t[o];)n=[e[s],n].join(""),s-=1,o-=1;return i+n},_pair:function(e,t,i){i=i||{},this.debug("_pair:",e,t);var n=this._createPair(e,t,i.name);return this.paired.push(n),this.unpaired=a.without(this.unpaired,e,t),i.silent||this.trigger("pair:new",n),n},_createPair:function(e,t,i){if(!e||!t||e===t)throw new Error("Bad pairing: "+[JSON.stringify(e),JSON.stringify(t)]);return i=i||this._guessNameForPair(e,t),{forward:e,name:i,reverse:t}},_guessNameForPair:function(e,t,i){i=void 0!==i?i:this.removeExtensions;var n=e.name,s=t.name,o=this._naiveStartingAndEndingLCS(n.replace(new RegExp(this.filters[0]),""),s.replace(new RegExp(this.filters[1]),""));if(i){var a=o.lastIndexOf(".");if(a>0){var r=o.slice(a,o.length);o=o.replace(r,""),n=n.replace(r,""),s=s.replace(r,"")}}return o||n+" & "+s},_unpair:function(e,t){if(t=t||{},!e)throw new Error("Bad pair: "+JSON.stringify(e));return this.paired=a.without(this.paired,e),this._addToUnpaired(e.forward),this._addToUnpaired(e.reverse),t.silent||this.trigger("pair:unpair",[e]),e},unpairAll:function(){for(var e=[];this.paired.length;)e.push(this._unpair(this.paired[0],{silent:!0}));this.trigger("pair:unpair",e)},_pairToJSON:function(e,t){return t=t||"hda",{collection_type:"paired",src:"new_collection",name:e.name,element_identifiers:[{name:"forward",id:e.forward.id,src:t},{name:"reverse",id:e.reverse.id,src:t}]}},createList:function(e){var t=this,i=Galaxy.root+"api/histories/"+this.historyId+"/contents/dataset_collections",n={type:"dataset_collection",collection_type:"list:paired",name:a.escape(e||t.$(".collection-name").val()),element_identifiers:t.paired.map(function(e){return t._pairToJSON(e)})};return t.blocking=!0,r.ajax(i,{type:"POST",contentType:"application/json",dataType:"json",data:JSON.stringify(n)}).always(function(){t.blocking=!1}).fail(function(e,i,n){t._ajaxErrHandler(e,i,n)}).done(function(e,i,n){t.trigger("collection:created",e,i,n),t.metric("collection:created",e),"function"==typeof t.oncreate&&t.oncreate.call(this,e,i,n)})},_ajaxErrHandler:function(e,t,i){this.error(e,t,i);var n=s("An error occurred while creating this collection");e&&(n+=0===e.readyState&&0===e.status?": "+s("Galaxy could not be reached and may be updating.")+s(" Try again in a few minutes."):e.responseJSON?"<br /><pre>"+JSON.stringify(e.responseJSON)+"</pre>":": "+i),creator._showAlert(n,"alert-danger")},render:function(e,t){return this.$el.empty().html(p.templates.main()),this._renderHeader(e),this._renderMiddle(e),this._renderFooter(e),this._addPluginComponents(),this.trigger("rendered",this),this},_renderHeader:function(e,t){var i=this.$(".header").empty().html(p.templates.header()).find(".help-content").prepend(l(p.templates.helpContent()));return this._renderFilters(),i},_renderFilters:function(){return this.$(".forward-column .column-header input").val(this.filters[0]).add(this.$(".reverse-column .column-header input").val(this.filters[1]))},_renderMiddle:function(e,t){var i=this.$(".middle").empty().html(p.templates.middle());return this.unpairedPanelHidden?this.$(".unpaired-columns").hide():this.pairedPanelHidden&&this.$(".paired-columns").hide(),this._renderUnpaired(),this._renderPaired(),i},_renderUnpaired:function(e,t){var i,n,o=this,a=[],r=this._splitByFilters();return this.$(".forward-column .title").text([r[0].length,s("unpaired forward")].join(" ")),this.$(".forward-column .unpaired-info").text(this._renderUnpairedDisplayStr(this.unpaired.length-r[0].length)),this.$(".reverse-column .title").text([r[1].length,s("unpaired reverse")].join(" ")),this.$(".reverse-column .unpaired-info").text(this._renderUnpairedDisplayStr(this.unpaired.length-r[1].length)),this.$(".unpaired-columns .column-datasets").empty(),this.$(".autopair-link").toggle(0!==this.unpaired.length),0===this.unpaired.length?void this._renderUnpairedEmpty():(n=r[1].map(function(e,t){return void 0!==r[0][t]&&r[0][t]!==e&&a.push(o._renderPairButton()),o._renderUnpairedDataset(e)}),i=r[0].map(function(e){return o._renderUnpairedDataset(e)}),i.length||n.length?(this.$(".unpaired-columns .forward-column .column-datasets").append(i).add(this.$(".unpaired-columns .paired-column .column-datasets").append(a)).add(this.$(".unpaired-columns .reverse-column .column-datasets").append(n)),void this._adjUnpairedOnScrollbar()):void this._renderUnpairedNotShown())},_renderUnpairedDisplayStr:function(e){return["(",e," ",s("filtered out"),")"].join("")},_renderUnpairedDataset:function(e){return l("<li/>").attr("id","dataset-"+e.id).addClass("dataset unpaired").attr("draggable",!0).addClass(e.selected?"selected":"").append(l("<span/>").addClass("dataset-name").text(e.name)).data("dataset",e)},_renderPairButton:function(){return l("<li/>").addClass("dataset unpaired").append(l("<span/>").addClass("dataset-name").text(s("Pair these datasets")))},_renderUnpairedEmpty:function(){var e=l('<div class="empty-message"></div>').text("("+s("no remaining unpaired datasets")+")");return this.$(".unpaired-columns .paired-column .column-datasets").empty().prepend(e),e},_renderUnpairedNotShown:function(){var e=l('<div class="empty-message"></div>').text("("+s("no datasets were found matching the current filters")+")");return this.$(".unpaired-columns .paired-column .column-datasets").empty().prepend(e),e},_adjUnpairedOnScrollbar:function(){var e=this.$(".unpaired-columns").last(),t=this.$(".unpaired-columns .reverse-column .dataset").first();if(t.length){var i=e.offset().left+e.outerWidth(),n=t.offset().left+t.outerWidth(),s=Math.floor(i)-Math.floor(n);this.$(".unpaired-columns .forward-column").css("margin-left",s>0?s:0)}},_renderPaired:function(e,t){if(this.$(".paired-column-title .title").text([this.paired.length,s("paired")].join(" ")),this.$(".unpair-all-link").toggle(0!==this.paired.length),0===this.paired.length)return void this._renderPairedEmpty();this.$(".remove-extensions-link").show(),this.$(".paired-columns .column-datasets").empty();var i=this;this.paired.forEach(function(e,t){var n=new u({pair:e});i.$(".paired-columns .column-datasets").append(n.render().$el).append(['<button class="unpair-btn">','<span class="fa fa-unlink" title="',s("Unpair"),'"></span>',"</button>"].join(""))})},_renderPairedEmpty:function(){var e=l('<div class="empty-message"></div>').text("("+s("no paired datasets yet")+")");return this.$(".paired-columns .column-datasets").empty().prepend(e),e},_renderFooter:function(e,t){var i=this.$(".footer").empty().html(p.templates.footer());return this.$(".remove-extensions").prop("checked",this.removeExtensions),"function"==typeof this.oncancel&&this.$(".cancel-create.btn").show(),i},_addPluginComponents:function(){this._chooseFiltersPopover(".choose-filters-link"),this.$(".help-content i").hoverhighlight(".collection-creator","rgba( 64, 255, 255, 1.0 )")},_chooseFiltersPopover:function(e){function t(e,t){return['<button class="filter-choice btn" ','data-forward="',e,'" data-reverse="',t,'">',s("Forward"),": ",e,", ",s("Reverse"),": ",t,"</button>"].join("")}var i=l(a.template(['<div class="choose-filters">','<div class="help">',s("Choose from the following filters to change which unpaired reads are shown in the display"),":</div>",a.values(this.commonFilters).map(function(e){return t(e[0],e[1])}).join(""),"</div>"].join(""))({}));return this.$(e).popover({container:".collection-creator",placement:"bottom",html:!0,content:i})},_validationWarning:function(e,t){var i="validation-warning";"name"===e&&(e=this.$(".collection-name").add(this.$(".collection-name-prompt")),this.$(".collection-name").focus().select()),t?(e=e||this.$("."+i),e.removeClass(i)):e.addClass(i)},_setUpBehaviors:function(){return this.once("rendered",function(){this.trigger("rendered:initial",this)}),this.on("pair:new",function(){this._renderUnpaired(),this._renderPaired(),this.$(".paired-columns").scrollTop(8e6)}),this.on("pair:unpair",function(e){this._renderUnpaired(),this._renderPaired(),this.splitView()}),this.on("filter-change",function(){this.filters=[this.$(".forward-unpaired-filter input").val(),this.$(".reverse-unpaired-filter input").val()],this.metric("filter-change",this.filters),this._renderFilters(),this._renderUnpaired()}),this.on("autopair",function(){this._renderUnpaired(),this._renderPaired();var e,t=null;this.paired.length?(t="alert-success",e=this.paired.length+" "+s("pairs created"),this.unpaired.length||(e+=": "+s("all datasets have been successfully paired"),this.hideUnpaired(),this.$(".collection-name").focus())):e=s(["Could not automatically create any pairs from the given dataset names.","You may want to choose or enter different filters and try auto-pairing again.","Close this message using the X on the right to view more help."].join(" ")),this._showAlert(e,t)}),this},events:{"click .more-help":"_clickMoreHelp","click .less-help":"_clickLessHelp","click .header .alert button":"_hideAlert","click .forward-column .column-title":"_clickShowOnlyUnpaired","click .reverse-column .column-title":"_clickShowOnlyUnpaired","click .unpair-all-link":"_clickUnpairAll","change .forward-unpaired-filter input":function(e){this.trigger("filter-change")},"focus .forward-unpaired-filter input":function(e){l(e.currentTarget).select()},"click .autopair-link":"_clickAutopair","click .choose-filters .filter-choice":"_clickFilterChoice","click .clear-filters-link":"_clearFilters","change .reverse-unpaired-filter input":function(e){this.trigger("filter-change")},"focus .reverse-unpaired-filter input":function(e){l(e.currentTarget).select()},"click .forward-column .dataset.unpaired":"_clickUnpairedDataset","click .reverse-column .dataset.unpaired":"_clickUnpairedDataset","click .paired-column .dataset.unpaired":"_clickPairRow","click .unpaired-columns":"clearSelectedUnpaired","mousedown .unpaired-columns .dataset":"_mousedownUnpaired","click .paired-column-title":"_clickShowOnlyPaired","mousedown .flexible-partition-drag":"_startPartitionDrag","click .paired-columns .dataset.paired":"selectPair","click .paired-columns":"clearSelectedPaired","click .paired-columns .pair-name":"_clickPairName","click .unpair-btn":"_clickUnpair","dragover .paired-columns .column-datasets":"_dragoverPairedColumns","drop .paired-columns .column-datasets":"_dropPairedColumns","pair.dragstart .paired-columns .column-datasets":"_pairDragstart","pair.dragend   .paired-columns .column-datasets":"_pairDragend","change .remove-extensions":function(e){this.toggleExtensions()},"change .collection-name":"_changeName","keydown .collection-name":"_nameCheckForEnter","click .cancel-create":function(e){"function"==typeof this.oncancel&&this.oncancel.call(this)},"click .create-collection":"_clickCreate"},_clickMoreHelp:function(e){this.$(".main-help").addClass("expanded"),this.$(".more-help").hide()},_clickLessHelp:function(e){this.$(".main-help").removeClass("expanded"),this.$(".more-help").show();
},_showAlert:function(e,t){t=t||"alert-danger",this.$(".main-help").hide(),this.$(".header .alert").attr("class","alert alert-dismissable").addClass(t).show().find(".alert-message").html(e)},_hideAlert:function(e){this.$(".main-help").show(),this.$(".header .alert").hide()},_clickShowOnlyUnpaired:function(e){this.$(".paired-columns").is(":visible")?this.hidePaired():this.splitView()},_clickShowOnlyPaired:function(e){this.$(".unpaired-columns").is(":visible")?this.hideUnpaired():this.splitView()},hideUnpaired:function(e,t){this.unpairedPanelHidden=!0,this.pairedPanelHidden=!1,this._renderMiddle(e,t)},hidePaired:function(e,t){this.unpairedPanelHidden=!1,this.pairedPanelHidden=!0,this._renderMiddle(e,t)},splitView:function(e,t){return this.unpairedPanelHidden=this.pairedPanelHidden=!1,this._renderMiddle(e,t),this},_clickUnpairAll:function(e){this.metric("unpairAll"),this.unpairAll()},_clickAutopair:function(e){var t=this.autoPair();this.metric("autopair",t.length,this.unpaired.length),this.trigger("autopair")},_clickFilterChoice:function(e){var t=l(e.currentTarget);this.$(".forward-unpaired-filter input").val(t.data("forward")),this.$(".reverse-unpaired-filter input").val(t.data("reverse")),this._hideChooseFilters(),this.trigger("filter-change")},_hideChooseFilters:function(){this.$(".choose-filters-link").popover("hide"),this.$(".popover").css("display","none")},_clearFilters:function(e){this.$(".forward-unpaired-filter input").val(""),this.$(".reverse-unpaired-filter input").val(""),this.trigger("filter-change")},_clickUnpairedDataset:function(e){return e.stopPropagation(),this.toggleSelectUnpaired(l(e.currentTarget))},toggleSelectUnpaired:function(e,t){t=t||{};var i=e.data("dataset"),n=void 0!==t.force?t.force:!e.hasClass("selected");return e.length&&void 0!==i?(n?(e.addClass("selected"),t.waitToPair||this.pairAllSelected()):e.removeClass("selected"),e):e},pairAllSelected:function(e){e=e||{};var t=this,i=[],n=[],s=[];return t.$(".unpaired-columns .forward-column .dataset.selected").each(function(){i.push(l(this).data("dataset"))}),t.$(".unpaired-columns .reverse-column .dataset.selected").each(function(){n.push(l(this).data("dataset"))}),i.length=n.length=Math.min(i.length,n.length),i.forEach(function(e,i){try{s.push(t._pair(e,n[i],{silent:!0}))}catch(o){t.error(o)}}),s.length&&!e.silent&&this.trigger("pair:new",s),s},clearSelectedUnpaired:function(){this.$(".unpaired-columns .dataset.selected").removeClass("selected")},_mousedownUnpaired:function(e){if(e.shiftKey){var t=this,i=l(e.target).addClass("selected"),n=function(e){t.$(e.target).filter(".dataset").addClass("selected")};i.parent().on("mousemove",n),l(document).one("mouseup",function(e){i.parent().off("mousemove",n),t.pairAllSelected()})}},_clickPairRow:function(e){var t=l(e.currentTarget).index(),i=l(".unpaired-columns .forward-column .dataset").eq(t).data("dataset"),n=l(".unpaired-columns .reverse-column .dataset").eq(t).data("dataset");this._pair(i,n)},_startPartitionDrag:function(e){function t(e){n.$(".flexible-partition-drag").css("color",""),l("body").css("cursor","").unbind("mousemove",i)}function i(e){var t=e.pageY-s;n.adjPartition(t)||l("body").trigger("mouseup"),n._adjUnpairedOnScrollbar(),s+=t}var n=this,s=e.pageY;l("body").css("cursor","ns-resize"),n.$(".flexible-partition-drag").css("color","black"),l("body").mousemove(i),l("body").one("mouseup",t)},adjPartition:function(e){var t=this.$(".unpaired-columns"),i=this.$(".paired-columns"),n=parseInt(t.css("height"),10),s=parseInt(i.css("height"),10);n=Math.max(10,n+e),s-=e;var o=e<0;if(o){if(this.unpairedPanelHidden)return!1;if(n<=10)return this.hideUnpaired(),!1}else this.unpairedPanelHidden&&(t.show(),this.unpairedPanelHidden=!1);if(o)this.pairedPanelHidden&&(i.show(),this.pairedPanelHidden=!1);else{if(this.pairedPanelHidden)return!1;if(s<=15)return this.hidePaired(),!1}return t.css({height:n+"px",flex:"0 0 auto"}),!0},selectPair:function(e){e.stopPropagation(),l(e.currentTarget).toggleClass("selected")},clearSelectedPaired:function(e){this.$(".paired-columns .dataset.selected").removeClass("selected")},_clickPairName:function(e){e.stopPropagation();var t=l(e.currentTarget),i=t.parent().parent(),n=i.index(".dataset.paired"),s=this.paired[n],o=prompt("Enter a new name for the pair:",s.name);o&&(s.name=o,s.customizedName=!0,t.text(s.name))},_clickUnpair:function(e){var t=Math.floor(l(e.currentTarget).index(".unpair-btn"));this._unpair(this.paired[t])},_dragoverPairedColumns:function(e){e.preventDefault();var t=this.$(".paired-columns .column-datasets");this._checkForAutoscroll(t,e.originalEvent.clientY);var i=this._getNearestPairedDatasetLi(e.originalEvent.clientY);l(".element-drop-placeholder").remove();var n=l('<div class="element-drop-placeholder"></div>');i.length?i.before(n):t.append(n)},_checkForAutoscroll:function(e,t){var i=2,n=e.offset(),s=e.scrollTop(),o=t-n.top,a=n.top+e.outerHeight()-t;o>=0&&o<this.autoscrollDist?e.scrollTop(s-i):a>=0&&a<this.autoscrollDist&&e.scrollTop(s+i)},_getNearestPairedDatasetLi:function(e){for(var t=4,i=this.$(".paired-columns .column-datasets li").toArray(),n=0;n<i.length;n++){var s=l(i[n]),o=s.offset().top,a=Math.floor(s.outerHeight()/2)+t;if(o+a>e&&o-a<e)return s}return l()},_dropPairedColumns:function(e){e.preventDefault(),e.dataTransfer.dropEffect="move";var t=this._getNearestPairedDatasetLi(e.originalEvent.clientY);return t.length?this.$dragging.insertBefore(t):this.$dragging.insertAfter(this.$(".paired-columns .unpair-btn").last()),this._syncPairsToDom(),!1},_syncPairsToDom:function(){var e=[];this.$(".paired-columns .dataset.paired").each(function(){e.push(l(this).data("pair"))}),this.paired=e,this._renderPaired()},_pairDragstart:function(e,t){t.$el.addClass("selected");var i=this.$(".paired-columns .dataset.selected");this.$dragging=i},_pairDragend:function(e,t){l(".element-drop-placeholder").remove(),this.$dragging=null},toggleExtensions:function(e){var t=this;t.removeExtensions=void 0!==e?e:!t.removeExtensions,a.each(t.paired,function(e){e.customizedName||(e.name=t._guessNameForPair(e.forward,e.reverse))}),t._renderPaired(),t._renderFooter()},_changeName:function(e){this._validationWarning("name",!!this._getName())},_nameCheckForEnter:function(e){13!==e.keyCode||this.blocking||this._clickCreate()},_getName:function(){return a.escape(this.$(".collection-name").val())},_clickCreate:function(e){var t=this._getName();t?this.blocking||this.createList():this._validationWarning("name")},_printList:function(e){var t=this;a.each(e,function(i){e===t.paired&&t._printPair(i)})},_printPair:function(e){this.debug(e.forward.name,e.reverse.name,": ->",e.name)},toString:function(){return"PairedCollectionCreator"}});p.templates=p.templates||{main:a.template(['<div class="header flex-row no-flex"></div>','<div class="middle flex-row flex-row-container"></div>','<div class="footer flex-row no-flex">'].join("")),header:a.template(['<div class="main-help well clear">','<a class="more-help" href="javascript:void(0);">',s("More help"),"</a>",'<div class="help-content">','<a class="less-help" href="javascript:void(0);">',s("Less"),"</a>","</div>","</div>",'<div class="alert alert-dismissable">','<button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>','<span class="alert-message"></span>',"</div>",'<div class="column-headers vertically-spaced flex-column-container">','<div class="forward-column flex-column column">','<div class="column-header">','<div class="column-title">','<span class="title">',s("Unpaired forward"),"</span>",'<span class="title-info unpaired-info"></span>',"</div>",'<div class="unpaired-filter forward-unpaired-filter pull-left">','<input class="search-query" placeholder="',s("Filter this list"),'" />',"</div>","</div>","</div>",'<div class="paired-column flex-column no-flex column">','<div class="column-header">','<a class="choose-filters-link" href="javascript:void(0)">',s("Choose filters"),"</a>",'<a class="clear-filters-link" href="javascript:void(0);">',s("Clear filters"),"</a><br />",'<a class="autopair-link" href="javascript:void(0);">',s("Auto-pair"),"</a>","</div>","</div>",'<div class="reverse-column flex-column column">','<div class="column-header">','<div class="column-title">','<span class="title">',s("Unpaired reverse"),"</span>",'<span class="title-info unpaired-info"></span>',"</div>",'<div class="unpaired-filter reverse-unpaired-filter pull-left">','<input class="search-query" placeholder="',s("Filter this list"),'" />',"</div>","</div>","</div>","</div>"].join("")),middle:a.template(['<div class="unpaired-columns flex-column-container scroll-container flex-row">','<div class="forward-column flex-column column">','<ol class="column-datasets"></ol>',"</div>",'<div class="paired-column flex-column no-flex column">','<ol class="column-datasets"></ol>',"</div>",'<div class="reverse-column flex-column column">','<ol class="column-datasets"></ol>',"</div>","</div>",'<div class="flexible-partition">','<div class="flexible-partition-drag" title="',s("Drag to change"),'"></div>','<div class="column-header">','<div class="column-title paired-column-title">','<span class="title"></span>',"</div>",'<a class="unpair-all-link" href="javascript:void(0);">',s("Unpair all"),"</a>","</div>","</div>",'<div class="paired-columns flex-column-container scroll-container flex-row">','<ol class="column-datasets"></ol>',"</div>"].join("")),footer:a.template(['<div class="attributes clear">','<div class="clear">','<label class="remove-extensions-prompt pull-right">',s("Remove file extensions from pair names"),"?",'<input class="remove-extensions pull-right" type="checkbox" />',"</label>","</div>",'<div class="clear">','<input class="collection-name form-control pull-right" ','placeholder="',s("Enter a name for your new list"),'" />','<div class="collection-name-prompt pull-right">',s("Name"),":</div>","</div>","</div>",'<div class="actions clear vertically-spaced">','<div class="other-options pull-left">','<button class="cancel-create btn" tabindex="-1">',s("Cancel"),"</button>",'<div class="create-other btn-group dropup">','<button class="btn btn-default dropdown-toggle" data-toggle="dropdown">',s("Create a different kind of collection"),' <span class="caret"></span>',"</button>",'<ul class="dropdown-menu" role="menu">','<li><a href="#">',s("Create a <i>single</i> pair"),"</a></li>",'<li><a href="#">',s("Create a list of <i>unpaired</i> datasets"),"</a></li>","</ul>","</div>","</div>",'<div class="main-options pull-right">','<button class="create-collection btn btn-primary">',s("Create list"),"</button>","</div>","</div>"].join("")),helpContent:a.template(["<p>",s(["Collections of paired datasets are ordered lists of dataset pairs (often forward and reverse reads). ","These collections can be passed to tools and workflows in order to have analyses done on each member of ","the entire group. This interface allows you to create a collection, choose which datasets are paired, ","and re-order the final collection."].join("")),"</p>","<p>",s(['Unpaired datasets are shown in the <i data-target=".unpaired-columns">unpaired section</i> ',"(hover over the underlined words to highlight below). ",'Paired datasets are shown in the <i data-target=".paired-columns">paired section</i>.',"<ul>To pair datasets, you can:","<li>Click a dataset in the ",'<i data-target=".unpaired-columns .forward-column .column-datasets,','.unpaired-columns .forward-column">forward column</i> ',"to select it then click a dataset in the ",'<i data-target=".unpaired-columns .reverse-column .column-datasets,','.unpaired-columns .reverse-column">reverse column</i>.',"</li>",'<li>Click one of the "Pair these datasets" buttons in the ','<i data-target=".unpaired-columns .paired-column .column-datasets,','.unpaired-columns .paired-column">middle column</i> ',"to pair the datasets in a particular row.","</li>",'<li>Click <i data-target=".autopair-link">"Auto-pair"</i> ',"to have your datasets automatically paired based on name.","</li>","</ul>"].join("")),"</p>","<p>",s(["<ul>You can filter what is shown in the unpaired sections by:","<li>Entering partial dataset names in either the ",'<i data-target=".forward-unpaired-filter input">forward filter</i> or ','<i data-target=".reverse-unpaired-filter input">reverse filter</i>.',"</li>","<li>Choosing from a list of preset filters by clicking the ",'<i data-target=".choose-filters-link">"Choose filters" link</i>.',"</li>","<li>Entering regular expressions to match dataset names. See: ",'<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Regular_Expressions"',' target="_blank">MDN\'s JavaScript Regular Expression Tutorial</a>. ',"Note: forward slashes (\\) are not needed.","</li>","<li>Clearing the filters by clicking the ",'<i data-target=".clear-filters-link">"Clear filters" link</i>.',"</li>","</ul>"].join("")),"</p>","<p>",s(["To unpair individual dataset pairs, click the ",'<i data-target=".unpair-btn">unpair buttons ( <span class="fa fa-unlink"></span> )</i>. ','Click the <i data-target=".unpair-all-link">"Unpair all" link</i> to unpair all pairs.'].join("")),"</p>","<p>",s(['You can include or remove the file extensions (e.g. ".fastq") from your pair names by toggling the ','<i data-target=".remove-extensions-prompt">"Remove file extensions from pair names?"</i> control.'].join("")),"</p>","<p>",s(['Once your collection is complete, enter a <i data-target=".collection-name">name</i> and ','click <i data-target=".create-collection">"Create list"</i>. ',"(Note: you do not have to pair all unpaired datasets to finish.)"].join("")),"</p>"].join(""))};var f=function(e,t){var i,n=r.Deferred();if(t=a.defaults(t||{},{datasets:e,oncancel:function(){Galaxy.modal.hide(),n.reject("cancelled")},oncreate:function(e,t){Galaxy.modal.hide(),n.resolve(t)}}),!window.Galaxy||!Galaxy.modal)throw new Error("Galaxy or Galaxy.modal not found");return i=new p(t),Galaxy.modal.show({title:"Create a collection of paired datasets",body:i.$el,width:"80%",height:"800px",closing_events:!0}),i.render(),window.creator=i,n};return{PairedCollectionCreator:p,pairedCollectionCreatorModal:f,createListOfPairsCollection:c}}.apply(t,n),!(void 0!==s&&(e.exports=s))}).call(t,i(3),i(2),i(1),i(1))},function(e,t,i){var n,s;(function(o,a,r){n=[i(23),i(25),i(6),i(4)],s=function(e,t,i,n){"use strict";function s(e){var t=e.toJSON(),i=u(t,{creationFn:function(t,i){return t=[{name:"forward",src:"hda",id:t[0].id},{name:"reverse",src:"hda",id:t[1].id}],e.createHDCA(t,"paired",i)}});return i}var l="collections",d=o.View.extend(i.LoggableMixin).extend({_logNamespace:l,tagName:"li",className:"collection-element",initialize:function(e){this.element=e.element||{},this.identifier=e.identifier},render:function(){return this.$el.attr("data-element-id",this.element.id).html(this.template({identifier:this.identifier,element:this.element})),this},template:a.template(['<span class="identifier"><%- identifier %></span>','<span class="name"><%- element.name %></span>'].join("")),destroy:function(){this.off(),this.$el.remove()},toString:function(){return"DatasetCollectionElementView()"}}),c=e.ListCollectionCreator,h=c.extend({elementViewClass:d,collectionClass:t.HistoryPairDatasetCollection,className:"pair-collection-creator collection-creator flex-row-container",_mangleDuplicateNames:function(){},render:function(e,t){return 2===this.workingElements.length?c.prototype.render.call(this,e,t):this._renderInvalid(e,t)},_renderList:function(e,t){var i=this,n=r("<div/>"),s=i.$list();a.each(this.elementViews,function(e){e.destroy(),i.removeElementView(e)}),n.append(i._createForwardElementView().$el),n.append(i._createReverseElementView().$el),s.empty().append(n.children()),a.invoke(i.elementViews,"render")},_createForwardElementView:function(){return this._createElementView(this.workingElements[0],{identifier:"forward"})},_createReverseElementView:function(){return this._createElementView(this.workingElements[1],{identifier:"reverse"})},_createElementView:function(e,t){var i=new this.elementViewClass(a.extend(t,{element:e}));return this.elementViews.push(i),i},swap:function(){this.workingElements=[this.workingElements[1],this.workingElements[0]],this._renderList()},events:a.extend(a.clone(c.prototype.events),{"click .swap":"swap"}),templates:a.extend(a.clone(c.prototype.templates),{middle:a.template(['<div class="collection-elements-controls">','<a class="swap" href="javascript:void(0);" title="',n("Swap forward and reverse datasets"),'">',n("Swap"),"</a>","</div>",'<div class="collection-elements scroll-container flex-row">',"</div>"].join("")),helpContent:a.template(["<p>",n(["Pair collections are permanent collections containing two datasets: one forward and one reverse. ","Often these are forward and reverse reads. The pair collections can be passed to tools and ","workflows in order to have analyses done on both datasets. This interface allows ","you to create a pair, name it, and swap which is forward and which reverse."].join("")),"</p>","<ul>","<li>",n(['Click the <i data-target=".swap">"Swap"</i> link to make your forward dataset the reverse ',"and the reverse dataset forward."].join("")),"</li>","<li>",n(['Click the <i data-target=".cancel-create">"Cancel"</i> button to exit the interface.'].join("")),"</li>","</ul><br />","<p>",n(['Once your collection is complete, enter a <i data-target=".collection-name">name</i> and ','click <i data-target=".create-collection">"Create list"</i>.'].join("")),"</p>"].join("")),invalidInitial:a.template(['<div class="header flex-row no-flex">','<div class="alert alert-warning" style="display: block">','<span class="alert-message">',"<% if( _.size( problems ) ){ %>",n("The following selections could not be included due to problems"),"<ul><% _.each( problems, function( problem ){ %>","<li><b><%- problem.element.name %></b>: <%- problem.text %></li>","<% }); %></ul>","<% } else if( _.size( elements ) === 0 ){ %>",n("No datasets were selected"),".","<% } else if( _.size( elements ) === 1 ){ %>",n("Only one dataset was selected"),": <%- elements[0].name %>","<% } else if( _.size( elements ) > 2 ){ %>",n("Too many datasets were selected"),': <%- _.pluck( elements, "name" ).join( ", ") %>',"<% } %>","<br />",n("Two (and only two) elements are needed for the pair"),". ",n("You may need to "),'<a class="cancel-create" href="javascript:void(0)">',n("cancel"),"</a> ",n("and reselect new elements"),".","</span>","</div>","</div>",'<div class="footer flex-row no-flex">','<div class="actions clear vertically-spaced">','<div class="other-options pull-left">','<button class="cancel-create btn" tabindex="-1">',n("Cancel"),"</button>","</div>","</div>","</div>"].join(""))}),toString:function(){return"PairCollectionCreator"}}),u=function(t,i){return i=i||{},i.title=n("Create a collection from a pair of datasets"),e.collectionCreatorModal(t,i,h)};return{PairCollectionCreator:h,pairCollectionCreatorModal:u,createPairCollection:s}}.apply(t,n),!(void 0!==s&&(e.exports=s))}).call(t,i(3),i(2),i(1))},,,,,,,function(e,t,i){var n,s;(function(o,a,r){n=[i(9),i(4)],s=function(e,t){"use strict";var i={defaultName:o.template("Copy of '<%- name %>'"),title:o.template(t("Copying history")+' "<%- name %>"'),submitLabel:t("Copy"),errorMessage:t("History could not be copied"),progressive:t("Copying history"),activeLabel:t("Copy only the active, non-deleted datasets"),allLabel:t("Copy all datasets including deleted ones"),anonWarning:t("As an anonymous user, unless you login or register, you will lose your current history ")+t("after copying this history. "),_template:o.template(["<% if( isAnon ){ %>",'<div class="warningmessage">',"<%- anonWarning %>",t("You can"),' <a href="/user/login">',t("login here"),"</a> ",t("or")," ",' <a href="/user/create">',t("register here"),"</a>.","</div>","<% } %>","<form>",'<label for="copy-modal-title">',t("Enter a title for the new history"),":","</label><br />",'<input id="copy-modal-title" class="form-control" style="width: 100%" value="<%= name %>" />','<p class="invalid-title bg-danger" style="color: red; margin: 8px 0px 8px 0px; display: none">',t("Please enter a valid history title"),"</p>","<% if( allowAll ){ %>","<br />","<p>",t("Choose which datasets from the original history to include:"),"</p>",'<input name="copy-what" type="radio" id="copy-non-deleted" value="copy-non-deleted" ','<% if( copyWhat === "copy-non-deleted" ){ print( "checked" ); } %>/>','<label for="copy-non-deleted"> <%- activeLabel %></label>',"<br />",'<input name="copy-what" type="radio" id="copy-all" value="copy-all" ','<% if( copyWhat === "copy-all" ){ print( "checked" ); } %>/>','<label for="copy-all"> <%- allLabel %></label>',"<% } %>","</form>"].join("")),_showAjaxIndicator:function(){var e='<p><span class="fa fa-spinner fa-spin"></span> '+this.progressive+"...</p>";this.modal.$(".modal-body").empty().append(e).css({"margin-top":"8px"})},dialog:function(e,i,n){function s(){var n=e.$("#copy-modal-title").val();if(!n)return void e.$(".invalid-title").show();var s="copy-all"===e.$('input[name="copy-what"]:checked').val();e.$("button").prop("disabled",!0),l._showAjaxIndicator(),i.copy(!0,n,s).done(function(e){d.resolve(e)}).fail(function(){alert([l.errorMessage,t("Please contact a Galaxy administrator")].join(". ")),d.rejectWith(d,arguments)}).always(function(){f&&e.hide()})}n=n||{};var l=this,d=a.Deferred(),c=n.nameFn||this.defaultName,h=c({name:i.get("name")}),u=n.allDatasets?"copy-all":"copy-non-deleted",p=!!o.isUndefined(n.allowAll)||n.allowAll,f=!!o.isUndefined(n.autoClose)||n.autoClose;this.modal=e;var m=n.closing_callback;return e.show(o.extend(n,{title:this.title({name:i.get("name")}),body:r(l._template({name:h,isAnon:Galaxy.user.isAnonymous(),allowAll:p,copyWhat:u,activeLabel:this.activeLabel,allLabel:this.allLabel,anonWarning:this.anonWarning})),buttons:o.object([[t("Cancel"),function(){e.hide()}],[this.submitLabel,s]]),height:"auto",closing_events:!0,closing_callback:function(e){e&&d.reject({cancelled:!0}),m&&m(e)}})),e.$("#copy-modal-title").focus().select(),e.$("#copy-modal-title").on("keydown",function(e){13===e.keyCode&&(e.preventDefault(),s())}),d}},n=o.extend({},i,{defaultName:o.template("imported: <%- name %>"),title:o.template(t("Importing history")+' "<%- name %>"'),submitLabel:t("Import"),errorMessage:t("History could not be imported"),progressive:t("Importing history"),activeLabel:t("Import only the active, non-deleted datasets"),allLabel:t("Import all datasets including deleted ones"),anonWarning:t("As an anonymous user, unless you login or register, you will lose your current history ")+t("after importing this history. ")}),s=function(t,s){s=s||{};var o=window.parent.Galaxy.modal||new e.View({});return s.useImport?n.dialog(o,t,s):i.dialog(o,t,s)};return s}.apply(t,n),!(void 0!==s&&(e.exports=s))}).call(t,i(2),i(1),i(1))},function(e,t,i){var n,s;(function(o,a){n=[i(51),i(53),i(6),i(4)],s=function(e,t,i,n){"use strict";var s=e.DatasetListItemEdit,r=s.extend({className:s.prototype.className+" history-content",_fetchModelDetails:function(){var e=this;return e.model.inReadyState()&&!e.model.hasDetails()?e.model.fetch({silent:!0}):e.model.has("rerunnable")?o.when():e.model.fetch({silent:!0,data:{keys:["rerunnable","creating_job"].join(",")}})},events:a.extend(a.clone(s.prototype.events),{"click .unhide-link":function(e){return this.model.unhide(),!1}}),toString:function(){var e=this.model?this.model+"":"(no model)";return"HDAListItemEdit("+e+")"}});return r.prototype.templates=function(){var e=a.extend({},s.prototype.templates.warnings,{hidden:i.wrapTemplate(["<% if( !dataset.visible ){ %>",'<div class="hidden-msg warningmessagesmall">',n("This dataset has been hidden"),'<br /><a class="unhide-link" a href="javascript:void(0);">',n("Unhide it"),"</a>","</div>","<% } %>"],"dataset")});return a.extend({},s.prototype.templates,{titleBar:t.HDAListItemView.prototype.templates.titleBar,warnings:e})}(),{HDAListItemEdit:r}}.apply(t,n),!(void 0!==s&&(e.exports=s))}).call(t,i(1),i(2))},function(e,t,i){var n,s;n=[i(55),i(85),i(16),i(4)],s=function(e,t,i,n){"use strict";var s=e.HDCAListItemView,o=s.extend({_getFoldoutPanelClass:function(){switch(this.model.get("collection_type")){case"list":return t.ListCollectionViewEdit;case"paired":return t.PairCollectionViewEdit;case"list:paired":return t.ListOfPairsCollectionViewEdit}throw new TypeError("Uknown collection_type: "+this.model.get("collection_type"))},_renderPrimaryActions:function(){return this.log(this+"._renderPrimaryActions"),s.prototype._renderPrimaryActions.call(this).concat([this._renderDeleteButton()])},_renderDeleteButton:function(){var e=this,t=this.model.get("deleted");return i({title:n(t?"Dataset collection is already deleted":"Delete"),classes:"delete-btn",faIcon:"fa-times",disabled:t,onclick:function(){e.$el.find(".icon-btn.delete-btn").trigger("mouseout"),e.model["delete"]()}})},toString:function(){var e=this.model?this.model+"":"(no model)";return"HDCAListItemEdit("+e+")"}});return{HDCAListItemEdit:o}}.apply(t,n),!(void 0!==s&&(e.exports=s))},function(e,t,i){var n,s;(function(o,a,r){n=[i(56),i(98),i(6),i(4)],s=function(e,t,i,n){"use strict";var s=i.SessionStorageModel.extend({defaults:{tagsEditorShown:!1,annotationEditorShown:!1,scrollPosition:0},toString:function(){return"HistoryViewPrefs("+JSON.stringify(this.toJSON())+")"}});s.storageKey=function(){return"history-panel"};var l=t.HistoryViewEdit,d=l.extend({className:l.prototype.className+" current-history-panel",emptyMsg:n("This history is empty. Click 'Get Data' on the left tool menu to start"),noneFoundMsg:n("No matching datasets found"),HDCAViewClass:l.prototype.HDCAViewClass.extend({foldoutStyle:"drilldown"}),initialize:function(e){e=e||{},this.preferences=new s(o.extend({id:s.storageKey()},o.pick(e,o.keys(s.prototype.defaults)))),l.prototype.initialize.call(this,e),this.panelStack=[],this.currentContentId=e.currentContentId||null},_setUpListeners:function(){l.prototype._setUpListeners.call(this);var e=this;this.on("new-model",function(){e.preferences.set("scrollPosition",0)})},loadCurrentHistory:function(e){this.debug(this+".loadCurrentHistory");var t=this;return this.loadHistoryWithDetails("current",e).then(function(e,i){t.trigger("current-history",t)})},switchToHistory:function(e,t){var i=this,n=function(){return a.getJSON(Galaxy.root+"history/set_as_current?id="+e)};return this.loadHistoryWithDetails(e,t,n).then(function(e,t){i.trigger("switched-history",i)})},createNewHistory:function(e){if(!Galaxy||!Galaxy.user||Galaxy.user.isAnonymous())return this.displayMessage("error",n("You must be logged in to create histories")),r.when();var t=this,i=function(){return a.getJSON(Galaxy.root+"history/create_new_current")};return this.loadHistory(void 0,e,i).then(function(e,i){t.trigger("new-history",t)})},setModel:function(e,t,i){return l.prototype.setModel.call(this,e,t,i),this.model&&(this.log("checking for updates"),this.model.checkForUpdates()),this},_setUpCollectionListeners:function(){l.prototype._setUpCollectionListeners.call(this),this.listenTo(this.collection,"state:ready",function(e,t,i){e.get("visible")||this.storage.get("show_hidden")||this.removeItemView(e)})},_setUpModelListeners:function(){l.prototype._setUpModelListeners.call(this),this.listenTo(this.model,"change:nice_size change:size",function(){this.trigger("history-size-change",this,this.model,arguments)},this)},_setUpBehaviors:function(e){e=e||this.$el;var t=this;return l.prototype._setUpBehaviors.call(t,e),this._debouncedScrollCaptureHandler||(this._debouncedScrollCaptureHandler=o.debounce(function(){t.$el.is(":visible")&&t.preferences.set("scrollPosition",r(this).scrollTop())},40)),t.$scrollContainer().off("scroll",this._debouncedScrollCaptureHandler).on("scroll",this._debouncedScrollCaptureHandler),t},_buildNewRender:function(){if(!this.model)return r();var e=l.prototype._buildNewRender.call(this);return e.find(".search").prependTo(e.find(".controls")),this._renderQuotaMessage(e),e},_renderQuotaMessage:function(e){return e=e||this.$el,r(this.templates.quotaMsg({},this)).prependTo(e.find(".messages"))},_renderEmptyMessage:function(e){var t=this,i=t.$emptyMessage(e),s=r(".toolMenuContainer");return o.isEmpty(t.views)&&!t.searchFor&&Galaxy&&Galaxy.upload&&s.length?(i.empty(),i.html([n("This history is empty"),". ",n("You can "),'<a class="uploader-link" href="javascript:void(0)">',n("load your own data"),"</a>",n(" or "),'<a class="get-data-link" href="javascript:void(0)">',n("get data from an external source"),"</a>"].join("")),i.find(".uploader-link").click(function(e){Galaxy.upload.show(e)}),i.find(".get-data-link").click(function(e){s.parent().scrollTop(0),s.find('span:contains("Get Data")').click()}),i.show()):l.prototype._renderEmptyMessage.call(this,e)},_renderTags:function(e){var t=this;l.prototype._renderTags.call(t,e),t.preferences.get("tagsEditorShown")&&t.tagsEditor.toggle(!0),t.listenTo(t.tagsEditor,"hiddenUntilActivated:shown hiddenUntilActivated:hidden",function(e){t.preferences.set("tagsEditorShown",e.hidden)})},_renderAnnotation:function(e){var t=this;l.prototype._renderAnnotation.call(t,e),t.preferences.get("annotationEditorShown")&&t.annotationEditor.toggle(!0),t.listenTo(t.annotationEditor,"hiddenUntilActivated:shown hiddenUntilActivated:hidden",function(e){t.preferences.set("annotationEditorShown",e.hidden)})},_swapNewRender:function(e){l.prototype._swapNewRender.call(this,e);var t=this;return o.delay(function(){var e=t.preferences.get("scrollPosition");e&&t.scrollTo(e,0)},10),this},_attachItems:function(e){l.prototype._attachItems.call(this,e);var t=this;return t.currentContentId&&t._setCurrentContentById(t.currentContentId),this},addItemView:function(e,t,i){var n=l.prototype.addItemView.call(this,e,t,i);return n&&this.panelStack.length?this._collapseDrilldownPanel():n},_setUpItemViewListeners:function(e){var t=this;return l.prototype._setUpItemViewListeners.call(t,e),t.listenTo(e,"expanded:drilldown",function(e,t){this._expandDrilldownPanel(t)}),t.listenTo(e,"collapsed:drilldown",function(e,t){this._collapseDrilldownPanel(t)}),this},setCurrentContent:function(e){this.$(".history-content.current-content").removeClass("current-content"),e?(e.$el.addClass("current-content"),this.currentContentId=e.model.id):this.currentContentId=null},_setCurrentContentById:function(e){var t=this.viewFromModelId(e)||null;this.setCurrentContent(t)},_expandDrilldownPanel:function(e){this.panelStack.push(e),this.$("> .controls").add(this.$list()).hide(),e.parentName=this.model.get("name"),this.$el.append(e.render().$el)},_collapseDrilldownPanel:function(e){this.panelStack.pop(),this.render()},listenToGalaxy:function(e){this.listenTo(e,"galaxy_main:load",function(e){var t=e.fullpath,i={display:/datasets\/([a-f0-9]+)\/display/,edit:/datasets\/([a-f0-9]+)\/edit/,report_error:/dataset\/errors\?id=([a-f0-9]+)/,rerun:/tool_runner\/rerun\?id=([a-f0-9]+)/,show_params:/datasets\/([a-f0-9]+)\/show_params/},n=null,s=null;o.find(i,function(e,i){var o=t.match(e);return!(!o||2!=o.length)&&(n=o[1],s=i,!0)}),n="dataset-"+n,this._setCurrentContentById(n)})},connectToQuotaMeter:function(e){return e?(this.listenTo(e,"quota:over",this.showQuotaMessage),this.listenTo(e,"quota:under",this.hideQuotaMessage),this.on("rendered rendered:initial",function(){e&&e.isOverQuota()&&this.showQuotaMessage()}),this):this},clearMessages:function(e){var t=o.isUndefined(e)?this.$messages().children('[class$="message"]'):r(e.currentTarget);return t=t.not(".quota-message"),t.fadeOut(this.fxSpeed,function(){r(this).remove()}),this},showQuotaMessage:function(){var e=this.$(".quota-message");e.is(":hidden")&&e.slideDown(this.fxSpeed)},hideQuotaMessage:function(){var e=this.$(".quota-message");e.is(":hidden")||e.slideUp(this.fxSpeed)},toString:function(){return"CurrentHistoryView("+(this.model?this.model.get("name"):"")+")"}});return d.prototype.templates=function(){var e=i.wrapTemplate(['<div class="quota-message errormessage">',n("You are over your disk quota"),". ",n("Tool execution is on hold until your disk usage drops below your allocated quota"),".","</div>"],"history");
return o.extend(o.clone(l.prototype.templates),{quotaMsg:e})}(),{CurrentHistoryView:d}}.apply(t,n),!(void 0!==s&&(e.exports=s))}).call(t,i(2),i(1),i(1))},function(e,t,i){var n,s;(function(o,a,r){n=[i(99),i(27),i(8),i(54),i(95),i(96),i(58),i(48),i(23),i(87),i(86),i(16),i(31),i(4),i(14)],s=function(e,t,i,n,s,l,d,c,h,u,p,f,m,g){"use strict";var v=e.HistoryView,_=v.extend({HDAViewClass:s.HDAListItemEdit,HDCAViewClass:l.HDCAListItemEdit,initialize:function(e){e=e||{},v.prototype.initialize.call(this,e),this.tagsEditor=null,this.annotationEditor=null,this.purgeAllowed=e.purgeAllowed||!1,this.annotationEditorShown=e.annotationEditorShown||!1,this.tagsEditorShown=e.tagsEditorShown||!1},_setUpListeners:function(){var e=this;v.prototype._setUpListeners.call(e),e.on("drop",function(t,i){e.dataDropped(i),e.dropTargetOff()}),e.on("view:attached view:removed",function(){e._renderCounts()})},_setUpCollectionListeners:function(){return v.prototype._setUpCollectionListeners.call(this),this.listenTo(this.collection,{"change:deleted":this._handleHdaDeletionChange,"change:visible":this._handleHdaVisibleChange,"change:purged":function(e){this.model.fetch()}}),this},_setUpModelListeners:function(){return v.prototype._setUpModelListeners.call(this),this.listenTo(this.model,"change:size",this.updateHistoryDiskSize),this},_buildNewRender:function(){var e=v.prototype._buildNewRender.call(this);return this.model?(Galaxy&&Galaxy.user&&Galaxy.user.id&&Galaxy.user.id===this.model.get("user_id")&&(this._renderTags(e),this._renderAnnotation(e)),e):e},renderItems:function(e){var t=v.prototype.renderItems.call(this,e);return this._renderCounts(e),t},_renderCounts:function(e){function t(e,t){return['<a class="',e,'" href="javascript:void(0);">',t,"</a>"].join("")}e=e||this.$el;var i=this.collection.where({deleted:!0}),n=this.collection.where({visible:!1}),s=[];return this.views.length&&s.push([this.views.length,g("shown")].join(" ")),i.length&&s.push(this.showDeleted?t("toggle-deleted-link",g("hide deleted")):[i.length,t("toggle-deleted-link",g("deleted"))].join(" ")),n.length&&s.push(this.showHidden?t("toggle-hidden-link",g("hide hidden")):[n.length,t("toggle-hidden-link",g("hidden"))].join(" ")),e.find("> .controls .subtitle").html(s.join(", "))},_renderTags:function(e){var t=this;this.tagsEditor=new d.TagsEditor({model:this.model,el:e.find(".controls .tags-display"),onshowFirstTime:function(){this.render()},onshow:function(){t.toggleHDATagEditors(!0,t.fxSpeed)},onhide:function(){t.toggleHDATagEditors(!1,t.fxSpeed)},$activator:f({title:g("Edit history tags"),classes:"history-tag-btn",faIcon:"fa-tags"}).appendTo(e.find(".controls .actions"))})},_renderAnnotation:function(e){var t=this;this.annotationEditor=new c.AnnotationEditor({model:this.model,el:e.find(".controls .annotation-display"),onshowFirstTime:function(){this.render()},onshow:function(){t.toggleHDAAnnotationEditors(!0,t.fxSpeed)},onhide:function(){t.toggleHDAAnnotationEditors(!1,t.fxSpeed)},$activator:f({title:g("Edit history annotation"),classes:"history-annotate-btn",faIcon:"fa-comment"}).appendTo(e.find(".controls .actions"))})},_setUpBehaviors:function(e){if(e=e||this.$el,v.prototype._setUpBehaviors.call(this,e),this.model&&Galaxy.user&&!Galaxy.user.isAnonymous()&&Galaxy.user.id===this.model.get("user_id")){var t=this,i="> .controls .name";e.find(i).attr("title",g("Click to rename history")).tooltip({placement:"bottom"}).make_text_editable({on_finish:function(e){var n=t.model.get("name");e&&e!==n?(t.$el.find(i).text(e),t.model.save({name:e}).fail(function(){t.$el.find(i).text(t.model.previous("name"))})):t.$el.find(i).text(n)}})}},multiselectActions:function(){var e=this,t=[{html:g("Hide datasets"),func:function(){var t=n.HistoryDatasetAssociation.prototype.hide;e.getSelectedModels().ajaxQueue(t)}},{html:g("Unhide datasets"),func:function(){var t=n.HistoryDatasetAssociation.prototype.unhide;e.getSelectedModels().ajaxQueue(t)}},{html:g("Delete datasets"),func:function(){var t=n.HistoryDatasetAssociation.prototype["delete"];e.getSelectedModels().ajaxQueue(t)}},{html:g("Undelete datasets"),func:function(){var t=n.HistoryDatasetAssociation.prototype.undelete;e.getSelectedModels().ajaxQueue(t)}}];return e.purgeAllowed&&t.push({html:g("Permanently delete datasets"),func:function(){if(confirm(g("This will permanently remove the data in your datasets. Are you sure?"))){var t=n.HistoryDatasetAssociation.prototype.purge;e.getSelectedModels().ajaxQueue(t)}}}),t=t.concat(e._collectionActions())},_collectionActions:function(){var e=this;return[{html:g("Build Dataset List"),func:function(){h.createListCollection(e.getSelectedModels()).done(function(){e.model.refresh()})}},{html:g("Build Dataset Pair"),func:function(){u.createPairCollection(e.getSelectedModels()).done(function(){e.model.refresh()})}},{html:g("Build List of Dataset Pairs"),func:function(){p.createListOfPairsCollection(e.getSelectedModels()).done(function(){e.model.refresh()})}}]},_attachItems:function(e){return this.$list(e).append(this.views.reverse().map(function(e){return e.$el})),this},_attachView:function(e){var t=this;t.views.unshift(e),t.$list().prepend(e.render(0).$el.hide()),t.trigger("view:attached",e),e.$el.slideDown(t.fxSpeed,function(){t.trigger("view:attached:rendered")})},_getItemViewOptions:function(e){var t=v.prototype._getItemViewOptions.call(this,e);return o.extend(t,{purgeAllowed:this.purgeAllowed,tagsEditorShown:this.tagsEditor&&!this.tagsEditor.hidden,annotationEditorShown:this.annotationEditor&&!this.annotationEditor.hidden}),t},_handleHdaDeletionChange:function(e){e.get("deleted")&&!this.showDeleted&&this.removeItemView(e),this._renderCounts()},_handleHdaVisibleChange:function(e){e.hidden()&&!this.showHidden&&this.removeItemView(e),this._renderCounts()},toggleHDATagEditors:function(e){var t=Array.prototype.slice.call(arguments,1);o.each(this.views,function(e){e.tagsEditor&&e.tagsEditor.toggle.apply(e.tagsEditor,t)})},toggleHDAAnnotationEditors:function(e){var t=Array.prototype.slice.call(arguments,1);o.each(this.views,function(e){e.annotationEditor&&e.annotationEditor.toggle.apply(e.annotationEditor,t)})},events:o.extend(o.clone(v.prototype.events),{"click .show-selectors-btn":"toggleSelectors","click .toggle-deleted-link":function(e){this.toggleShowDeleted()},"click .toggle-hidden-link":function(e){this.toggleShowHidden()}}),updateHistoryDiskSize:function(){this.$el.find(".history-size").text(this.model.get("nice_size"))},dropTargetOn:function(){if(this.dropTarget)return this;this.dropTarget=!0;var e={dragenter:o.bind(this.dragenter,this),dragover:o.bind(this.dragover,this),dragleave:o.bind(this.dragleave,this),drop:o.bind(this.drop,this)},t=this._renderDropTarget();this.$list().before([this._renderDropTargetHelp(),t]);for(var i in e)e.hasOwnProperty(i)&&t.on(i,e[i]);return this},_renderDropTarget:function(){return this.$(".history-drop-target").remove(),a("<div/>").addClass("history-drop-target").css({height:"64px",margin:"0px 10px 10px 10px",border:"1px dashed black","border-radius":"3px"})},_renderDropTargetHelp:function(){return this.$(".history-drop-target-help").remove(),a("<div/>").addClass("history-drop-target-help").css({margin:"10px 10px 4px 10px",color:"grey","font-size":"80%","font-style":"italic"}).text(g("Drag datasets here to copy them to the current history"))},dropTargetOff:function(){if(!this.dropTarget)return this;this.dropTarget=!1;var e=this.$(".history-drop-target").get(0);for(var t in this._dropHandlers)this._dropHandlers.hasOwnProperty(t)&&e.off(t,this._dropHandlers[t]);return this.$(".history-drop-target").remove(),this.$(".history-drop-target-help").remove(),this},dropTargetToggle:function(){return this.dropTarget?this.dropTargetOff():this.dropTargetOn(),this},dragenter:function(e){e.preventDefault(),e.stopPropagation(),this.$(".history-drop-target").css("border","2px solid black")},dragover:function(e){e.preventDefault(),e.stopPropagation()},dragleave:function(e){e.preventDefault(),e.stopPropagation(),this.$(".history-drop-target").css("border","1px dashed black")},drop:function(e){e.preventDefault();var t=e.originalEvent.dataTransfer;t.dropEffect="move";var i=this,n=t.getData("text");try{n=JSON.parse(n)}catch(s){this.warn("error parsing JSON from drop:",n)}return this.trigger("droptarget:drop",e,n,i),!1},dataDropped:function(e){var t=this;return o.isObject(e)&&"HistoryDatasetAssociation"===e.model_class&&e.id?t.model.contents.copy(e.id):r.when()},toString:function(){return"HistoryViewEdit("+(this.model?this.model.get("name"):"")+")"}});return{HistoryViewEdit:_}}.apply(t,n),!(void 0!==s&&(e.exports=s))}).call(t,i(2),i(1),i(1))},function(e,t,i){var n,s;(function(o,a){n=[i(57),i(56),i(27),i(53),i(55),i(64),i(16),i(31),i(6),i(4),i(67)],s=function(e,t,i,n,s,r,l,d,c,h){"use strict";var u="history",p=c.SessionStorageModel.extend({defaults:{expandedIds:{},show_deleted:!1,show_hidden:!1},addExpanded:function(e){var t="expandedIds";this.save(t,o.extend(this.get(t),o.object([e.id],[e.get("id")])))},removeExpanded:function(e){var t="expandedIds";this.save(t,o.omit(this.get(t),e.id))},toString:function(){return"HistoryPrefs("+this.id+")"}});p.storageKeyPrefix="history:",p.historyStorageKey=function(e){if(!e)throw new Error("HistoryPrefs.historyStorageKey needs valid id: "+e);return p.storageKeyPrefix+e},p.get=function(e){return new p({id:p.historyStorageKey(e)})},p.clearAll=function(e){for(var t in sessionStorage)0===t.indexOf(p.storageKeyPrefix)&&sessionStorage.removeItem(t)};var f=e.ModelListPanel,m=f.extend({_logNamespace:u,HDAViewClass:n.HDAListItemView,HDCAViewClass:s.HDCAListItemView,collectionClass:i.HistoryContents,modelCollectionKey:"contents",tagName:"div",className:f.prototype.className+" history-panel",emptyMsg:h("This history is empty"),noneFoundMsg:h("No matching datasets found"),searchPlaceholder:h("search datasets"),initialize:function(e){f.prototype.initialize.call(this,e),this.linkTarget=e.linkTarget||"_blank"},freeModel:function(){return f.prototype.freeModel.call(this),this.model&&this.model.clearUpdateTimeout(),this},_setUpListeners:function(){f.prototype._setUpListeners.call(this),this.on({error:function(e,t,i,n,s){this.errorHandler(e,t,i,n,s)},"loading-done":function(){this.views.length||this.trigger("empty-history",this)},"views:ready view:attached view:removed":function(e){this._renderSelectButton()}})},loadHistoryWithDetails:function(e,t,i,n){this.info("loadHistoryWithDetails:",e,t,i,n);var s=function(e){return o.values(p.get(e.id).get("expandedIds"))};return this.loadHistory(e,t,i,n,s)},FETCH_COLLECTION_COUNTS_DELAY:2e3,loadHistory:function(e,i,n,s,a){this.info("loadHistory:",e,i,n,s,a);var r=this;i=i||{},r.trigger("loading",r);var l=t.History.getHistoryData(e,{historyFn:n,contentsFn:s,detailIdsFn:i.initiallyExpanded||a});return r._loadHistoryFromXHR(l,i).fail(function(t,n,s){r.trigger("error",r,t,i,h("An error was encountered while "+n),{historyId:e,history:s||{}})}).done(function(){o.delay(function(){r.model.contents.fetchCollectionCounts()},r.FETCH_COLLECTION_COUNTS_DELAY)}).always(function(){r.trigger("loading-done",r)})},_loadHistoryFromXHR:function(e,t){var i=this;return e.then(function(e,n){i.JSONToModel(e,n,t),i.render()}).fail(function(e,t){i.render()}),e},refreshContents:function(e){return this.model?this.model.refresh(e):a.when()},JSONToModel:function(e,i,n){this.log("JSONToModel:",e,i,n),n=n||{};var s=new t.History(e,i,n);return this.setModel(s),s},setModel:function(e,t){t=t||{},f.prototype.setModel.call(this,e,t),this.model&&this._setUpWebStorage(t.initiallyExpanded,t.show_deleted,t.show_hidden)},_setUpWebStorage:function(e,t,i){return this.storage&&this.stopListening(this.storage),this.storage=new p({id:p.historyStorageKey(this.model.get("id"))}),o.isObject(e)&&this.storage.set("expandedIds",e),o.isBoolean(t)&&this.storage.set("show_deleted",t),o.isBoolean(i)&&this.storage.set("show_hidden",i),this.trigger("new-storage",this.storage,this),this.log(this+" (init'd) storage:",this.storage.get()),this.listenTo(this.storage,{"change:show_deleted":function(e,t){this.showDeleted=t},"change:show_hidden":function(e,t){this.showHidden=t}},this),this.showDeleted=void 0!==t?t:this.storage.get("show_deleted"),this.showHidden=void 0!==i?i:this.storage.get("show_hidden"),this},_buildNewRender:function(){var e=f.prototype._buildNewRender.call(this);return this._renderSelectButton(e),e},_renderSelectButton:function(e){if(e=e||this.$el,!this.multiselectActions().length)return null;if(!this.views.length)return this.hideSelectors(),e.find(".controls .actions .show-selectors-btn").remove(),null;var t=e.find(".controls .actions .show-selectors-btn");return t.length?t:l({title:h("Operations on multiple datasets"),classes:"show-selectors-btn",faIcon:"fa-check-square-o"}).prependTo(e.find(".controls .actions"))},_getItemViewClass:function(e){var t=e.get("history_content_type");switch(t){case"dataset":return this.HDAViewClass;case"dataset_collection":return this.HDCAViewClass}throw new TypeError("Unknown history_content_type: "+t)},_filterItem:function(e){var t=this;return f.prototype._filterItem.call(t,e)&&(!e.hidden()||t.showHidden)&&(!e.isDeletedOrPurged()||t.showDeleted)},_getItemViewOptions:function(e){var t=f.prototype._getItemViewOptions.call(this,e);return o.extend(t,{linkTarget:this.linkTarget,expanded:!!this.storage.get("expandedIds")[e.id],hasUser:this.model.ownedByCurrUser()})},_setUpItemViewListeners:function(e){var t=this;return f.prototype._setUpItemViewListeners.call(t,e),t.listenTo(e,{expanded:function(e){t.storage.addExpanded(e.model)},collapsed:function(e){t.storage.removeExpanded(e.model)}}),this},getSelectedModels:function(){var e=f.prototype.getSelectedModels.call(this);return e.historyId=this.collection.historyId,e},events:o.extend(o.clone(f.prototype.events),{"click .show-selectors-btn":"toggleSelectors","click .messages [class$=message]":"clearMessages"}),toggleShowDeleted:function(e,t){return e=void 0!==e?e:!this.showDeleted,t=void 0===t||t,this.showDeleted=e,t&&this.storage.set("show_deleted",e),this.renderItems(),this.trigger("show-deleted",e),this.showDeleted},toggleShowHidden:function(e,t){return e=void 0!==e?e:!this.showHidden,t=void 0===t||t,this.showHidden=e,t&&this.storage.set("show_hidden",e),this.renderItems(),this.trigger("show-hidden",e),this.showHidden},_firstSearch:function(e){var t=this,i=".history-search-input";return this.log("onFirstSearch",e),t.model.contents.haveDetails()?void t.searchItems(e):(t.$el.find(i).searchInput("toggle-loading"),void t.model.contents.fetchAllDetails({silent:!0}).always(function(){t.$el.find(i).searchInput("toggle-loading")}).done(function(){t.searchItems(t.searchFor)}))},errorHandler:function(e,t,i,n,s){if(this.error(e,t,i,n,s),t&&0===t.status&&0===t.readyState);else if(t&&502===t.status);else{var o=this._parseErrorMessage(e,t,i,n,s);this.$messages().is(":visible")?this.displayMessage("error",o.message,o.details):this.once("rendered",function(){this.displayMessage("error",o.message,o.details)})}},_parseErrorMessage:function(e,t,i,n,s,a){var l=Galaxy.user,d={message:this._bePolite(n),details:{message:n,raven:window.Raven&&o.isFunction(Raven.lastEventId)?Raven.lastEventId():void 0,agent:navigator.userAgent,url:window.Galaxy?Galaxy.lastAjax.url:void 0,data:window.Galaxy?Galaxy.lastAjax.data:void 0,options:t?o.omit(i,"xhr"):i,xhr:t,source:o.isFunction(e.toJSON)?e.toJSON():e+"",user:l instanceof r.User?l.toJSON():l+""}};if(o.extend(d.details,s||{}),t&&o.isFunction(t.getAllResponseHeaders)){var c=t.getAllResponseHeaders();c=o.compact(c.split("\n")),c=o.map(c,function(e){return e.split(": ")}),d.details.xhr.responseHeaders=o.object(c)}return d},_bePolite:function(e){return e=e||h("An error occurred while getting updates from the server"),e+". "+h("Please contact a Galaxy administrator if the problem persists")+"."},displayMessage:function(e,t,i){var n=this;this.scrollToTop();var s=this.$messages(),r=a("<div/>").addClass(e+"message").html(t);if(!o.isEmpty(i)){var l=a('<a href="javascript:void(0)">Details</a>').click(function(){return Galaxy.modal.show(n._messageToModalOptions(e,t,i)),!1});r.append(" ",l)}return s.append(r)},_messageToModalOptions:function(e,t,i){var n=this,s={title:"Details"};if(o.isObject(i)){i=o.omit(i,o.functions(i));var r=JSON.stringify(i,null,"  "),l=a("<pre/>").text(r);s.body=a("<div/>").append(l)}else s.body=a("<div/>").html(i);return s.buttons={Ok:function(){Galaxy.modal.hide(),n.clearMessages()}},s},clearMessages:function(e){var t=o.isUndefined(e)?this.$messages().children('[class$="message"]'):a(e.currentTarget);return t.fadeOut(this.fxSpeed,function(){a(this).remove()}),this},scrollToHid:function(e){return this.scrollToItem(o.first(this.viewsWhereModel({hid:e})))},toString:function(){return"HistoryView("+(this.model?this.model.get("name"):"")+")"}});return m.prototype.templates=function(){var e=c.wrapTemplate(['<div class="controls">','<div class="title">','<div class="name"><%- history.name %></div>',"</div>",'<div class="subtitle"></div>','<div class="history-size"><%- history.nice_size %></div>','<div class="actions"></div>','<div class="messages">',"<% if( history.deleted && history.purged ){ %>",'<div class="deleted-msg warningmessagesmall">',h("This history has been purged and deleted"),"</div>","<% } else if( history.deleted ){ %>",'<div class="deleted-msg warningmessagesmall">',h("This history has been deleted"),"</div>","<% } else if( history.purged ){ %>",'<div class="deleted-msg warningmessagesmall">',h("This history has been purged"),"</div>","<% } %>","<% if( history.message ){ %>",'<div class="<%= history.message.level || "info" %>messagesmall">',"<%= history.message.text %>","</div>","<% } %>","</div>",'<div class="tags-display"></div>','<div class="annotation-display"></div>','<div class="search">','<div class="search-input"></div>',"</div>",'<div class="list-actions">','<div class="btn-group">','<button class="select-all btn btn-default"','data-mode="select">',h("All"),"</button>",'<button class="deselect-all btn btn-default"','data-mode="select">',h("None"),"</button>","</div>",'<div class="list-action-menu btn-group">',"</div>","</div>","</div>"],"history");return o.extend(o.clone(f.prototype.templates),{controls:e})}(),{HistoryView:m}}.apply(t,n),!(void 0!==s&&(e.exports=s))}).call(t,i(2),i(1))},function(e,t,i){var n,s;(function(o,a){n=[i(31),i(94),i(6),i(4)],s=function(e,t,i,n){"use strict";function s(e,t,i){return a.clone(r).filter(function(n){return!(e&&!n.anon)&&(!(!t&&n.purge)&&(n.href&&(n.href=i+n.href,n.target="galaxy_main"),n.confirm&&(n.func=function(){confirm(n.confirm)&&(galaxy_main.location=n.href)}),!0))})}var r=[{html:n("History Lists"),header:!0},{html:n("Saved Histories"),href:"history/list"},{html:n("Histories Shared with Me"),href:"history/list_shared"},{html:n("History Actions"),header:!0,anon:!0},{html:n("Create New"),func:function(){Galaxy&&Galaxy.currHistoryPanel&&Galaxy.currHistoryPanel.createNewHistory()}},{html:n("Copy History"),func:function(){t(Galaxy.currHistoryPanel.model).done(function(){Galaxy.currHistoryPanel.loadCurrentHistory()})}},{html:n("Share or Publish"),href:"history/sharing"},{html:n("Show Structure"),href:"history/display_structured",anon:!0},{html:n("Extract Workflow"),href:"workflow/build_from_current_history"},{html:n("Delete"),confirm:n("Really delete the current history?"),href:"history/delete_current"},{html:n("Delete Permanently"),confirm:n("Really delete the current history permanently? This cannot be undone."),href:"history/delete_current?purge=True",purge:!0,anon:!0},{html:n("Dataset Actions"),header:!0,anon:!0},{html:n("Copy Datasets"),href:"dataset/copy_datasets"},{html:n("Dataset Security"),href:"root/history_set_default_permissions"},{html:n("Resume Paused Jobs"),href:"history/resume_paused_jobs?current=True",anon:!0},{html:n("Collapse Expanded Datasets"),func:function(){Galaxy&&Galaxy.currHistoryPanel&&Galaxy.currHistoryPanel.collapseAll()}},{html:n("Unhide Hidden Datasets"),anon:!0,func:function(){if(Galaxy&&Galaxy.currHistoryPanel&&confirm(n("Really unhide all hidden datasets?"))){var e=Galaxy.currHistoryPanel.model.contents.hidden();e.ajaxQueue(o.Model.prototype.save,{visible:!0}).done(function(){Galaxy.currHistoryPanel.renderItems()}).fail(function(){alert("There was an error unhiding the datasets"),console.error(arguments)})}}},{html:n("Delete Hidden Datasets"),anon:!0,func:function(){if(Galaxy&&Galaxy.currHistoryPanel&&confirm(n("Really delete all hidden datasets?"))){var e=Galaxy.currHistoryPanel.model.contents.hidden();e.ajaxQueue(o.Model.prototype.save,{deleted:!0,visible:!0}).done(function(){Galaxy.currHistoryPanel.renderItems()}).fail(function(){alert("There was an error deleting the datasets"),console.error(arguments)})}}},{html:n("Purge Deleted Datasets"),confirm:n("Really delete all deleted datasets permanently? This cannot be undone."),href:"history/purge_deleted_datasets",purge:!0,anon:!0},{html:n("Downloads"),header:!0},{html:n("Export Tool Citations"),href:"history/citations",anon:!0},{html:n("Export History to File"),href:"history/export_archive?preview=True",anon:!0},{html:n("Other Actions"),header:!0},{html:n("Import from File"),href:"history/import_archive"}],l=function(t,i){i=i||{};var n=void 0===i.anonymous||i.anonymous,o=i.purgeAllowed||!1,a=s(n,o,Galaxy.root);return new e(t,a)};return l}.apply(t,n),!(void 0!==s&&(e.exports=s))}).call(t,i(3),i(2))},,,,,,,,function(e,t,i){var n,s;(function(o,a,r){n=[i(5)],s=function(e){var t=o.View.extend({optionsDefault:{title_new:"",operations:null,onnew:null,max:null,onchange:null},initialize:function(t){this.visible=!1,this.$nav=null,this.$content=null,this.first_tab=null,this.current_id=null,this.options=e.merge(t,this.optionsDefault);var i=a(this._template(this.options));this.$nav=i.find(".tab-navigation"),this.$content=i.find(".tab-content"),this.setElement(i),this.list={};var n=this;if(this.options.operations&&a.each(this.options.operations,function(e,t){t.$el.prop("id",e),n.$nav.find(".operations").append(t.$el)}),this.options.onnew){var s=a(this._template_tab_new(this.options));this.$nav.append(s),s.tooltip({title:"Add a new tab",placement:"bottom",container:n.$el}),s.on("click",function(e){s.tooltip("hide"),n.options.onnew()})}},size:function(){return r.size(this.list)},current:function(){return this.$el.find(".tab-pane.active").attr("id")},add:function(e){var t=this,i=e.id,n=a(this._template_tab(e)),s=a(this._template_tab_content(e));if(this.list[i]=!!e.ondel,this.options.onnew?this.$nav.find("#new-tab").before(n):this.$nav.append(n),s.append(e.$el),this.$content.append(s),1==this.size()&&(n.addClass("active"),s.addClass("active"),this.first_tab=i),this.options.max&&this.size()>=this.options.max&&this.$el.find("#new-tab").hide(),e.ondel){var o=n.find("#delete");o.tooltip({title:"Delete this tab",placement:"bottom",container:t.$el}),o.on("click",function(){return o.tooltip("destroy"),t.$el.find(".tooltip").remove(),e.ondel(),!1})}n.on("click",function(n){n.preventDefault(),e.onclick?e.onclick():t.show(i)}),this.current_id||(this.current_id=i)},del:function(e){this.$el.find("#tab-"+e).remove(),this.$el.find("#"+e).remove(),this.first_tab==e&&(this.first_tab=null),null!=this.first_tab&&this.show(this.first_tab),this.list[e]&&delete this.list[e],this.size()<this.options.max&&this.$el.find("#new-tab").show()},delRemovable:function(){for(var e in this.list)this.del(e)},show:function(e){this.$el.fadeIn("fast"),this.visible=!0,e&&(this.$el.find("#tab-"+this.current_id).removeClass("active"),this.$el.find("#"+this.current_id).removeClass("active"),this.$el.find("#tab-"+e).addClass("active"),this.$el.find("#"+e).addClass("active"),this.current_id=e),this.options.onchange&&this.options.onchange(e)},hide:function(){this.$el.fadeOut("fast"),this.visible=!1},hideOperation:function(e){this.$nav.find("#"+e).hide()},showOperation:function(e){this.$nav.find("#"+e).show()},setOperation:function(e,t){var i=this.$nav.find("#"+e);i.off("click"),i.on("click",t)},title:function(e,t){var i=this.$el.find("#tab-title-text-"+e);return t&&i.html(t),i.html()},retitle:function(e){var t=0;for(var i in this.list)this.title(i,++t+": "+e)},_template:function(e){return'<div class="ui-tabs tabbable tabs-left"><ul id="tab-navigation" class="tab-navigation nav nav-tabs"><div class="operations" style="float: right; margin-bottom: 4px;"></div></ul><div id="tab-content" class="tab-content"/></div>'},_template_tab_new:function(e){return'<li id="new-tab"><a href="javascript:void(0);"><i class="ui-tabs-add fa fa-plus-circle"/>'+e.title_new+"</a></li>"},_template_tab:function(e){var t='<li id="tab-'+e.id+'" class="tab-element"><a id="tab-title-link-'+e.id+'" title="" href="#'+e.id+'" data-original-title=""><span id="tab-title-text-'+e.id+'" class="tab-title-text">'+e.title+"</span>";return e.ondel&&(t+='<i id="delete" class="ui-tabs-delete fa fa-minus-circle"/>'),t+="</a></li>"},_template_tab_content:function(e){return'<div id="'+e.id+'" class="tab-pane"/>'}});return{View:t}}.apply(t,n),!(void 0!==s&&(e.exports=s))}).call(t,i(3),i(1),i(2))},function(e,t,i){var n,s;(function(o,a){n=[i(5),i(63),i(62),i(18),i(7),i(20),i(70)],s=function(e,t,i,n,s,r){return o.View.extend({status_classes:{init:"upload-mode fa fa-exclamation text-primary",ready:"upload-mode fa fa-check text-success",running:"upload-mode fa fa-spinner fa-spin",success:"upload-mode fa fa-check",error:"upload-mode fa fa-exclamation-triangle"},initialize:function(e,t){this.app=e;var i=this;this.model=t.model,this.setElement(this._template(t.model)),this.uploadinput=this.$el.uploadinput({ondragover:function(){i.model.get("enabled")&&i.$el.addClass("warning")},ondragleave:function(){i.$el.removeClass("warning")},onchange:function(e){"running"!=i.model.get("status")&&e&&e.length>0&&(i.model.reset({file_data:e[0],file_name:e[0].name,file_size:e[0].size,file_mode:e[0].mode||"local"}),i._refreshReady())}}),this.button_menu=new s.ButtonMenu({icon:"fa-caret-down",title:"Select",pull:"left"}),this.$("#source").append(this.button_menu.$el),this.button_menu.addMenu({icon:"fa-laptop",title:"Choose local file",onclick:function(){i.uploadinput.dialog()}}),this.app.ftp_upload_site&&this.button_menu.addMenu({icon:"fa-folder-open-o",title:"Choose FTP file",onclick:function(){i._showFtp()}}),this.button_menu.addMenu({icon:"fa-edit",title:"Paste/Fetch data",onclick:function(){i.model.reset({file_mode:"new",file_name:"New File"})}}),this.ftp=new n.View({title:"Choose FTP file:",container:this.$("#source").find(".ui-button-menu"),placement:"right"}),this.settings=new n.View({title:"Upload configuration",container:this.$("#settings"),placement:"bottom"}),this.$("#text-content").on("change input",function(e){i.model.set("url_paste",a(e.target).val()),i.model.set("file_size",a(e.target).val().length),i._refreshReady()}),this.$("#settings").on("click",function(e){i._showSettings()}).on("mousedown",function(e){e.preventDefault()}),this.model.on("change:percentage",function(){i._refreshPercentage()}),this.model.on("change:status",function(){i._refreshStatus()}),this.model.on("change:info",function(){i._refreshInfo()}),this.model.on("change:file_name",function(){i._refreshFileName()}),this.model.on("change:file_mode",function(){i._refreshMode()}),this.model.on("change:file_size",function(){i._refreshFileSize()}),this.model.on("remove",function(){i.remove()}),this.app.collection.on("reset",function(){i.remove()})},render:function(){this.$("#file_name").html(this.model.get("file_name")||"-"),this.$("#file_desc").html(this.model.get("file_desc")||"Unavailable"),this.$("#file_size").html(e.bytesToString(this.model.get("file_size"))),this.$("#status").removeClass().addClass(this.status_classes.init)},remove:function(){o.View.prototype.remove.apply(this)},_refreshReady:function(){this.app.collection.each(function(e){e.set("status",e.get("file_size")>0&&"ready"||"init")})},_refreshMode:function(){var e=this.model.get("file_mode");"new"==e?(this.height=this.$el.height(),this.$("#text").css({width:this.$el.width()-16+"px",top:this.$el.height()-8+"px"}).show(),this.$el.height(this.$el.height()-8+this.$("#text").height()+16),this.$("#text-content").val("").trigger("keyup")):(this.$el.height(this.height),this.$("#text").hide())},_refreshInfo:function(){var e=this.model.get("info");e?this.$("#info-text").html("<strong>Failed: </strong>"+e).show():this.$("#info-text").hide()},_refreshPercentage:function(){var e=parseInt(this.model.get("percentage"));0!=e?this.$(".progress-bar").css({width:e+"%"}):(this.$(".progress-bar").addClass("no-transition"),this.$(".progress-bar").css({width:"0%"}),this.$(".progress-bar")[0].offsetHeight,this.$(".progress-bar").removeClass("no-transition")),100!=e?this.$("#percentage").html(e+"%"):this.$("#percentage").html("Adding to history...")},_refreshStatus:function(){var e=this.model.get("status");this.$("#status").removeClass().addClass(this.status_classes[e]),this.model.set("enabled","running"!=e),this.$("#text-content").attr("disabled",!this.model.get("enabled")),this.$el.removeClass("success danger warning"),"running"!=e&&"ready"!=e||this.model.set("percentage",0),"running"==e?this.$("#source").find(".button").addClass("disabled"):this.$("#source").find(".button").removeClass("disabled"),"success"==e&&(this.$el.addClass("success"),this.model.set("percentage",100),this.$("#percentage").html("100%")),"error"==e?(this.$el.addClass("danger"),this.model.set("percentage",0),this.$("#info-progress").hide(),this.$("#info-text").show()):(this.$("#info-progress").show(),this.$("#info-text").hide())},_refreshFileName:function(){this.$("#file_name").html(this.model.get("file_name")||"-")},_refreshFileSize:function(){this.$("#file_size").html(e.bytesToString(this.model.get("file_size")))},_showFtp:function(){if(this.ftp.visible)this.ftp.hide();else{this.ftp.empty();var e=this;this.ftp.append(new i({ftp_upload_site:this.app.ftp_upload_site,onchange:function(t){e.ftp.hide(),"running"!=e.model.get("status")&&t&&(e.model.reset({file_mode:"ftp",file_name:t.path,file_size:t.size,file_path:t.path}),e._refreshReady())}}).$el),this.ftp.show()}},_showSettings:function(){this.settings.visible?this.settings.hide():(this.settings.empty(),this.settings.append(new t(this).$el),this.settings.show())},_template:function(e){return'<tr id="upload-row-'+e.id+'" class="upload-row"><td><div id="source"/><div class="upload-text-column"><div id="text" class="text"><div class="text-info">You can tell Galaxy to download data from web by entering URL in this box (one per line). You can also directly paste the contents of a file.</div><textarea id="text-content" class="text-content form-control"/></div></div></td><td><div id="status"/></td><td><div id="file_desc" class="upload-title"/></td><td><div id="file_name" class="upload-title"/></td><td><div id="file_size" class="upload-size"/></td><td><div id="settings" class="upload-icon-button fa fa-gear"/></td><td><div id="info" class="upload-info"><div id="info-text"/><div id="info-progress" class="progress"><div class="progress-bar progress-bar-success"/><div id="percentage" class="percentage">0%</div></div></div></td></tr>'}})}.apply(t,n),!(void 0!==s&&(e.exports=s))}).call(t,i(3),i(1))},function(e,t,i){var n,s;(function(o,a,r){n=[i(5),i(34),i(109),i(18),i(20),i(7)],s=function(e,t,i,n,s,l){return o.View.extend({select_extension:null,select_genome:null,collection:new t.Collection,initialize:function(e){this.app=e,this.options=e.options,this.list_extensions=e.list_extensions,this.list_genomes=e.list_genomes,this.ftp_upload_site=e.currentFtp();var t=this;this.setElement(this._template()),this.btnStart=new l.Button({title:"Start",onclick:function(){t._eventStart()}}),this.btnClose=new l.Button({title:"Close",onclick:function(){t.app.modal.hide()}});var i=[this.btnStart,this.btnClose];for(var n in i)this.$("#upload-buttons").prepend(i[n].$el);this.select_extension=new s.View({css:"footer-selection",container:this.$("#footer-extension"),data:a.filter(this.list_extensions,function(e){return e.composite_files;
}),onchange:function(e){t.collection.reset();var i=a.findWhere(t.list_extensions,{id:e});if(i&&i.composite_files)for(var n in i.composite_files){var s=i.composite_files[n];t.collection.add({id:t.collection.size(),file_desc:s.description||s.name})}}}),this.$("#footer-extension-info").on("click",function(e){t._showExtensionInfo({$el:r(e.target),title:t.select_extension.text(),extension:t.select_extension.value(),placement:"top"})}).on("mousedown",function(e){e.preventDefault()}),this.select_genome=new s.View({css:"footer-selection",container:this.$("#footer-genome"),data:this.list_genomes,value:this.options.default_genome}),this.collection.on("add",function(e){t._eventAnnounce(e)}),this.collection.on("change add",function(){t._updateScreen()}).trigger("change"),this.select_extension.options.onchange(this.select_extension.value())},_eventAnnounce:function(e){var t=new i(this,{model:e});this.$("#upload-table > tbody:first").append(t.$el),t.render(),this.collection.length>0?this.$("#upload-table").show():this.$("#upload-table").hide()},_eventStart:function(){var e=this;this.collection.each(function(t){t.set("genome",e.select_genome.value()),t.set("extension",e.select_extension.value())}),r.uploadpost({url:this.app.options.nginx_upload_path,data:this.app.toData(this.collection.filter()),success:function(t){e._eventSuccess(t)},error:function(t){e._eventError(t)},progress:function(t){e._eventProgress(t)}})},_eventProgress:function(e){this.collection.each(function(t){t.set("percentage",e)})},_eventSuccess:function(e){this.collection.each(function(e){e.set("status","success")}),Galaxy.currHistoryPanel.refreshContents()},_eventError:function(e){this.collection.each(function(t){t.set("status","error"),t.set("info",e)})},_showExtensionInfo:function(e){var t=e.$el,i=e.extension,s=e.title,o=a.findWhere(this.list_extensions,{id:i});this.extension_popup&&this.extension_popup.remove(),this.extension_popup=new n.View({placement:e.placement||"bottom",container:t,destroy:!0}),this.extension_popup.title(s),this.extension_popup.empty(),this.extension_popup.append(this._templateDescription(o)),this.extension_popup.show()},_updateScreen:function(){var e=this.collection.first();e&&"running"==e.get("status")?(this.select_genome.disable(),this.select_extension.disable()):(this.select_genome.enable(),this.select_extension.enable()),this.collection.where({status:"ready"}).length==this.collection.length&&this.collection.length>0?(this.btnStart.enable(),this.btnStart.$el.addClass("btn-primary")):(this.btnStart.disable(),this.btnStart.$el.removeClass("btn-primary")),this.collection.length>0?this.$("#upload-table").show():this.$("#upload-table").hide()},_templateDescription:function(e){if(e.description){var t=e.description;return e.description_url&&(t+='&nbsp;(<a href="'+e.description_url+'" target="_blank">read more</a>)'),t}return"There is no description available for this file extension."},_template:function(){return'<div class="upload-view-composite"><div id="upload-footer" class="upload-footer"><span class="footer-title">Composite Type:</span><span id="footer-extension"/><span id="footer-extension-info" class="upload-icon-button fa fa-search"/> <span class="footer-title">Genome/Build:</span><span id="footer-genome"/></div><div id="upload-box" class="upload-box"><table id="upload-table" class="ui-table-striped" style="display: none;"><thead><tr><th/><th/><th>Description</th><th>Name</th><th>Size</th><th>Settings</th><th>Status</th></tr></thead><tbody></tbody></table></div><div id="upload-buttons" class="upload-buttons"/></div>'}})}.apply(t,n),!(void 0!==s&&(e.exports=s))}).call(t,i(3),i(2),i(1))},function(e,t,i){var n,s;(function(o,a){n=[i(5),i(34),i(63),i(18),i(20)],s=function(e,t,i,n,s){return o.View.extend({status_classes:{init:"upload-icon-button fa fa-trash-o",queued:"upload-icon fa fa-spinner fa-spin",running:"upload-icon fa fa-spinner fa-spin",success:"upload-icon-button fa fa-check",error:"upload-icon-button fa fa-exclamation-triangle"},settings:null,select_genome:null,select_extension:null,initialize:function(e,t){this.app=e;var i=this;this.model=t.model,this.setElement(this._template(t.model)),this.settings=new n.View({title:"Upload configuration",container:this.$("#settings"),placement:"bottom"});var o=this.app.select_genome.value();this.select_genome=new s.View({css:"upload-genome",onchange:function(e){i.model.set("genome",e)},data:i.app.list_genomes,container:this.$("#genome"),value:o}),this.model.set("genome",o);var r=this.app.select_extension.value();this.select_extension=new s.View({css:"upload-extension",onchange:function(e){i.model.set("extension",e)},data:i.app.list_extensions,container:this.$("#extension"),value:r}),this.model.set("extension",r),this.$("#symbol").on("click",function(){i._removeRow()}),this.$("#extension-info").on("click",function(e){i.app.showExtensionInfo({$el:a(e.target),title:i.select_extension.text(),extension:i.select_extension.value()})}).on("mousedown",function(e){e.preventDefault()}),this.$("#settings").on("click",function(e){i._showSettings()}).on("mousedown",function(e){e.preventDefault()}),this.$("#text-content").on("change input",function(e){i.model.set("url_paste",a(e.target).val()),i.model.set("file_size",a(e.target).val().length)}),this.model.on("change:percentage",function(){i._refreshPercentage()}),this.model.on("change:status",function(){i._refreshStatus()}),this.model.on("change:info",function(){i._refreshInfo()}),this.model.on("change:genome",function(){i._refreshGenome()}),this.model.on("change:extension",function(){i._refreshExtension()}),this.model.on("change:file_size",function(){i._refreshFileSize()}),this.model.on("remove",function(){i.remove()}),this.app.collection.on("reset",function(){i.remove()})},render:function(){var t=this.model.get("file_name"),i=this.model.get("file_size"),n=this.model.get("file_mode");this.$("#title").html(t),this.$("#size").html(e.bytesToString(i)),this.$("#mode").removeClass().addClass("upload-mode").addClass("text-primary"),"new"==n&&(this.$("#text").css({width:this.$el.width()-16+"px",top:this.$el.height()-8+"px"}).show(),this.$el.height(this.$el.height()-8+this.$("#text").height()+16),this.$("#mode").addClass("fa fa-edit")),"local"==n&&this.$("#mode").addClass("fa fa-laptop"),"ftp"==n&&this.$("#mode").addClass("fa fa-folder-open-o")},remove:function(){this.select_genome.remove(),this.select_extension.remove(),o.View.prototype.remove.apply(this)},_refreshExtension:function(){this.select_extension.value(this.model.get("extension"))},_refreshGenome:function(){this.select_genome.value(this.model.get("genome"))},_refreshInfo:function(){var e=this.model.get("info");e?this.$("#info").html("<strong>Failed: </strong>"+e).show():this.$("#info").hide()},_refreshPercentage:function(){var e=parseInt(this.model.get("percentage"));this.$(".progress-bar").css({width:e+"%"}),100!=e?this.$("#percentage").html(e+"%"):this.$("#percentage").html("Adding to history...")},_refreshStatus:function(){var e=this.model.get("status");this.$("#symbol").removeClass().addClass(this.status_classes[e]),this.model.set("enabled","init"==e);var t=this.model.get("enabled");this.$("#text-content").attr("disabled",!t),t?(this.select_genome.enable(),this.select_extension.enable()):(this.select_genome.disable(),this.select_extension.disable()),"success"==e&&(this.$el.addClass("success"),this.$("#percentage").html("100%")),"error"==e&&(this.$el.addClass("danger"),this.$(".progress").remove())},_refreshFileSize:function(){var t=this.model.get("file_size");this.$("#size").html(e.bytesToString(t))},_removeRow:function(){var e=this.model.get("status");"init"!=e&&"success"!=e&&"error"!=e||this.app.collection.remove(this.model)},_showSettings:function(){this.settings.visible?this.settings.hide():(this.settings.empty(),this.settings.append(new i(this).$el),this.settings.show())},_template:function(e){return'<tr id="upload-row-'+e.id+'" class="upload-row"><td><div class="upload-text-column"><div id="mode"/><div id="title" class="upload-title"/><div id="text" class="text"><div class="text-info">You can tell Galaxy to download data from web by entering URL in this box (one per line). You can also directly paste the contents of a file.</div><textarea id="text-content" class="text-content form-control"/></div></div></td><td><div id="size" class="upload-size"/></td><td><div id="extension" class="upload-extension" style="float: left;"/>&nbsp;&nbsp<div id="extension-info" class="upload-icon-button fa fa-search"/></td><td><div id="genome" class="upload-genome"/></td><td><div id="settings" class="upload-settings upload-icon-button fa fa-gear"/></td><td><div id="info" class="upload-info"><div class="progress"><div class="progress-bar progress-bar-success"/><div id="percentage" class="percentage">0%</div></div></div></td><td><div id="symbol" class="'+this.status_classes.init+'"/></td></tr>'}})}.apply(t,n),!(void 0!==s&&(e.exports=s))}).call(t,i(3),i(1))},function(e,t,i){var n,s;(function(o,a,r){n=[i(5),i(34),i(111),i(62),i(18),i(20),i(7),i(70)],s=function(e,t,i,n,s,l,d){return o.View.extend({select_extension:null,select_genome:null,uploadbox:null,upload_size:0,collection:new t.Collection,ftp:null,counter:{announce:0,success:0,error:0,running:0,reset:function(){this.announce=this.success=this.error=this.running=0}},initialize:function(e){this.app=e,this.options=e.options,this.list_extensions=e.list_extensions,this.list_genomes=e.list_genomes,this.ui_button=e.ui_button,this.ftp_upload_site=e.currentFtp();var t=this;this.setElement(this._template()),this.btnLocal=new d.Button({id:"btn-local",title:"Choose local file",onclick:function(){t.uploadbox.select()},icon:"fa fa-laptop"}),this.btnFtp=new d.Button({id:"btn-ftp",title:"Choose FTP file",onclick:function(){t._eventFtp()},icon:"fa fa-folder-open-o"}),this.btnCreate=new d.Button({id:"btn-new",title:"Paste/Fetch data",onclick:function(){t._eventCreate()},icon:"fa fa-edit"}),this.btnStart=new d.Button({id:"btn-start",title:"Start",onclick:function(){t._eventStart()}}),this.btnStop=new d.Button({id:"btn-stop",title:"Pause",onclick:function(){t._eventStop()}}),this.btnReset=new d.Button({id:"btn-reset",title:"Reset",onclick:function(){t._eventReset()}}),this.btnClose=new d.Button({id:"btn-close",title:"Close",onclick:function(){t.app.modal.hide()}});var i=[this.btnLocal,this.btnFtp,this.btnCreate,this.btnStop,this.btnReset,this.btnStart,this.btnClose];for(var n in i)this.$("#upload-buttons").prepend(i[n].$el);var t=this;this.uploadbox=this.$("#upload-box").uploadbox({url:this.app.options.nginx_upload_path,announce:function(e,i){t._eventAnnounce(e,i)},initialize:function(e){return t.app.toData([t.collection.get(e)],t.history_id)},progress:function(e,i){t._eventProgress(e,i)},success:function(e,i){t._eventSuccess(e,i)},error:function(e,i){t._eventError(e,i)},complete:function(){t._eventComplete()},ondragover:function(){t.$(".upload-box").addClass("highlight")},ondragleave:function(){t.$(".upload-box").removeClass("highlight")}}),this.ftp=new s.View({title:"FTP files",container:this.btnFtp.$el}),this.select_extension=new l.View({css:"footer-selection",container:this.$("#footer-extension"),data:a.filter(this.list_extensions,function(e){return!e.composite_files}),value:this.options.default_extension,onchange:function(e){t.updateExtension(e)}}),t.$("#footer-extension-info").on("click",function(e){t.showExtensionInfo({$el:r(e.target),title:t.select_extension.text(),extension:t.select_extension.value(),placement:"top"})}).on("mousedown",function(e){e.preventDefault()}),this.select_genome=new l.View({css:"footer-selection",container:this.$("#footer-genome"),data:this.list_genomes,value:this.options.default_genome,onchange:function(e){t.updateGenome(e)}}),this.collection.on("remove",function(e){t._eventRemove(e)}),this._updateScreen()},_eventAnnounce:function(e,n){this.counter.announce++;var s=new t.Model({id:e,file_name:n.name,file_size:n.size,file_mode:n.mode||"local",file_path:n.path,file_data:n});this.collection.add(s);var o=new i(this,{model:s});this.$("#upload-table > tbody:first").append(o.$el),this._updateScreen(),o.render()},_eventProgress:function(e,t){var i=this.collection.get(e);i.set("percentage",t),this.ui_button.set("percentage",this._uploadPercentage(t,i.get("file_size")))},_eventSuccess:function(e,t){var i=this.collection.get(e);i.set("percentage",100),i.set("status","success"),this.ui_button.set("percentage",this._uploadPercentage(100,i.get("file_size"))),this.upload_completed+=100*i.get("file_size"),this.counter.announce--,this.counter.success++,this._updateScreen(),Galaxy.currHistoryPanel.refreshContents()},_eventError:function(e,t){var i=this.collection.get(e);i.set("percentage",100),i.set("status","error"),i.set("info",t),this.ui_button.set("percentage",this._uploadPercentage(100,i.get("file_size"))),this.ui_button.set("status","danger"),this.upload_completed+=100*i.get("file_size"),this.counter.announce--,this.counter.error++,this._updateScreen()},_eventComplete:function(){this.collection.each(function(e){"queued"==e.get("status")&&e.set("status","init")}),this.counter.running=0,this._updateScreen()},_eventRemove:function(e){var t=e.get("status");"success"==t?this.counter.success--:"error"==t?this.counter.error--:this.counter.announce--,this.uploadbox.remove(e.id),this._updateScreen()},showExtensionInfo:function(e){var t=this,i=e.$el,n=e.extension,o=e.title,r=a.findWhere(t.list_extensions,{id:n});this.extension_popup&&this.extension_popup.remove(),this.extension_popup=new s.View({placement:e.placement||"bottom",container:i}),this.extension_popup.title(o),this.extension_popup.empty(),this.extension_popup.append(this._templateDescription(r)),this.extension_popup.show()},_eventFtp:function(){if(this.ftp.visible)this.ftp.hide();else{this.ftp.empty();var e=this;this.ftp.append(new n({collection:this.collection,ftp_upload_site:this.ftp_upload_site,onadd:function(t){e.uploadbox.add([{mode:"ftp",name:t.path,size:t.size,path:t.path}])},onremove:function(t){e.collection.remove(t)}}).$el),this.ftp.show()}},_eventCreate:function(){this.uploadbox.add([{name:"New File",size:0,mode:"new"}])},_eventStart:function(){if(!(0==this.counter.announce||this.counter.running>0)){var e=this;this.upload_size=0,this.upload_completed=0,this.collection.each(function(t){"init"==t.get("status")&&(t.set("status","queued"),e.upload_size+=t.get("file_size"))}),this.ui_button.set("percentage",0),this.ui_button.set("status","success"),this.counter.running=this.counter.announce,this.history_id=this.app.currentHistory(),this.uploadbox.start(),this._updateScreen()}},_eventStop:function(){this.counter.running>0&&(this.ui_button.set("status","info"),r("#upload-info").html("Queue will pause after completing the current file..."),this.uploadbox.stop())},_eventReset:function(){0==this.counter.running&&(this.collection.reset(),this.counter.reset(),this.uploadbox.reset(),this.select_extension.value(this.options.default_extension),this.select_genome.value(this.options.default_genome),this.ui_button.set("percentage",0),this._updateScreen())},updateExtension:function(e,t){var i=this;this.collection.each(function(n){"init"!=n.get("status")||n.get("extension")!=i.options.default_extension&&t||n.set("extension",e)})},updateGenome:function(e,t){var i=this;this.collection.each(function(n){"init"!=n.get("status")||n.get("genome")!=i.options.default_genome&&t||n.set("genome",e)})},_updateScreen:function(){0==this.counter.announce?this.uploadbox.compatible()?message="&nbsp;":message="Browser does not support Drag & Drop. Try Firefox 4+, Chrome 7+, IE 10+, Opera 12+ or Safari 6+.":0==this.counter.running?message="You added "+this.counter.announce+" file(s) to the queue. Add more files or click 'Start' to proceed.":message="Please wait..."+this.counter.announce+" out of "+this.counter.running+" remaining.",this.$("#upload-info").html(message),0==this.counter.running&&this.counter.announce+this.counter.success+this.counter.error>0?this.btnReset.enable():this.btnReset.disable(),0==this.counter.running&&this.counter.announce>0?(this.btnStart.enable(),this.btnStart.$el.addClass("btn-primary")):(this.btnStart.disable(),this.btnStart.$el.removeClass("btn-primary")),this.counter.running>0?this.btnStop.enable():this.btnStop.disable(),0==this.counter.running?(this.btnLocal.enable(),this.btnFtp.enable(),this.btnCreate.enable()):(this.btnLocal.disable(),this.btnFtp.disable(),this.btnCreate.disable()),this.ftp_upload_site?this.btnFtp.$el.show():this.btnFtp.$el.hide(),this.counter.announce+this.counter.success+this.counter.error>0?(this.$("#upload-table").show(),this.$(".upload-helper").hide()):(this.$("#upload-table").hide(),this.$(".upload-helper").show())},_uploadPercentage:function(e,t){return(this.upload_completed+e*t)/this.upload_size},_templateDescription:function(e){if(e.description){var t=e.description;return e.description_url&&(t+='&nbsp;(<a href="'+e.description_url+'" target="_blank">read more</a>)'),t}return"There is no description available for this file extension."},_template:function(){return'<div class="upload-view-default"><div class="upload-top"><h6 id="upload-info" class="upload-info"/></div><div id="upload-box" class="upload-box"><div class="upload-helper"><i class="fa fa-files-o"/>Drop files here</div><table id="upload-table" class="ui-table-striped" style="display: none;"><thead><tr><th>Name</th><th>Size</th><th>Type</th><th>Genome</th><th>Settings</th><th>Status</th><th/></tr></thead><tbody/></table></div><div id="upload-footer" class="upload-footer"><span class="footer-title">Type (set all):</span><span id="footer-extension"/><span id="footer-extension-info" class="upload-icon-button fa fa-search"/> <span class="footer-title">Genome (set all):</span><span id="footer-genome"/></div><div id="upload-buttons" class="upload-buttons"/></div>'}})}.apply(t,n),!(void 0!==s&&(e.exports=s))}).call(t,i(3),i(2),i(1))},function(e,t,i){var n,s;(function(i,o){n=[],s=function(){var e=i.Model.extend({defaults:{icon:"fa-upload",tooltip:"Download from URL or upload files from disk",label:"Load Data",percentage:0,status:""}}),t=i.View.extend({model:null,initialize:function(e){var t=this,i=e.model;this.setElement(this._template()),this.$el.on("click",function(t){e.onclick(t)}),this.$el.tooltip({title:i.get("tooltip"),placement:"bottom"}),i.on("change:percentage",function(){t._percentage(i.get("percentage"))}),i.on("change:status",function(){t._status(i.get("status"))});var t=this;o(window).on("beforeunload",function(){var t="";if(e.onunload&&(t=e.onunload()),""!=t)return t})},_status:function(e){var t=this.$el.find(".progress-bar");t.removeClass(),t.addClass("progress-bar"),t.addClass("progress-bar-notransition"),""!=e&&t.addClass("progress-bar-"+e)},_percentage:function(e){var t=this.$el.find(".progress-bar");t.css({width:e+"%"})},_template:function(){return'<div class="upload-button"><div class="progress"><div class="progress-bar"/><a class="panel-header-button" href="javascript:void(0)" id="tool-panel-upload-button"><span class="fa fa-upload"/></a></div></div>'}});return{Model:e,View:t}}.apply(t,n),!(void 0!==s&&(e.exports=s))}).call(t,i(3),i(1))},function(e,t,i){var n,s;(function(o){n=[i(5),i(9),i(108),i(113),i(112),i(110)],s=function(e,t,i,n,s,a){return o.View.extend({options:{nginx_upload_path:"",ftp_upload_site:"n/a",default_genome:"?",default_extension:"auto",height:500,width:900,auto:{id:"auto",text:"Auto-detect",description:"This system will try to detect the file type automatically. If your file is not detected properly as one of the known formats, it most likely means that it has some format problems (e.g., different number of columns on different rows). You can still coerce the system to set your data to the format you think it should be.  You can also upload compressed files, which will automatically be decompressed."}},modal:null,ui_button:null,current_history:null,list_extensions:[],list_genomes:[],initialize:function(t){var i=this;this.options=e.merge(t,this.options),this.ui_button=new n.Model,this.ui_button_view=new n.View({model:this.ui_button,onclick:function(e){e.preventDefault(),i.show()},onunload:function(){var e=i.ui_button.get("percentage",0);if(e>0&&e<100)return"Several uploads are queued."}}),this.setElement(this.ui_button_view.$el);var i=this;e.get({url:Galaxy.root+"api/datatypes?extension_only=False",success:function(e){for(key in e)i.list_extensions.push({id:e[key].extension,text:e[key].extension,description:e[key].description,description_url:e[key].description_url,composite_files:e[key].composite_files});i.list_extensions.sort(function(e,t){var i=e.text&&e.text.toLowerCase(),n=t.text&&t.text.toLowerCase();return i>n?1:i<n?-1:0}),i.options.datatypes_disable_auto||i.list_extensions.unshift(i.options.auto)}}),e.get({url:Galaxy.root+"api/genomes",success:function(e){for(key in e)i.list_genomes.push({id:e[key][1],text:e[key][0]});i.list_genomes.sort(function(e,t){return e.id==i.options.default_genome?-1:t.id==i.options.default_genome?1:e.text>t.text?1:e.text<t.text?-1:0})}})},show:function(){var e=this;return Galaxy.currHistoryPanel&&Galaxy.currHistoryPanel.model?(this.current_user=Galaxy.user.id,this.modal||(this.tabs=new i.View,this.default_view=new s(this),this.tabs.add({id:"regular",title:"Regular",$el:this.default_view.$el}),this.composite_view=new a(this),this.tabs.add({id:"composite",title:"Composite",$el:this.composite_view.$el}),this.modal=new t.View({title:"Download from web or upload from disk",body:this.tabs.$el,height:this.options.height,width:this.options.width,closing_events:!0,title_separator:!1})),void this.modal.show()):void window.setTimeout(function(){e.show()},500)},currentHistory:function(){return this.current_user&&Galaxy.currHistoryPanel.model.get("id")},currentFtp:function(){return this.current_user&&this.options.ftp_upload_site},toData:function(e,t){var i={payload:{tool_id:"upload1",history_id:t||this.currentHistory(),inputs:{}},files:[],error_message:null};if(e&&e.length>0){var n={};n.dbkey=e[0].get("genome",null),n.file_type=e[0].get("extension",null);for(var s in e){var o=e[s];if(o.set("status","running"),!(o.get("file_size")>0)){i.error_message="Upload content incomplete.",o.set("status","error"),o.set("info",i.error_message);break}var a="files_"+s+"|";switch(n[a+"type"]="upload_dataset",n[a+"space_to_tab"]=o.get("space_to_tab")&&"Yes"||null,n[a+"to_posix_lines"]=o.get("to_posix_lines")&&"Yes"||null,o.get("file_mode")){case"new":n[a+"url_paste"]=o.get("url_paste");break;case"ftp":n[a+"ftp_files"]=o.get("file_path");break;case"local":i.files.push({name:a+"file_data",file:o.get("file_data")})}}i.payload.inputs=JSON.stringify(n)}return i}})}.apply(t,n),!(void 0!==s&&(e.exports=s))}).call(t,i(3))},,,,function(e,t,i){var n,s,o;(function(i,a){!function(i,a){s=[],n=a,o="function"==typeof n?n.apply(t,s):n,!(void 0!==o&&(e.exports=o))}(this,function(){function e(e,t){function n(){var i=['<div class="loading-indicator">','<div class="loading-indicator-text">','<span class="fa fa-spinner fa-spin fa-lg"></span>','<span class="loading-indicator-message">loading...</span>',"</div>","</div>"].join("\n"),n=a(i).hide().css(t.css||{position:"fixed"}),s=n.children(".loading-indicator-text");return t.cover?(n.css({"z-index":2,top:e.css("top"),bottom:e.css("bottom"),left:e.css("left"),right:e.css("right"),opacity:.5,"background-color":"white","text-align":"center"}),s=n.children(".loading-indicator-text").css({"margin-top":"20px"})):(s=n.children(".loading-indicator-text").css({margin:"12px 0px 0px 10px",opacity:"0.85",color:"grey"}),s.children(".loading-indicator-message").css({margin:"0px 8px 0px 0px","font-style":"italic"})),n}var s=this;return t=i.extend({cover:!1},t||{}),s.show=function(t,i,o){return t=t||"loading...",i=i||"fast",e.parent().find(".loading-indicator").remove(),s.$indicator=n().insertBefore(e),s.message(t),s.$indicator.fadeIn(i,o),s},s.message=function(e){s.$indicator.find("i").text(e)},s.hide=function(e,t){return e=e||"fast",s.$indicator&&s.$indicator.length?s.$indicator.fadeOut(e,function(){s.$indicator.remove(),t&&t()}):t&&t(),s},s}return e})}).call(t,i(1),i(1))},,,,function(e,t,i){var n,s;n=[],s=function(){function e(e,t){if(0===e.length)return t.length;if(0===t.length)return e.length;var i,n=[];for(i=0;i<=t.length;i++)n[i]=[i];var s;for(s=0;s<=e.length;s++)n[0][s]=s;for(i=1;i<=t.length;i++)for(s=1;s<=e.length;s++)t.charAt(i-1)===e.charAt(s-1)?n[i][s]=n[i-1][s-1]:n[i][s]=Math.min(n[i-1][s-1]+1,Math.min(n[i][s-1]+1,n[i-1][s]+1));return n[t.length][e.length]}return e}.apply(t,n),!(void 0!==s&&(e.exports=s))}]);
//# sourceMappingURL=analysis.bundled.js.map