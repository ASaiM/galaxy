define(["layout/masthead","layout/panel","mvc/ui/ui-modal","mvc/base-mvc","mvc/tool/tool-form"],function(a,b,c,d,e){var f=Backbone.View.extend(d.LoggableMixin).extend({_logNamespace:"layout",el:"body",className:"full-content",events:{keydown:"invokeSearchOverlay","keyup .txtbx-search-data":"searchData","click .remove-search-screen":"removeOverlay","click .tool-search-link":"searchedToolLink","click .history-search-link":"removeOverlay"},_panelIds:["left","center","right"],defaultOptions:{message_box_visible:!1,message_box_content:"",message_box_class:"info",show_inactivity_warning:!1,inactivity_box_content:""},initialize:function(b){this.log(this+".initialize:",b),_.extend(this,_.pick(b,this._panelIds)),this.options=_.defaults(_.omit(b.config,this._panelIds),this.defaultOptions),Galaxy.modal=this.modal=new c.View,this.masthead=new a.View(this.options),this.$el.attr("scroll","no"),this.$el.html(this._template()),this.$el.append(this.masthead.frame.$el),this.$("#masthead").replaceWith(this.masthead.$el),this.$el.append(this.modal.$el),this.$messagebox=this.$("#messagebox"),this.$inactivebox=this.$("#inactivebox")},render:function(){return $(".select2-hidden-accessible").remove(),this.log(this+".render:"),this.masthead.render(),this.renderMessageBox(),this.renderInactivityBox(),this.renderPanels(),this.invokeSearchOverlay(),this.removeOverlay(),this.searchData(),this.searchedToolLink(),this},renderMessageBox:function(){if(this.options.message_box_visible){var a=this.options.message_box_content||"",b=this.options.message_box_class||"info";this.$el.addClass("has-message-box"),this.$messagebox.attr("class","panel-"+b+"-message").html(a).toggle(!!a).show()}else this.$el.removeClass("has-message-box"),this.$messagebox.hide();return this},renderInactivityBox:function(){if(this.options.show_inactivity_warning){var a=this.options.inactivity_box_content||"",b=$("<a/>").attr("href",Galaxy.root+"user/resend_verification").text("Resend verification");this.$el.addClass("has-inactivity-box"),this.$inactivebox.html(a+" ").append(b).toggle(!!a).show()}else this.$el.removeClass("has-inactivity-box"),this.$inactivebox.hide();return this},renderPanels:function(){var a=this;return this._panelIds.forEach(function(b){_.has(a,b)&&(a[b].setElement("#"+b),a[b].render())}),this.left||this.center.$el.css("left",0),this.right||this.center.$el.css("right",0),this},invokeSearchOverlay:function(a){if(a){a.stopPropagation();var b=$(".search-screen"),c=$(".search-screen-overlay"),d=$(".txtbx-search-data"),e=$(".search-results");81!==a.which&&81!==a.keyCode||!a.ctrlKey?(27===a.which||27===a.keyCode)&&this.removeOverlay():(d.val(""),e.html(""),c.css("display","block"),b.css("display","block"),d.focus())}},removeOverlay:function(){var a=$(".search-screen"),b=$(".search-screen-overlay");b.css("display","none"),a.css("display","none")},searchData:function(a){if(a){a.stopPropagation();var b=$(".txtbx-search-data"),c="",d=Galaxy.root+"api/tools",e=$(".search-results"),f=3,g=this;c=b.val(),c=c.trim(),c.length<f?e.html(""):13===a.which||13===a.keyCode||c.length>=f?(e.html(""),g._templateHistorySearch(c),$.get(d,{q:c},function(a){g._templateSearchlinks(a,g)},"json")):(27===a.which||27===a.keyCode)&&this.removeOverlay()}},searchedToolLink:function(a){if(a){var b="",c="",d="",f=null;if(this.removeOverlay(),a.srcElement?f=$(a.srcElement):a.target&&(f=$(a.target)),b=f.attr("data-toolid"),c=f.attr("data-formstyle"),d=f.attr("data-version"),"upload1"===b)Galaxy.upload.show();else if("regular"===c){var g=new e.View({id:b,version:d});g.deferred.execute(function(){Galaxy.app.display(g)})}else"special"===c&&(document.location=f.attr("href"))}},_templateSearchlinks:function(a,b){for(var c=$(".search-results"),d=[],e=0;e<a.length;e++)for(var f=Galaxy.toolPanel.attributes.layout.models,g=0;g<f.length;g++){for(var h=f[g].attributes.elems,i=!1,j="",k="",l="",m=0;m<h.length;m++)a[e]===h[m].id&&(i=!0,j+=b._buildLinkTemplate(h[m].attributes));i&&(k=f[g].attributes.id,l=f[g].attributes.name,d=b.appendTemplate(d,k,l,j))}b.makeSearchResultTemplate(c,d)},_templateHistorySearch:function(a){for(var b=Galaxy.currHistoryPanel.collection.models,c="",d=$(".search-results"),e=!1,f=0;f<b.length;f++){var g=b[f].attributes,h=g.name;h=h.toLowerCase(),a=a.toLowerCase(),h.indexOf(a)>-1&&(c+=this._buildHistorySearchTemplate(g),e=!0)}e&&(d.append(this._buildHeaderTemplate("history","History")),d.append(c))},_buildHistorySearchTemplate:function(a){return"<a class='history-search-link btn btn-primary "+a.dataset_id+"' href='/datasets/"+a.dataset_id+"/display/?preview=True' role='button' title='"+a.name+"' target='galaxy_main'>"+a.name+"</a>"},checkValue:function(a,b){for(var c=0;c<a.length;c++)if(b===a[c].id)return!0;return!1},appendTemplate:function(a,b,c,d){for(var e=!1,f=0;f<a.length;f++)b===a[f].id&&(a[f].template=a[f].template+0+d,e=!0);return e||a.push({id:b,template:d,name:c}),a},makeSearchResultTemplate:function(a,b){for(var c="",d=0;d<b.length;d++)c=this._buildHeaderTemplate(b[d].id,b[d].name),a.append(c),a.append(b[d].template),a.find("a.tool-search-link").click(function(a){a.preventDefault()});a.fadeIn("slow")},_buildHeaderTemplate:function(a,b){return"<div class='search-tool-section-name' data-id='searched_"+a+"' >"+b+"</div>"},_buildLinkTemplate:function(a){return"<a class='tool-search-link btn btn-primary "+a.id+" ' href='"+a.link+"' role='button' title='"+a.name+" "+a.description+"' target='"+a.target+"' data-version='"+a.version+"' minsizehint='"+a.min_width+"' data-formstyle='"+a.form_style+"' data-toolid='"+a.id+"' >"+a.name+"</a>"},_template:function(){return['<div id="search_screen_overlay" class="search-screen-overlay"></div>','<div id="search_screen" class="search-screen"><input class="txtbx-search-data form-control" type="text" value="" placeholder="Type your query..." /><div class="search-results"></div></div>','<div id="everything">','<div id="background"/>','<div id="masthead"/>','<div id="messagebox"/>','<div id="inactivebox" class="panel-warning-message" />',this.left?'<div id="left" />':"",this.center?'<div id="center" class="inbound" />':"",this.right?'<div id="right" />':"","</div>",'<div id="dd-helper" />'].join("")},hideSidePanels:function(){this.left&&this.left.hide(),this.right&&this.right.hide()},toString:function(){return"PageLayoutView"}});return{PageLayoutView:f}});
//# sourceMappingURL=../../maps/layout/page.js.map